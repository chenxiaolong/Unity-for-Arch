=== modified file 'CMakeLists.txt'
--- CMakeLists.txt	2014-02-23 21:53:24 +0000
+++ CMakeLists.txt	2014-01-23 09:44:40 +0000
@@ -219,7 +219,6 @@
     ${UNITY_PROTOCOL_PRIVATE_DEPS}
     atk
     atk-bridge-2.0
-    cairo>=1.13.1
     dbusmenu-glib-0.4
     dee-1.0
     gio-2.0>=2.30.0

=== modified file 'UnityCore/DBusIndicators.cpp'
--- UnityCore/DBusIndicators.cpp	2014-02-28 05:16:10 +0000
+++ UnityCore/DBusIndicators.cpp	2014-02-11 03:11:47 +0000
@@ -59,7 +59,6 @@
   void OnDisconnected();

   void OnReSync(GVariant* parameters);
-  void OnIconsPathChanged(GVariant* parameters);
   void OnEntryActivated(GVariant* parameters);
   void OnEntryActivatedRequest(GVariant* parameters);
   void OnEntryShowNowChanged(GVariant* parameters);
@@ -75,7 +74,6 @@
   glib::Source::UniquePtr reconnect_timeout_;
   glib::Source::UniquePtr show_entry_idle_;
   glib::Source::UniquePtr show_appmenu_idle_;
-  std::vector<std::string> icon_paths_;
   std::map<std::string, EntryLocationMap> cached_locations_;
 };

@@ -87,7 +85,6 @@
             G_BUS_TYPE_SESSION, G_DBUS_PROXY_FLAGS_DO_NOT_LOAD_PROPERTIES)
 {
   gproxy_.Connect("ReSync", sigc::mem_fun(this, &DBusIndicators::Impl::OnReSync));
-  gproxy_.Connect("IconPathsChanged", sigc::mem_fun(this, &DBusIndicators::Impl::OnIconsPathChanged));
   gproxy_.Connect("EntryActivated", sigc::mem_fun(this, &DBusIndicators::Impl::OnEntryActivated));
   gproxy_.Connect("EntryActivateRequest", sigc::mem_fun(this, &DBusIndicators::Impl::OnEntryActivatedRequest));
   gproxy_.Connect("EntryShowNowChanged", sigc::mem_fun(this, &DBusIndicators::Impl::OnEntryShowNowChanged));
@@ -129,7 +126,6 @@

 void DBusIndicators::Impl::OnConnected()
 {
-  OnIconsPathChanged(nullptr);
   RequestSyncAll();
 }

@@ -160,50 +156,6 @@
   }
 }

-void DBusIndicators::Impl::OnIconsPathChanged(GVariant*)
-{
-  gproxy_.CallBegin("GetIconPaths", nullptr, [this] (GVariant* paths, glib::Error const& e) {
-    if (e || !paths)
-    {
-      LOG_ERROR(logger) << "Something went wrong on GetIconPaths: " << e;
-      return;
-    }
-
-    bool changed = false;
-    gsize length;
-    glib::Variant array(g_variant_get_child_value(paths, 0));
-    const gchar** icon_paths = g_variant_get_strv(array, &length);
-
-    if (icon_paths_.size() != length)
-    {
-      changed = true;
-    }
-    else
-    {
-      for (unsigned i = 0; i < length; ++i)
-      {
-        if (icon_paths_[i] != glib::gchar_to_string(icon_paths[i]))
-        {
-          changed = true;
-          break;
-        }
-      }
-    }
-
-    if (changed)
-    {
-      icon_paths_.resize(length);
-
-      for (unsigned i = 0; i < length; ++i)
-        icon_paths_[i] = glib::gchar_to_string(icon_paths[i]);
-
-      owner_->icon_paths_changed.emit();
-    }
-
-    g_free(icon_paths);
-  });
-}
-
 void DBusIndicators::Impl::OnEntryActivated(GVariant* parameters)
 {
   glib::String panel;
@@ -506,10 +458,5 @@
   pimpl->OnShowAppMenu(xid, x, y);
 }

-std::vector<std::string> const& DBusIndicators::IconPaths() const
-{
-  return pimpl->icon_paths_;
-}
-
 } // namespace indicator
 } // namespace unity

=== modified file 'UnityCore/DBusIndicators.h'
--- UnityCore/DBusIndicators.h	2014-02-28 05:16:10 +0000
+++ UnityCore/DBusIndicators.h	2014-01-28 11:50:02 +0000
@@ -38,7 +38,6 @@
   DBusIndicators();
   ~DBusIndicators();

-  std::vector<std::string> const& IconPaths() const;
   void ShowEntriesDropdown(Indicator::Entries const&, Entry::Ptr const&, unsigned xid, int x, int y);
   void SyncGeometries(std::string const& name, EntryLocationMap const& locations);


=== modified file 'UnityCore/GTKWrapper.h'
--- UnityCore/GTKWrapper.h	2014-02-26 23:21:06 +0000
+++ UnityCore/GTKWrapper.h	2013-05-17 16:52:19 +0000
@@ -29,7 +29,13 @@

 #if GTK_CHECK_VERSION(3, 8, 0)

-typedef glib::Object<GtkIconInfo> IconInfo;
+class IconInfo : public glib::Object<GtkIconInfo>
+{
+public:
+  IconInfo(GtkIconInfo *info = nullptr)
+    : glib::Object<GtkIconInfo>(info)
+  {}
+};

 #else


=== modified file 'UnityCore/Indicators.h'
--- UnityCore/Indicators.h	2014-02-28 05:16:10 +0000
+++ UnityCore/Indicators.h	2014-02-12 23:37:24 +0000
@@ -40,7 +40,6 @@
   virtual ~Indicators();

   IndicatorsList GetIndicators() const;
-  virtual std::vector<std::string> const& IconPaths() const = 0;

   virtual void SyncGeometries(std::string const& panel, EntryLocationMap const&) = 0;
   virtual void ShowEntriesDropdown(Indicator::Entries const&, Entry::Ptr const&, unsigned xid, int x, int y) = 0;
@@ -48,7 +47,6 @@
   // Signals
   sigc::signal<void, Indicator::Ptr const&> on_object_added;
   sigc::signal<void, Indicator::Ptr const&> on_object_removed;
-  sigc::signal<void> icon_paths_changed;

   /**
    * Service wants the view to activate an entry.

=== modified file 'dash/DashController.cpp'
--- dash/DashController.cpp	2014-02-27 05:30:25 +0000
+++ dash/DashController.cpp	2014-01-16 00:24:04 +0000
@@ -92,7 +92,7 @@
   }

   SetupWindow();
-  UScreen::GetDefault()->changed.connect([this] (int, std::vector<nux::Geometry> const&) { Relayout(true); });
+  UScreen::GetDefault()->changed.connect([this] (int, std::vector<nux::Geometry>&) { Relayout(true); });

   Settings::Instance().form_factor.changed.connect([this](FormFactor)
   {
@@ -249,7 +249,8 @@
   nux::Geometry geo = GetIdealWindowGeometry();
   view_->Relayout();
   window_->SetGeometry(geo);
-  view_->SetMonitorOffset(launcher_width, panel::Style::Instance().PanelHeight(monitor_));
+  panel::Style &panel_style = panel::Style::Instance();
+  view_->SetMonitorOffset(launcher_width, panel_style.PanelHeight(monitor_));
 }

 void Controller::OnMouseDownOutsideWindow(int x, int y,
@@ -298,8 +299,9 @@
   }

   monitor_ = GetIdealMonitor();
-  view_->SetMonitorOffset(launcher_width, panel::Style::Instance().PanelHeight(monitor_));
+
   view_->AboutToShow();
+
   FocusWindow();

   need_show_ = false;

=== modified file 'dash/DashView.cpp'
--- dash/DashView.cpp	2014-03-03 16:47:37 +0000
+++ dash/DashView.cpp	2014-02-20 21:37:37 +0000
@@ -36,6 +36,7 @@
 #include "unity-shared/DashStyle.h"
 #include "unity-shared/KeyboardUtil.h"
 #include "unity-shared/PreviewStyle.h"
+#include "unity-shared/PanelStyle.h"
 #include "unity-shared/UBusMessages.h"
 #include "unity-shared/UnitySettings.h"
 #include "unity-shared/WindowManager.h"
@@ -168,8 +169,6 @@
 {
   renderer_.x_offset = x;
   renderer_.y_offset = y;
-
-  top_space_->SetMinMaxSize(0, y);
 }

 bool DashView::IsCommandLensOpen() const
@@ -519,14 +518,14 @@
 void DashView::SetupViews()
 {
   dash::Style& style = dash::Style::Instance();
+  panel::Style &panel_style = panel::Style::Instance();
+  int panel_height = panel_style.PanelHeight();

   layout_ = new nux::VLayout();
   layout_->SetLeftAndRightPadding(style.GetVSeparatorSize(), 0);
   layout_->SetTopAndBottomPadding(style.GetHSeparatorSize(), 0);
   SetLayout(layout_);
-
-  top_space_ = new nux::SpaceLayout(0, 0, renderer_.y_offset(), renderer_.y_offset());
-  layout_->AddLayout(top_space_, 0);
+  layout_->AddLayout(new nux::SpaceLayout(0, 0, panel_height, panel_height), 0);

   content_layout_ = new DashLayout(NUX_TRACKER_LOCATION);
   content_layout_->SetTopAndBottomPadding(style.GetDashViewTopPadding(), 0);
@@ -612,7 +611,8 @@
 nux::Geometry DashView::GetBestFitGeometry(nux::Geometry const& for_geo)
 {
   dash::Style& style = dash::Style::Instance();
-  int panel_height = renderer_.y_offset;
+  panel::Style &panel_style = panel::Style::Instance();
+  int panel_height = panel_style.PanelHeight();

   int width = 0, height = 0;
   int tile_width = style.GetTileWidth();
@@ -649,25 +649,29 @@

 void DashView::Draw(nux::GraphicsEngine& graphics_engine, bool force_draw)
 {
+  panel::Style &panel_style = panel::Style::Instance();
   nux::Geometry const& renderer_geo_abs(GetRenderAbsoluteGeometry());
   nux::Geometry renderer_geo(GetGeometry());
-  renderer_geo.y += renderer_.y_offset;
-  renderer_geo.height += renderer_.y_offset;
+  int panel_height = panel_style.PanelHeight();
+
+  renderer_geo.y += panel_height;
+  renderer_geo.height += panel_height;

   renderer_.DrawFull(graphics_engine, content_geo_, renderer_geo_abs, renderer_geo, false);
 }

 void DashView::DrawContent(nux::GraphicsEngine& graphics_engine, bool force_draw)
 {
-  int renderer_y_offset = renderer_.y_offset();
+  panel::Style& panel_style = panel::Style::Instance();
+  int panel_height = panel_style.PanelHeight();

   nux::Geometry renderer_geo_abs(GetAbsoluteGeometry());
-  renderer_geo_abs.y += renderer_y_offset;
-  renderer_geo_abs.height -= renderer_y_offset;
+  renderer_geo_abs.y += panel_height;
+  renderer_geo_abs.height -= panel_height;

   nux::Geometry renderer_geo(GetGeometry());
-  renderer_geo.y += renderer_y_offset;
-  renderer_geo.height += renderer_y_offset;
+  renderer_geo.y += panel_height;
+  renderer_geo.height += panel_height;

   renderer_.DrawInner(graphics_engine, content_geo_, renderer_geo_abs, renderer_geo);

@@ -1688,9 +1692,12 @@

 nux::Geometry DashView::GetRenderAbsoluteGeometry() const
 {
+  panel::Style &panel_style = panel::Style::Instance();
+  int panel_height = panel_style.PanelHeight();
+
   nux::Geometry renderer_geo_abs(GetAbsoluteGeometry());
-  renderer_geo_abs.y += renderer_.y_offset;
-  renderer_geo_abs.height -= renderer_.y_offset;
+  renderer_geo_abs.y += panel_height;
+  renderer_geo_abs.height -= panel_height;
   return renderer_geo_abs;
 }


=== modified file 'dash/DashView.h'
--- dash/DashView.h	2014-02-25 21:36:34 +0000
+++ dash/DashView.h	2013-11-20 21:39:40 +0000
@@ -152,7 +152,6 @@
   SearchBar* search_bar_;
   nux::VLayout* scopes_layout_;
   ScopeBar* scope_bar_;
-  nux::SpaceLayout* top_space_;

   nux::ObjectPtr<ScopeView> active_scope_view_;
   nux::ObjectPtr<ScopeView> preview_scope_view_;

=== modified file 'decorations/DecoratedWindow.cpp'
--- decorations/DecoratedWindow.cpp	2014-02-27 05:30:25 +0000
+++ decorations/DecoratedWindow.cpp	2014-02-20 16:24:43 +0000
@@ -25,6 +25,7 @@
 #include "DecorationsTitle.h"
 #include "DecorationsSlidingLayout.h"
 #include "DecorationsMenuLayout.h"
+#include "RawPixel.h"
 #include "WindowManager.h"
 #include "UnitySettings.h"

@@ -92,7 +93,6 @@
     return true;
   });

-  parent->dpi_scale.SetGetterFunction([this] { return cv_->DPIScale(); });
   parent->scaled.changed.connect(sigc::hide(sigc::mem_fun(this, &Impl::Update)));

   if (win_->isViewable() || win_->shaded())
@@ -141,16 +141,16 @@
     return;

   auto const& sb = Style::Get()->Border();
-  CompWindowExtents border(cv_->CP(sb.left),
-                           cv_->CP(sb.right),
-                           cv_->CP(sb.top),
-                           cv_->CP(sb.bottom));
+  CompWindowExtents border(RawPixel(sb.left).CP(cv_),
+                           RawPixel(sb.right).CP(cv_),
+                           RawPixel(sb.top).CP(cv_),
+                           RawPixel(sb.bottom).CP(cv_));

   auto const& ib = Style::Get()->InputBorder();
-  CompWindowExtents input(cv_->CP(sb.left + ib.left),
-                          cv_->CP(sb.right + ib.right),
-                          cv_->CP(sb.top + ib.top),
-                          cv_->CP(sb.bottom + ib.bottom));
+  CompWindowExtents input(RawPixel(sb.left + ib.left).CP(cv_),
+                          RawPixel(sb.right + ib.right).CP(cv_),
+                          RawPixel(sb.top + ib.top).CP(cv_),
+                          RawPixel(sb.bottom + ib.bottom).CP(cv_));

   if (win_->border() != border || win_->input() != input)
     win_->setWindowFrameExtents(&border, &input);
@@ -292,11 +292,6 @@
     Decorate();
   });

-  dpi_changed_ = Settings::Instance().dpi_changed.connect([this] {
-    Update();
-    top_layout_->scale = cv_->DPIScale();
-  });
-
   input_mixer_ = std::make_shared<InputMixer>();

   if (win_->actions() & CompWindowActionResizeMask)
@@ -319,7 +314,7 @@
   top_layout_->right_padding = padding.right;
   top_layout_->top_padding = padding.top;
   top_layout_->focused = active();
-  top_layout_->scale = cv_->DPIScale();
+  top_layout_->scale = Settings::Instance().em(monitor_)->DPIScale();

   if (win_->actions() & CompWindowActionCloseMask)
     top_layout_->Append(std::make_shared<WindowButton>(win_, WindowButtonType::CLOSE));
@@ -358,7 +353,6 @@

   UnsetAppMenu();
   theme_changed_->disconnect();
-  dpi_changed_->disconnect();
   top_layout_.reset();
   input_mixer_.reset();
   edge_borders_.reset();
@@ -419,10 +413,9 @@

   if (deco_tex.quad.box.width() != geo.width || deco_tex.quad.box.height() != geo.height)
   {
-    double scale = top_layout_->scale();
-    cu::CairoContext ctx(geo.width, geo.height, scale);
+    cu::CairoContext ctx(geo.width, geo.height);
     auto ws = active() ? WidgetState::NORMAL : WidgetState::BACKDROP;
-    Style::Get()->DrawSide(s, ws, ctx, geo.width / scale, geo.height / scale);
+    Style::Get()->DrawSide(s, ws, ctx, geo.width, geo.height);
     deco_tex.SetTexture(ctx);
   }

@@ -770,7 +763,7 @@
   .add("active", impl_->active())
   .add("scaled", scaled())
   .add("monitor", impl_->monitor_)
-  .add("dpi_scale", dpi_scale())
+  .add("dpi_scale", impl_->cv_->DPIScale())
   .add("xid", impl_->win_->id())
   .add("fully_decorable", cu::IsWindowFullyDecorable(impl_->win_))
   .add("shadow_decorable", cu::IsWindowShadowDecorable(impl_->win_))

=== modified file 'decorations/DecoratedWindow.h'
--- decorations/DecoratedWindow.h	2014-02-24 17:55:50 +0000
+++ decorations/DecoratedWindow.h	2014-02-19 02:16:22 +0000
@@ -43,7 +43,6 @@

   nux::RWProperty<std::string> title;
   nux::Property<bool> scaled;
-  nux::ROProperty<double> dpi_scale;

   void Update();
   void Undecorate();

=== modified file 'decorations/DecorationsDataPool.cpp'
--- decorations/DecorationsDataPool.cpp	2014-02-27 07:03:31 +0000
+++ decorations/DecorationsDataPool.cpp	2014-01-16 17:43:36 +0000
@@ -22,8 +22,6 @@
 #include <sigc++/adaptors/hide.h>
 #include "glow_texture.h"
 #include "DecorationsDataPool.h"
-#include "UnitySettings.h"
-#include "UScreen.h"

 namespace unity
 {
@@ -71,12 +69,8 @@
   SetupCursors();
   SetupTextures();

-  CompSize glow_size(texture::GLOW_SIZE, texture::GLOW_SIZE);
-  glow_texture_ = std::make_shared<cu::SimpleTexture>(GLTexture::imageDataToTexture(texture::GLOW, glow_size, GL_RGBA, GL_UNSIGNED_BYTE));
-
-  auto cb = sigc::mem_fun(this, &DataPool::SetupTextures);
-  Style::Get()->theme.changed.connect(sigc::hide(cb));
-  unity::Settings::Instance().dpi_changed.connect(cb);
+  auto cb = sigc::hide(sigc::mem_fun(this, &DataPool::SetupTextures));
+  Style::Get()->theme.changed.connect(cb);
 }

 DataPool::~DataPool()
@@ -104,63 +98,37 @@

 void DataPool::SetupTextures()
 {
+  CompSize size;
+  CompString plugin_name(PLUGIN_NAME);
   auto const& style = Style::Get();
-  unsigned monitors = UScreen::GetDefault()->GetPluggedMonitorsNumber();
-  auto& settings = Settings::Instance();
-  bool found_normal = false;
-  nux::Size size;
-
-  scaled_window_buttons_.clear();
-
-  for (unsigned monitor = 0; monitor < monitors; ++monitor)
+
+  for (unsigned button = 0; button < window_buttons_.size(); ++button)
   {
-    double scale = settings.em(monitor)->DPIScale();
-    bool scaled = (scale != 1.0f);
-
-    if (!scaled)
-    {
-      if (found_normal)
-        continue;
-
-      found_normal = true;
-    }
-
-    auto& destination = scaled ? scaled_window_buttons_[scale] : window_buttons_;
-
-    for (unsigned button = 0; button < window_buttons_.size(); ++button)
-    {
-      for (unsigned state = 0; state < window_buttons_[button].size(); ++state)
-      {
-        glib::Error error;
-        auto const& file = style->WindowButtonFile(WindowButtonType(button), WidgetState(state));
-        gdk_pixbuf_get_file_info(file.c_str(), &size.width, &size.height);
-
-        size.width = std::round(size.width * scale);
-        size.height = std::round(size.height * scale);
-        glib::Object<GdkPixbuf> pixbuf(gdk_pixbuf_new_from_file_at_size(file.c_str(), size.width, size.height, &error));
-
-        if (pixbuf)
-        {
-          LOG_DEBUG(logger) << "Loading texture " << file;
-          cu::CairoContext ctx(size.width, size.height);
-          gdk_cairo_set_source_pixbuf(ctx, pixbuf, 0, 0);
-          cairo_paint(ctx);
-          destination[button][state] = ctx;
-        }
-        else
-        {
-          LOG_WARN(logger) << "Impossible to load local button texture file: "
-                           << error << "; falling back to cairo generated one.";
-
-          int button_size = std::round((BUTTONS_SIZE + BUTTONS_PADDING * 2) * scale);
-          cu::CairoContext ctx(button_size, button_size, scale);
-          cairo_translate(ctx, BUTTONS_PADDING, BUTTONS_PADDING);
-          style->DrawWindowButton(WindowButtonType(button), WidgetState(state), ctx, BUTTONS_SIZE, BUTTONS_SIZE);
-          destination[button][state] = ctx;
-        }
+    for (unsigned state = 0; state < window_buttons_[button].size(); ++state)
+    {
+      auto file = style->WindowButtonFile(WindowButtonType(button), WidgetState(state));
+      auto const& tex_list = GLTexture::readImageToTexture(file, plugin_name, size);
+
+      if (!tex_list.empty())
+      {
+        LOG_DEBUG(logger) << "Loading texture " << file;
+        window_buttons_[button][state] = std::make_shared<cu::SimpleTexture>(tex_list);
+      }
+      else
+      {
+        LOG_WARN(logger) << "Impossible to load local button texture file; "
+                         << "falling back to cairo generated one";
+
+        cu::CairoContext ctx(BUTTONS_SIZE + BUTTONS_PADDING*2, BUTTONS_SIZE + BUTTONS_PADDING*2);
+        cairo_translate(ctx, BUTTONS_PADDING, BUTTONS_PADDING);
+        style->DrawWindowButton(WindowButtonType(button), WidgetState(state), ctx, BUTTONS_SIZE, BUTTONS_SIZE);
+        window_buttons_[button][state] = ctx;
       }
     }
   }
+
+  CompSize glow_size(texture::GLOW_SIZE, texture::GLOW_SIZE);
+  glow_texture_ = std::make_shared<cu::SimpleTexture>(GLTexture::imageDataToTexture(texture::GLOW, glow_size, GL_RGBA, GL_UNSIGNED_BYTE));
 }

 cu::SimpleTexture::Ptr const& DataPool::GlowTexture() const
@@ -181,26 +149,5 @@
   return window_buttons_[unsigned(wbt)][unsigned(ws)];
 }

-cu::SimpleTexture::Ptr const& DataPool::ButtonTexture(double scale, WindowButtonType wbt, WidgetState ws) const
-{
-  if (wbt >= WindowButtonType::Size || ws >= WidgetState::Size)
-  {
-    LOG_ERROR(logger) << "It has been requested an invalid button texture "
-                      << "WindowButtonType: " << unsigned(wbt) << ", WidgetState: "
-                      << unsigned(ws);
-    return EMPTY_BUTTON;
-  }
-
-  if (scale == 1.0f)
-    return window_buttons_[unsigned(wbt)][unsigned(ws)];
-
-  auto it = scaled_window_buttons_.find(scale);
-
-  if (it == scaled_window_buttons_.end())
-    return EMPTY_BUTTON;
-
-  return it->second[unsigned(wbt)][unsigned(ws)];
-}
-
 } // decoration namespace
 } // unity namespace

=== modified file 'decorations/DecorationsDataPool.h'
--- decorations/DecorationsDataPool.h	2014-02-27 07:03:31 +0000
+++ decorations/DecorationsDataPool.h	2014-01-16 17:43:36 +0000
@@ -20,7 +20,6 @@
 #ifndef UNITY_DECORATIONS_DATA_POOL
 #define UNITY_DECORATIONS_DATA_POOL

-#include <unordered_map>
 #include "DecorationStyle.h"
 #include "DecorationsEdge.h"

@@ -40,7 +39,6 @@
   Cursor EdgeCursor(Edge::Type) const;
   cu::SimpleTexture::Ptr const& GlowTexture() const;
   cu::SimpleTexture::Ptr const& ButtonTexture(WindowButtonType, WidgetState) const;
-  cu::SimpleTexture::Ptr const& ButtonTexture(double scale, WindowButtonType, WidgetState) const;

 private:
   DataPool();
@@ -52,10 +50,7 @@

   std::array<Cursor, size_t(Edge::Type::Size)> edge_cursors_;
   cu::SimpleTexture::Ptr glow_texture_;
-
-  typedef std::array<std::array<cu::SimpleTexture::Ptr, size_t(WidgetState::Size)>, size_t(WindowButtonType::Size)> WindowButtonsArray;
-  WindowButtonsArray window_buttons_;
-  std::unordered_map<double, WindowButtonsArray> scaled_window_buttons_;
+  std::array<std::array<cu::SimpleTexture::Ptr, size_t(WidgetState::Size)>, size_t(WindowButtonType::Size)> window_buttons_;
 };

 } // decoration namespace

=== modified file 'decorations/DecorationsMenuDropdown.cpp'
--- decorations/DecorationsMenuDropdown.cpp	2014-02-24 23:53:50 +0000
+++ decorations/DecorationsMenuDropdown.cpp	2014-02-13 00:48:21 +0000
@@ -75,12 +75,15 @@
   if (std::find(children_.begin(), children_.end(), child) != children_.end())
     return;

-  int size_diff = (child->GetNaturalHeight() - GetNaturalHeight()) / scale();
-
-  if (size_diff > 0)
+  if (children_.empty())
   {
-    natural_.height += (size_diff % 2);
-    vertical_padding = vertical_padding() + (size_diff / 2);
+    int size_diff = child->GetNaturalHeight() - GetNaturalHeight();
+
+    if (size_diff > 0)
+    {
+      natural_.height += (size_diff % 2);
+      vertical_padding = vertical_padding() + (size_diff / 2);
+    }
   }

   children_.push_front(child);
@@ -119,17 +122,14 @@
 void MenuDropdown::RenderTexture()
 {
   WidgetState state = active() ? WidgetState::PRELIGHT : WidgetState::NORMAL;
-  cu::CairoContext icon_ctx(GetNaturalWidth(), GetNaturalHeight(), scale());
+  cu::CairoContext icon_ctx(GetNaturalWidth(), GetNaturalHeight());

   if (state == WidgetState::PRELIGHT)
-    Style::Get()->DrawMenuItem(state, icon_ctx, icon_ctx.width() / scale(), icon_ctx.height() / scale());
+    Style::Get()->DrawMenuItem(state, icon_ctx, icon_ctx.width(), icon_ctx.height());

   cairo_save(icon_ctx);
   cairo_translate(icon_ctx, horizontal_padding(), vertical_padding());
-  cairo_save(icon_ctx);
-  cairo_scale(icon_ctx, 1.0f/scale(), 1.0f/scale());
-  Style::Get()->DrawMenuItemIcon(ICON_NAME, state, icon_ctx, ICON_SIZE * scale());
-  cairo_restore(icon_ctx);
+  Style::Get()->DrawMenuItemIcon(ICON_NAME, state, icon_ctx, ICON_SIZE);
   cairo_restore(icon_ctx);
   SetTexture(icon_ctx);
 }

=== modified file 'decorations/DecorationsMenuEntry.cpp'
--- decorations/DecorationsMenuEntry.cpp	2014-02-24 16:00:02 +0000
+++ decorations/DecorationsMenuEntry.cpp	2014-02-14 19:01:49 +0000
@@ -41,7 +41,6 @@
   entry_->updated.connect(sigc::mem_fun(this, &MenuEntry::EntryUpdated));
   horizontal_padding.changed.connect(sigc::hide(sigc::mem_fun(this, &MenuEntry::RenderTexture)));
   vertical_padding.changed.connect(sigc::hide(sigc::mem_fun(this, &MenuEntry::RenderTexture)));
-  scale.changed.connect(sigc::hide(sigc::mem_fun(this, &MenuEntry::RenderTexture)));
   in_dropdown.changed.connect([this] (bool in) { visible = entry_->visible() && !in; });
   EntryUpdated();
 }
@@ -72,10 +71,10 @@
     state = WidgetState::PRELIGHT;

   natural_ = Style::Get()->MenuItemNaturalSize(entry_->label());
-  cu::CairoContext text_ctx(GetNaturalWidth(), GetNaturalHeight(), scale());
+  cu::CairoContext text_ctx(GetNaturalWidth(), GetNaturalHeight());

   if (state == WidgetState::PRELIGHT)
-    Style::Get()->DrawMenuItem(state, text_ctx, text_ctx.width() / scale(), text_ctx.height() / scale());
+    Style::Get()->DrawMenuItem(state, text_ctx, text_ctx.width(), text_ctx.height());

   cairo_save(text_ctx);
   cairo_translate(text_ctx, horizontal_padding(), vertical_padding());
@@ -96,12 +95,12 @@

 int MenuEntry::GetNaturalWidth() const
 {
-  return (natural_.width + horizontal_padding() * 2) * scale();
+  return natural_.width + horizontal_padding() * 2;
 }

 int MenuEntry::GetNaturalHeight() const
 {
-  return (natural_.height + vertical_padding() * 2) * scale();
+  return natural_.height + vertical_padding() * 2;
 }

 void MenuEntry::ButtonDownEvent(CompPoint const& p, unsigned button, Time timestamp)

=== modified file 'decorations/DecorationsMenuLayout.cpp'
--- decorations/DecorationsMenuLayout.cpp	2014-02-26 00:14:46 +0000
+++ decorations/DecorationsMenuLayout.cpp	2014-02-13 03:33:02 +0000
@@ -63,7 +63,6 @@
     menu->active.changed.connect(active_cb);
     menu->show_now.changed.connect(show_now_cb);
     menu->focused = focused();
-    menu->scale = scale();
     menu->SetParent(shared_from_this());
     items_.push_back(menu);
   }
@@ -186,13 +185,8 @@

 void MenuLayout::DoRelayout()
 {
-  float scale = this->scale();
-  int inner_padding = this->inner_padding().CP(scale);
-  int left_padding = this->left_padding().CP(scale);
-  int right_padding = this->right_padding().CP(scale);
-
   int dropdown_width = dropdown_->GetNaturalWidth();
-  int accumolated_width = dropdown_width + left_padding + right_padding - inner_padding;
+  int accumolated_width = dropdown_width + left_padding() + right_padding() - inner_padding();
   int max_width = max_.width;
   std::list<MenuEntry::Ptr> to_hide;

@@ -201,7 +195,7 @@
     if (!item->visible() || item == dropdown_)
       continue;

-    accumolated_width += item->GetNaturalWidth() + inner_padding;
+    accumolated_width += item->GetNaturalWidth() + inner_padding();

     if (accumolated_width > max_width)
       to_hide.push_front(std::static_pointer_cast<MenuEntry>(item));

=== modified file 'decorations/DecorationsPriv.h'
--- decorations/DecorationsPriv.h	2014-02-23 21:55:29 +0000
+++ decorations/DecorationsPriv.h	2014-02-19 02:16:22 +0000
@@ -126,7 +126,6 @@
   nux::Geometry frame_geo_;
   CompRegion frame_region_;
   connection::Wrapper theme_changed_;
-  connection::Wrapper dpi_changed_;
   connection::Wrapper grab_mouse_changed_;
   std::string last_title_;
   std::vector<cu::SimpleTextureQuad> bg_textures_;

=== modified file 'decorations/DecorationsSlidingLayout.cpp'
--- decorations/DecorationsSlidingLayout.cpp	2014-02-24 15:50:23 +0000
+++ decorations/DecorationsSlidingLayout.cpp	2014-02-19 00:01:16 +0000
@@ -88,7 +88,6 @@
   {
     input_item_->SetParent(shared_from_this());
     input_item_->focused = focused();
-    input_item_->scale = scale();
   }

   Relayout();

=== modified file 'decorations/DecorationsTitle.cpp'
--- decorations/DecorationsTitle.cpp	2014-02-24 16:00:02 +0000
+++ decorations/DecorationsTitle.cpp	2014-01-20 18:10:44 +0000
@@ -30,7 +30,6 @@
 {
   text.changed.connect(sigc::mem_fun(this, &Title::OnTextChanged));
   focused.changed.connect(sigc::hide(sigc::mem_fun(this, &Title::RenderTexture)));
-  scale.changed.connect([this] (double) { text.changed.emit(text()); });
   Style::Get()->title_font.changed.connect(sigc::mem_fun(this, &Title::OnFontChanged));
 }

@@ -38,8 +37,6 @@
 {
   bool damaged = false;
   auto real_size = Style::Get()->TitleNaturalSize(new_text);
-  real_size.width *= scale();
-  real_size.height *= scale();

   if (GetNaturalWidth() > real_size.width || GetNaturalHeight() > real_size.height)
   {
@@ -62,8 +59,8 @@
 void Title::RenderTexture()
 {
   auto state = focused() ? WidgetState::NORMAL : WidgetState::BACKDROP;
-  cu::CairoContext text_ctx(texture_size_.width, texture_size_.height, scale());
-  Style::Get()->DrawTitle(text(), state, text_ctx, texture_size_.width / scale(), texture_size_.height / scale());
+  cu::CairoContext text_ctx(texture_size_.width, texture_size_.height);
+  Style::Get()->DrawTitle(text(), state, text_ctx, texture_size_.width, texture_size_.height);
   SetTexture(text_ctx);
 }


=== modified file 'decorations/DecorationsWidgets.cpp'
--- decorations/DecorationsWidgets.cpp	2014-02-27 07:10:31 +0000
+++ decorations/DecorationsWidgets.cpp	2014-02-19 00:01:16 +0000
@@ -226,6 +226,17 @@

 //

+TexturedItem::TexturedItem()
+{
+  scale.changed.connect([this] (float s) {
+    if (texture_.SetScale(s))
+    {
+      geo_parameters_changed.emit();
+      Damage();
+    }
+  });
+}
+
 void TexturedItem::SetTexture(cu::SimpleTexture::Ptr const& tex)
 {
   auto prev_geo = Geometry();
@@ -263,12 +274,12 @@

 int TexturedItem::GetNaturalWidth() const
 {
-  return (texture_) ? texture_.st->width() : Item::GetNaturalWidth();
+  return (texture_) ? texture_.st->width() * scale() : Item::GetNaturalWidth();
 }

 int TexturedItem::GetNaturalHeight() const
 {
-  return (texture_) ? texture_.st->height() : Item::GetNaturalHeight();
+  return (texture_) ? texture_.st->height() * scale() : Item::GetNaturalHeight();
 }

 CompRect& TexturedItem::InternalGeo()
@@ -376,14 +387,8 @@

 CompRect Layout::ContentGeometry() const
 {
-  float scale = this->scale();
-  int left_padding = this->left_padding().CP(scale);
-  int right_padding = this->right_padding().CP(scale);
-  int top_padding = this->top_padding().CP(scale);
-  int bottom_padding = this->bottom_padding().CP(scale);
-
-  return CompRect(rect_.x() + min(left_padding, rect_.width()),
-                  rect_.y() + min(top_padding, rect_.height()),
+  return CompRect(rect_.x() + min(left_padding(), rect_.width()),
+                  rect_.y() + min(top_padding(), rect_.height()),
                   clamp_size(rect_.width() - left_padding - right_padding),
                   clamp_size(rect_.height() - top_padding - bottom_padding));
 }
@@ -391,19 +396,13 @@
 void Layout::DoRelayout()
 {
   int loop = 0;
-  float scale = this->scale();
-  int inner_padding = this->inner_padding().CP(scale);
-  int left_padding = this->left_padding().CP(scale);
-  int right_padding = this->right_padding().CP(scale);
-  int top_padding = this->top_padding().CP(scale);
-  int bottom_padding = this->bottom_padding().CP(scale);

   nux::Size available_space(clamp_size(max_.width - left_padding - right_padding),
                             clamp_size(max_.height - top_padding - bottom_padding));

   do
   {
-    nux::Size content(min(left_padding, max_.width), 0);
+    nux::Size content(min(left_padding(), max_.width), 0);

     for (auto const& item : items_)
     {
@@ -429,7 +428,7 @@
     if (!items_.empty() && content.width > inner_padding)
       content.width -= inner_padding;

-    int actual_right_padding = max(0, min(right_padding, max_.width - content.width));
+    int actual_right_padding = max(0, min(right_padding(), max_.width - content.width));
     int vertical_padding = top_padding + bottom_padding;

     content.width += actual_right_padding;
@@ -491,7 +490,7 @@
   }
 }

-bool Layout::SetPadding(RawPixel& target, RawPixel const& new_value)
+bool Layout::SetPadding(int& target, int new_value)
 {
   int padding = clamp_size(new_value);


=== modified file 'decorations/DecorationsWidgets.h'
--- decorations/DecorationsWidgets.h	2014-02-27 07:10:31 +0000
+++ decorations/DecorationsWidgets.h	2014-02-19 00:01:16 +0000
@@ -26,7 +26,6 @@
 #include <UnityCore/UWeakPtr.h>
 #include "Introspectable.h"
 #include "CompizUtils.h"
-#include "RawPixel.h"

 namespace unity
 {
@@ -50,7 +49,7 @@
   nux::Property<bool> focused;
   nux::Property<bool> sensitive;
   nux::Property<bool> mouse_owner;
-  nux::Property<double> scale;
+  nux::Property<float> scale;

   CompRect const& Geometry() const;
   virtual int GetNaturalWidth() const;
@@ -121,6 +120,8 @@
 public:
   typedef std::shared_ptr<TexturedItem> Ptr;

+  TexturedItem();
+
   void SetTexture(cu::SimpleTexture::Ptr const&);
   void Draw(GLWindow*, GLMatrix const&, GLWindowPaintAttrib const&, CompRegion const&, unsigned mask);
   void SetCoords(int x, int y);
@@ -170,11 +171,11 @@

   Layout();

-  nux::Property<RawPixel> inner_padding;
-  nux::Property<RawPixel> left_padding;
-  nux::Property<RawPixel> right_padding;
-  nux::Property<RawPixel> top_padding;
-  nux::Property<RawPixel> bottom_padding;
+  nux::Property<int> inner_padding;
+  nux::Property<int> left_padding;
+  nux::Property<int> right_padding;
+  nux::Property<int> top_padding;
+  nux::Property<int> bottom_padding;

   void Append(Item::Ptr const&);
   void Remove(Item::Ptr const&);
@@ -188,7 +189,7 @@
   void DoRelayout();

 private:
-  bool SetPadding(RawPixel& target, RawPixel const& new_value);
+  bool SetPadding(int& target, int new_value);
 };

 } // decoration namespace

=== modified file 'decorations/DecorationsWindowButton.cpp'
--- decorations/DecorationsWindowButton.cpp	2014-02-27 07:11:16 +0000
+++ decorations/DecorationsWindowButton.cpp	2014-02-19 02:16:22 +0000
@@ -38,13 +38,12 @@
   auto cb = sigc::hide(sigc::mem_fun(this, &WindowButton::UpdateTexture));
   mouse_owner.changed.connect(cb);
   focused.changed.connect(cb);
-  scale.changed.connect(cb);
   UpdateTexture();
 }

 void WindowButton::UpdateTexture()
 {
-  SetTexture(DataPool::Get()->ButtonTexture(scale(), type_, GetCurrentState()));
+  SetTexture(DataPool::Get()->ButtonTexture(type_, GetCurrentState()));
 }

 WidgetState WindowButton::GetCurrentState() const

=== modified file 'hud/HudController.cpp'
--- hud/HudController.cpp	2014-02-27 05:30:25 +0000
+++ hud/HudController.cpp	2014-02-17 17:55:29 +0000
@@ -76,7 +76,7 @@
   }

   SetupWindow();
-  UScreen::GetDefault()->changed.connect([this] (int, std::vector<nux::Geometry> const&) { Relayout(true); });
+  UScreen::GetDefault()->changed.connect([this] (int, std::vector<nux::Geometry>&) { Relayout(true); });

   ubus.RegisterInterest(UBUS_HUD_CLOSE_REQUEST, sigc::mem_fun(this, &Controller::OnExternalHideHud));


=== modified file 'launcher/CairoBaseWindow.cpp'
--- launcher/CairoBaseWindow.cpp	2014-02-25 18:41:37 +0000
+++ launcher/CairoBaseWindow.cpp	2014-02-19 14:01:02 +0000
@@ -54,10 +54,7 @@
   fade_animator_.updated.connect(sigc::mem_fun(this, &BaseWindow::SetOpacity));
   fade_animator_.finished.connect([this] {
     if (animation::GetDirection(fade_animator_) == animation::Direction::BACKWARD)
-    {
       ShowWindow(false);
-      hidden.emit();
-    }
   });
 }


=== modified file 'launcher/CairoBaseWindow.h'
--- launcher/CairoBaseWindow.h	2014-02-25 18:41:37 +0000
+++ launcher/CairoBaseWindow.h	2014-02-19 14:01:02 +0000
@@ -32,6 +32,7 @@
   NUX_DECLARE_OBJECT_TYPE(CairoBaseWindow, nux::BaseWindow);
 public:
   CairoBaseWindow(int monitor = 0);
+  virtual ~CairoBaseWindow() = default;

   virtual void Show();
   virtual void Hide();
@@ -39,8 +40,6 @@
   void RedrawBlur();
   bool HasBlurredBackground() const;

-  sigc::signal<void> hidden;
-
 protected:
   void Draw(nux::GraphicsEngine& gfxContext, bool forceDraw);


=== modified file 'launcher/EdgeBarrierController.cpp'
--- launcher/EdgeBarrierController.cpp	2014-02-27 05:30:25 +0000
+++ launcher/EdgeBarrierController.cpp	2013-11-14 03:00:29 +0000
@@ -87,7 +87,7 @@
   ResizeBarrierList(monitors);

   /* FIXME: Back to c++11 lambda once we get sigc::track_obj.
-  uscreen->changed.connect(sigc::track_obj(([this](int primary, std::vector<nux::Geometry> const& layout) {
+  uscreen->changed.connect(sigc::track_obj(([this](int primary, std::vector<nux::Geometry>& layout) {
     ResizeBarrierList(layout);
     SetupBarriers(layout);
   }));*/
@@ -123,7 +123,7 @@
   nux::GetGraphicsDisplay()->RemoveEventFilter(this);
 }

-void EdgeBarrierController::Impl::OnUScreenChanged(int primary, std::vector<nux::Geometry> const& layout)
+void EdgeBarrierController::Impl::OnUScreenChanged(int primary, std::vector<nux::Geometry>& layout)
 {
   ResizeBarrierList(layout);
   SetupBarriers(layout);

=== modified file 'launcher/EdgeBarrierControllerPrivate.h'
--- launcher/EdgeBarrierControllerPrivate.h	2014-02-27 05:30:25 +0000
+++ launcher/EdgeBarrierControllerPrivate.h	2013-09-23 20:07:45 +0000
@@ -41,7 +41,7 @@
   void ResizeBarrierList(std::vector<nux::Geometry> const& layout);
   void SetupBarriers(std::vector<nux::Geometry> const& layout);

-  void OnUScreenChanged(int primary, std::vector<nux::Geometry> const& layout);
+  void OnUScreenChanged(int primary, std::vector<nux::Geometry>& layout);
   void OnOptionsChanged();

   void OnPointerBarrierEvent(PointerBarrierWrapper* owner, BarrierEvent::Ptr const& event);

=== modified file 'launcher/Launcher.cpp'
--- launcher/Launcher.cpp	2014-02-27 01:18:35 +0000
+++ launcher/Launcher.cpp	2014-02-18 20:41:58 +0000
@@ -145,8 +145,9 @@
   , cv_(unity::Settings::Instance().em(monitor))
 {
   icon_renderer_->monitor = monitor();
-  icon_renderer_->scale = cv_->DPIScale();
-  icon_renderer_->SetTargetSize(icon_size_.CP(cv_), DEFAULT_ICON_SIZE.CP(cv_), SPACE_BETWEEN_ICONS.CP(cv_));
+  icon_renderer_->SetTargetSize(icon_size_.CP(cv_),
+                                DEFAULT_ICON_SIZE.CP(cv_),
+                                SPACE_BETWEEN_ICONS.CP(cv_));

   CaptureMouseDownAnyWhereElse(true);
   SetAcceptKeyNavFocusOnMouseDown(false);
@@ -253,7 +254,7 @@
   .add("quicklist-open", hide_machine_.GetQuirk(LauncherHideMachine::QUICKLIST_OPEN))
   .add("hide-quirks", hide_machine_.DebugHideQuirks())
   .add("hover-quirks", hover_machine_.DebugHoverQuirks())
-  .add("icon-size", icon_size_.CP(cv_))
+  .add("icon-size", icon_size_)
   .add("shortcuts_shown", shortcuts_shown_)
   .add("tooltip-shown", active_tooltip_ != nullptr);
 }
@@ -329,7 +330,7 @@

 void Launcher::OnDPIChanged()
 {
-  monitor.changed.emit(monitor());
+  UpdateOptions(options());
 }

 void Launcher::SetDndDelta(float x, float y, nux::Geometry const& geo)
@@ -1199,11 +1200,11 @@
   unity::panel::Style &panel_style = panel::Style::Instance();
   int panel_height = panel_style.PanelHeight(new_monitor);

+  Resize(nux::Point(monitor_geo.x, monitor_geo.y + panel_height),
+         monitor_geo.height - panel_height);
+  icon_renderer_->monitor = new_monitor;
+
   cv_ = unity::Settings::Instance().em(monitor);
-  Resize(nux::Point(monitor_geo.x, monitor_geo.y + panel_height), monitor_geo.height - panel_height);
-
-  icon_renderer_->monitor = new_monitor;
-  SetIconSize(options()->tile_size, options()->icon_size);
 }

 void Launcher::UpdateOptions(Options::Ptr options)
@@ -1491,9 +1492,11 @@
   ui::IconRenderer::DestroyShortcutTextures();

   icon_size_ = tile_size;
-  icon_renderer_->scale = cv_->DPIScale();
-  icon_renderer_->SetTargetSize(icon_size_.CP(cv_), RawPixel(icon_size).CP(cv_), SPACE_BETWEEN_ICONS.CP(cv_));
-  AbstractLauncherIcon::icon_size = icon_size_;
+  icon_renderer_->SetTargetSize(icon_size_.CP(cv_),
+                                RawPixel(icon_size).CP(cv_),
+                                SPACE_BETWEEN_ICONS.CP(cv_));
+
+  AbstractLauncherIcon::icon_size = icon_size_.CP(cv_);

   nux::Geometry const& parent_geo = parent_->GetGeometry();
   Resize(nux::Point(parent_geo.x, parent_geo.y), parent_geo.height);

=== modified file 'launcher/LauncherController.cpp'
--- launcher/LauncherController.cpp	2014-03-03 16:47:37 +0000
+++ launcher/LauncherController.cpp	2014-02-26 21:27:13 +0000
@@ -127,7 +127,7 @@

   UScreen* uscreen = UScreen::GetDefault();
   EnsureLaunchers(uscreen->GetPrimaryMonitor(), uscreen->GetMonitors());
-  uscreen->changed.connect(sigc::mem_fun(this, &Controller::Impl::EnsureLaunchers));
+
   SetupIcons();

   remote_model_.entry_added.connect(sigc::mem_fun(this, &Impl::OnLauncherEntryRemoteAdded));
@@ -149,6 +149,8 @@
     hud->SetHideMode(mode);
   });

+  uscreen->changed.connect(sigc::mem_fun(this, &Controller::Impl::OnScreenChanged));
+
   WindowManager& wm = WindowManager::Default();
   wm.window_focus_changed.connect(sigc::mem_fun(this, &Controller::Impl::OnWindowFocusChanged));
   wm.viewport_layout_changed.connect(sigc::group(sigc::mem_fun(this, &Controller::Impl::UpdateNumWorkspaces), sigc::_1 * sigc::_2));
@@ -169,6 +171,8 @@
     }
   });

+  unity::Settings::Instance().dpi_changed.connect(sigc::mem_fun(this, &Controller::Impl::OnDPIChanged));
+
   parent_->AddChild(model_.get());

   xdnd_manager_->dnd_started.connect(sigc::mem_fun(this, &Impl::OnDndStarted));
@@ -250,6 +254,11 @@
   launchers.resize(num_launchers);
 }

+void Controller::Impl::OnScreenChanged(int primary_monitor, std::vector<nux::Geometry>& monitors)
+{
+  EnsureLaunchers(primary_monitor, monitors);
+}
+
 void Controller::Impl::OnWindowFocusChanged(guint32 xid)
 {
   static bool keynav_first_focus = false;
@@ -544,6 +553,22 @@
   }
 }

+void Controller::Impl::OnDPIChanged()
+{
+  for (auto const& launcher_ptr : launchers)
+  {
+    if (launcher_ptr)
+    {
+      nux::Geometry const& parent_geo = launcher_ptr->GetParent()->GetGeometry();
+      int monitor = launcher_ptr->monitor();
+      int height  = panel::Style::Instance().PanelHeight(monitor);
+      int diff    = height - parent_geo.y;
+
+      launcher_ptr->Resize(nux::Point(parent_geo.x, parent_geo.y + diff), parent_geo.height - diff);
+    }
+  }
+}
+
 void Controller::Impl::OnIconRemoved(AbstractLauncherIcon::Ptr const& icon)
 {
   SortAndUpdate();

=== modified file 'launcher/LauncherControllerPrivate.h'
--- launcher/LauncherControllerPrivate.h	2014-02-27 05:30:25 +0000
+++ launcher/LauncherControllerPrivate.h	2014-02-18 20:22:05 +0000
@@ -98,6 +98,8 @@

   void EnsureLaunchers(int primary, std::vector<nux::Geometry> const& monitors);

+  void OnScreenChanged(int primary_monitor, std::vector<nux::Geometry>& monitors);
+
   void OnWindowFocusChanged (guint32 xid);

   void OnApplicationStarted(ApplicationPtr const& app);
@@ -117,6 +119,8 @@
   void OnDndMonitorChanged(std::string const& data, int old_monitor, int new_monitor);
   GVariant* OnDBusMethodCall(std::string const& method, GVariant *parameters);

+  void OnDPIChanged();
+
   Controller* parent_;
   LauncherModel::Ptr model_;
   nux::ObjectPtr<Launcher> launcher_;

=== modified file 'launcher/LauncherIcon.cpp'
--- launcher/LauncherIcon.cpp	2014-02-25 18:41:37 +0000
+++ launcher/LauncherIcon.cpp	2014-02-19 02:16:22 +0000
@@ -99,6 +99,9 @@
   mouse_up.connect(sigc::mem_fun(this, &LauncherIcon::RecvMouseUp));
   mouse_click.connect(sigc::mem_fun(this, &LauncherIcon::RecvMouseClick));

+  unity::Settings::Instance().dpi_changed.connect(sigc::mem_fun(this, &LauncherIcon::LoadTooltip));
+  unity::Settings::Instance().dpi_changed.connect(sigc::mem_fun(this, &LauncherIcon::LoadQuicklist));
+
   for (unsigned i = 0; i < monitors::MAX; ++i)
   {
     for (unsigned j = 0; j < static_cast<unsigned>(Quirk::LAST); ++j)
@@ -121,7 +124,6 @@
   _tooltip = new Tooltip(monitor);
   _tooltip->SetOpacity(0.0f);
   _tooltip->text = tooltip_text();
-  _tooltip->hidden.connect([this] { _tooltip.Release(); });
   debug::Introspectable::AddChild(_tooltip.GetPointer());
 }

@@ -132,7 +134,6 @@
     monitor = 0;

   _quicklist = new QuicklistView(monitor);
-  _quicklist->hidden.connect([this] { _quicklist.Release(); });
   debug::Introspectable::AddChild(_quicklist.GetPointer());

   _quicklist->mouse_down_outside_pointer_grab_area.connect([this] (int x, int y, unsigned long button_flags, unsigned long key_flags)
@@ -477,8 +478,7 @@

 nux::Point LauncherIcon::GetTipPosition(int monitor) const
 {
-  auto const& converter = Settings::Instance().em(monitor);
-  return nux::Point(_center[monitor].x + converter->CP(icon_size()) / 2 + 1, _center[monitor].y);
+  return nux::Point(_center[monitor].x + icon_size()/2 + 1, _center[monitor].y);
 }

 void LauncherIcon::ShowTooltip()
@@ -514,17 +514,20 @@
 {
   MenuItemsVector const& menus = Menus();

+  if (!_quicklist)
+    LoadQuicklist();
+
   if (menus.empty())
     return false;

-  LoadQuicklist();
-
   if (_tooltip)
   {
     // Hide the tooltip without fade animation
     _tooltip->ShowWindow(false);
   }

+  _quicklist->RemoveAllMenuItem();
+
   for (auto const& menu_item : menus)
   {
     QuicklistMenuItem* ql_item = nullptr;

=== modified file 'launcher/QuicklistMenuItem.cpp'
--- launcher/QuicklistMenuItem.cpp	2014-02-26 07:08:37 +0000
+++ launcher/QuicklistMenuItem.cpp	2014-02-13 10:14:20 +0000
@@ -41,7 +41,6 @@
   , _menu_item(item)
   , _activate_timestamp(0)
   , _prelight(false)
-  , _scale(1.0f)
 {
   mouse_up.connect(sigc::mem_fun(this, &QuicklistMenuItem::RecvMouseUp));
   mouse_click.connect(sigc::mem_fun(this, &QuicklistMenuItem::RecvMouseClick));
@@ -199,21 +198,15 @@
   sigMouseLeave.emit(this);
 }

-void QuicklistMenuItem::UpdateTexture()
-{
-  auto const& geo = GetGeometry();
-  nux::CairoGraphics cairo(CAIRO_FORMAT_ARGB32, geo.width * _scale, geo.height * _scale);
-  cairo_surface_set_device_scale(cairo.GetSurface(), _scale, _scale);
-  UpdateTexture(cairo, geo.width / _scale, geo.height / _scale);
-}
-
 void QuicklistMenuItem::PreLayoutManagement()
 {
   _pre_layout_width = GetBaseWidth();
   _pre_layout_height = GetBaseHeight();

   if (!_normalTexture[0])
+  {
     UpdateTexture();
+  }

   View::PreLayoutManagement();
 }
@@ -284,7 +277,7 @@
   return _text_extents;
 }

-void QuicklistMenuItem::DrawText(nux::CairoGraphics& cairo, double width, double height, nux::Color const& color)
+void QuicklistMenuItem::DrawText(nux::CairoGraphics& cairo, int width, int height, nux::Color const& color)
 {
   if (_text.empty())
     return;
@@ -295,7 +288,8 @@
   glib::String font_name;
   g_object_get(settings, "gtk-font-name", &font_name, nullptr);

-  cairo_t* cr = cairo.GetInternalContext();
+  std::shared_ptr<cairo_t> cairo_context(cairo.GetContext(), cairo_destroy);
+  cairo_t* cr = cairo_context.get();
   cairo_set_operator(cr, CAIRO_OPERATOR_SOURCE);
   cairo_set_source_rgba(cr, color.red, color.blue, color.green, color.alpha);
   cairo_set_font_options(cr, gdk_screen_get_font_options(screen));
@@ -303,7 +297,6 @@
   glib::Object<PangoLayout> layout(pango_cairo_create_layout(cr));
   std::shared_ptr<PangoFontDescription> desc(pango_font_description_from_string(font_name), pango_font_description_free);
   pango_layout_set_font_description(layout, desc.get());
-  pango_layout_set_height(layout, -1);
   pango_layout_set_wrap(layout, PANGO_WRAP_WORD_CHAR);

   if (IsMarkupAccelEnabled())
@@ -341,8 +334,8 @@
   int text_width  = log_rect.width / PANGO_SCALE;
   int text_height = log_rect.height / PANGO_SCALE;

-  _text_extents.width = std::ceil((text_width + ITEM_INDENT_ABS + 3 * ITEM_MARGIN) * _scale);
-  _text_extents.height = std::ceil((text_height + 2 * ITEM_MARGIN) * _scale);
+  _text_extents.width = text_width + ITEM_INDENT_ABS + 3 * ITEM_MARGIN;
+  _text_extents.height = text_height + 2 * ITEM_MARGIN;

   SetMinimumSize(_text_extents.width, _text_extents.height);

@@ -350,9 +343,10 @@
   pango_cairo_show_layout(cr, layout);
 }

-void QuicklistMenuItem::DrawPrelight(nux::CairoGraphics& cairo, double width, double height, nux::Color const& color)
+void QuicklistMenuItem::DrawPrelight(nux::CairoGraphics& cairo, int width, int height, nux::Color const& color)
 {
-  cairo_t* cr = cairo.GetInternalContext();
+  std::shared_ptr<cairo_t> cairo_context(cairo.GetContext(), cairo_destroy);
+  cairo_t* cr = cairo_context.get();

   cairo_set_operator(cr, CAIRO_OPERATOR_SOURCE);
   cairo_set_source_rgba(cr, color.red, color.blue, color.green, color.alpha);
@@ -420,7 +414,7 @@
   if (!_menu_item)
     return -1;

-  return std::ceil(dbusmenu_menuitem_property_get_int(_menu_item, MAXIMUM_LABEL_WIDTH_PROPERTY) * _scale);
+  return dbusmenu_menuitem_property_get_int(_menu_item, MAXIMUM_LABEL_WIDTH_PROPERTY);
 }

 bool QuicklistMenuItem::IsOverlayQuicklist() const
@@ -440,22 +434,6 @@
   return _normalTexture[0]->GetWidth();
 }

-double QuicklistMenuItem::GetScale() const
-{
-  return _scale;
-}
-
-void QuicklistMenuItem::SetScale(double scale)
-{
-  if (scale == _scale)
-    return;
-
-  _scale = scale;
-  InitializeText();
-  UpdateTexture();
-  QueueDraw();
-}
-
 // Introspection

 std::string QuicklistMenuItem::GetName() const

=== modified file 'launcher/QuicklistMenuItem.h'
--- launcher/QuicklistMenuItem.h	2014-02-25 06:07:13 +0000
+++ launcher/QuicklistMenuItem.h	2014-02-13 10:14:20 +0000
@@ -49,8 +49,6 @@
 {
   NUX_DECLARE_OBJECT_TYPE(QuicklistMenuItem, nux::View);
 public:
-  typedef nux::ObjectPtr<QuicklistMenuItem> Ptr;
-
   QuicklistMenuItem(QuicklistMenuItemType type, glib::Object<DbusmenuMenuitem> const& item, NUX_FILE_LINE_PROTO);
   virtual ~QuicklistMenuItem();

@@ -70,9 +68,6 @@
   void SetMaxLabelWidth(int max_width);
   int GetMaxLabelWidth() const;

-  virtual void SetScale(double);
-  double GetScale() const;
-
   bool IsOverlayQuicklist() const;

   void Activate() const;
@@ -81,7 +76,7 @@
   bool IsSelected() const;

   nux::Size const& GetTextExtents() const;
-  void UpdateTexture();
+  virtual void UpdateTexture() = 0;
   unsigned GetCairoSurfaceWidth() const;

   sigc::signal<void, QuicklistMenuItem*> sigTextChanged;
@@ -122,11 +117,9 @@

   void PreLayoutManagement();
   long PostLayoutManagement(long layoutResult);
-
-  virtual void UpdateTexture(nux::CairoGraphics&, double width, double height) = 0;
   void Draw(nux::GraphicsEngine& gfxContext, bool forceDraw);
-  void DrawText(nux::CairoGraphics& cairo, double width, double height, nux::Color const& color);
-  void DrawPrelight(nux::CairoGraphics& cairo, double width, double height, nux::Color const& color);
+  void DrawText(nux::CairoGraphics& cairo, int width, int height, nux::Color const& color);
+  void DrawPrelight(nux::CairoGraphics& cairo, int width, int height, nux::Color const& color);

   nux::ObjectPtr<nux::BaseTexture> _normalTexture[2];
   nux::ObjectPtr<nux::BaseTexture> _prelightTexture[2];
@@ -136,7 +129,6 @@
   bool _prelight;
   int _pre_layout_width;
   int _pre_layout_height;
-  double _scale;
   nux::Size _text_extents;
   std::string _text;
 };

=== modified file 'launcher/QuicklistMenuItemCheckmark.cpp'
--- launcher/QuicklistMenuItemCheckmark.cpp	2014-02-25 06:07:13 +0000
+++ launcher/QuicklistMenuItemCheckmark.cpp	2012-08-30 18:14:19 +0000
@@ -41,9 +41,14 @@
   return "QuicklistMenuItemCheckmark";
 }

-void QuicklistMenuItemCheckmark::UpdateTexture(nux::CairoGraphics& cairoGraphics, double width, double height)
+void QuicklistMenuItemCheckmark::UpdateTexture()
 {
-  cairo_t* cr = cairoGraphics.GetInternalContext();
+  int width = GetBaseWidth();
+  int height = GetBaseHeight();
+
+  nux::CairoGraphics cairoGraphics(CAIRO_FORMAT_ARGB32, width, height);
+  std::shared_ptr<cairo_t> cairo_context(cairoGraphics.GetContext(), cairo_destroy);
+  cairo_t* cr = cairo_context.get();

   // draw normal, unchecked version
   cairo_set_operator(cr, CAIRO_OPERATOR_CLEAR);

=== modified file 'launcher/QuicklistMenuItemCheckmark.h'
--- launcher/QuicklistMenuItemCheckmark.h	2014-02-25 06:07:13 +0000
+++ launcher/QuicklistMenuItemCheckmark.h	2012-08-15 02:51:33 +0000
@@ -36,7 +36,7 @@
   std::string GetName() const;

   virtual std::string GetDefaultText() const;
-  virtual void UpdateTexture(nux::CairoGraphics&, double width, double height);
+  virtual void UpdateTexture();
 };

 } // NAMESPACE

=== modified file 'launcher/QuicklistMenuItemLabel.cpp'
--- launcher/QuicklistMenuItemLabel.cpp	2014-02-25 06:07:13 +0000
+++ launcher/QuicklistMenuItemLabel.cpp	2012-08-30 18:14:19 +0000
@@ -41,9 +41,14 @@
   return "QuicklistMenuItemLabel";
 }

-void QuicklistMenuItemLabel::UpdateTexture(nux::CairoGraphics& cairoGraphics, double width, double height)
+void QuicklistMenuItemLabel::UpdateTexture()
 {
-  cairo_t* cr = cairoGraphics.GetInternalContext();
+  int width = GetBaseWidth();
+  int height = GetBaseHeight();
+
+  nux::CairoGraphics cairoGraphics(CAIRO_FORMAT_ARGB32, width, height);
+  std::shared_ptr<cairo_t> cairo_context(cairoGraphics.GetContext(), cairo_destroy);
+  cairo_t* cr = cairo_context.get();

   // draw normal, unchecked version
   cairo_set_operator(cr, CAIRO_OPERATOR_CLEAR);

=== modified file 'launcher/QuicklistMenuItemLabel.h'
--- launcher/QuicklistMenuItemLabel.h	2014-02-25 06:07:13 +0000
+++ launcher/QuicklistMenuItemLabel.h	2012-08-15 02:51:33 +0000
@@ -36,7 +36,7 @@
   std::string GetName() const;

   virtual std::string GetDefaultText() const;
-  virtual void UpdateTexture(nux::CairoGraphics&, double width, double height);
+  virtual void UpdateTexture();
 };

 } // NAMESPACE

=== modified file 'launcher/QuicklistMenuItemRadio.cpp'
--- launcher/QuicklistMenuItemRadio.cpp	2014-02-25 06:07:13 +0000
+++ launcher/QuicklistMenuItemRadio.cpp	2012-08-30 18:14:19 +0000
@@ -40,9 +40,14 @@
   return "QuicklistMenuItemRadio";
 }

-void QuicklistMenuItemRadio::UpdateTexture(nux::CairoGraphics& cairoGraphics, double width, double height)
+void QuicklistMenuItemRadio::UpdateTexture()
 {
-  cairo_t* cr = cairoGraphics.GetInternalContext();
+  int width = GetBaseWidth();
+  int height = GetBaseHeight();
+
+  nux::CairoGraphics cairoGraphics(CAIRO_FORMAT_ARGB32, width, height);
+  std::shared_ptr<cairo_t> cairo_context(cairoGraphics.GetContext(), cairo_destroy);
+  cairo_t* cr = cairo_context.get();

   // draw normal, disabled version
   cairo_set_operator(cr, CAIRO_OPERATOR_CLEAR);

=== modified file 'launcher/QuicklistMenuItemRadio.h'
--- launcher/QuicklistMenuItemRadio.h	2014-02-25 06:07:13 +0000
+++ launcher/QuicklistMenuItemRadio.h	2012-08-15 02:51:33 +0000
@@ -35,7 +35,7 @@
   std::string GetName() const;

   virtual std::string GetDefaultText() const;
-  virtual void UpdateTexture(nux::CairoGraphics&, double width, double height);
+  virtual void UpdateTexture();
 };

 } //NAMESPACE

=== modified file 'launcher/QuicklistMenuItemSeparator.cpp'
--- launcher/QuicklistMenuItemSeparator.cpp	2014-02-25 23:51:29 +0000
+++ launcher/QuicklistMenuItemSeparator.cpp	2012-08-30 18:14:19 +0000
@@ -19,24 +19,18 @@
  */

 #include "unity-shared/CairoTexture.h"
-#include "unity-shared/RawPixel.h"
 #include "QuicklistMenuItemSeparator.h"

 namespace unity
 {
-namespace
-{
-const RawPixel WIDTH = 64_em;
-const RawPixel HEIGHT = 7_em;
-}

 QuicklistMenuItemSeparator::QuicklistMenuItemSeparator(glib::Object<DbusmenuMenuitem> const& item, NUX_FILE_LINE_DECL)
   : QuicklistMenuItem(QuicklistMenuItemType::SEPARATOR, item, NUX_FILE_LINE_PARAM)
   , _color(1.0f, 1.0f, 1.0f, 0.5f)
   , _premultiplied_color(0.5f, 0.5f, 0.5f, 0.5f)
 {
-  SetMinimumWidth(WIDTH.CP(_scale));
-  SetMinimumHeight(HEIGHT.CP(_scale));
+  SetMinimumHeight(7);
+  SetBaseSize(64, 7);
 }

 std::string QuicklistMenuItemSeparator::GetName() const
@@ -49,13 +43,6 @@
   return false;
 }

-void QuicklistMenuItemSeparator::SetScale(double scale)
-{
-  QuicklistMenuItem::SetScale(scale);
-  SetMinimumWidth(WIDTH.CP(scale));
-  SetMinimumHeight(HEIGHT.CP(scale));
-}
-
 void QuicklistMenuItemSeparator::Draw(nux::GraphicsEngine& gfxContext, bool forceDraw)
 {
   // Check if the texture have been computed. If they haven't, exit the function.
@@ -80,17 +67,22 @@
   gfxContext.PopClippingRectangle();
 }

-void QuicklistMenuItemSeparator::UpdateTexture(nux::CairoGraphics& cairoGraphics, double width, double height)
+void QuicklistMenuItemSeparator::UpdateTexture()
 {
-  cairo_t* cr = cairoGraphics.GetInternalContext();
+  int width = GetBaseWidth();
+  int height = GetBaseHeight();
+
+  nux::CairoGraphics cairoGraphics(CAIRO_FORMAT_ARGB32, width, height);
+  std::shared_ptr<cairo_t> cairo_context(cairoGraphics.GetContext(), cairo_destroy);
+  cairo_t* cr = cairo_context.get();

   cairo_set_operator(cr, CAIRO_OPERATOR_SOURCE);
   cairo_set_source_rgba(cr, 0.0f, 0.0f, 0.0f, 0.0f);
   cairo_paint(cr);
   cairo_set_source_rgba(cr, _color.red, _color.green, _color.blue, _color.alpha);
   cairo_set_line_width(cr, 1.0f);
-  cairo_move_to(cr, 0.0f, height/2.0f);
-  cairo_line_to(cr, width, height/2.0f);
+  cairo_move_to(cr, 0.0f, 3.5f);
+  cairo_line_to(cr, width, 3.5f);
   cairo_stroke(cr);

   _normalTexture[0].Adopt(texture_from_cairo_graphics(cairoGraphics));

=== modified file 'launcher/QuicklistMenuItemSeparator.h'
--- launcher/QuicklistMenuItemSeparator.h	2014-02-25 06:07:13 +0000
+++ launcher/QuicklistMenuItemSeparator.h	2012-08-15 02:51:33 +0000
@@ -37,8 +37,7 @@
   void Draw(nux::GraphicsEngine& gfxContext, bool forceDraw);
   std::string GetName() const;

-  virtual void SetScale(double);
-  virtual void UpdateTexture(nux::CairoGraphics&, double width, double height);
+  virtual void UpdateTexture();

 private:
   nux::Color _color;

=== modified file 'launcher/QuicklistView.cpp'
--- launcher/QuicklistView.cpp	2014-02-26 06:38:24 +0000
+++ launcher/QuicklistView.cpp	2014-02-19 14:01:02 +0000
@@ -40,7 +40,6 @@

 #include "unity-shared/Introspectable.h"
 #include "unity-shared/PanelStyle.h"
-#include "unity-shared/DecorationStyle.h"
 #include "unity-shared/UnitySettings.h"

 #include "unity-shared/UBusWrapper.h"
@@ -321,6 +320,18 @@
   }
 }

+QuicklistView::~QuicklistView()
+{
+  for (auto item : _item_list)
+  {
+    // Remove from introspection
+    RemoveChild(item);
+    item->UnReference();
+  }
+
+  _item_list.clear();
+}
+
 void
 QuicklistView::EnableQuicklistForTesting(bool enable_testing)
 {
@@ -412,7 +423,7 @@

   gfxContext.PushClippingRectangle(base);

-  for (auto const& item : _item_list)
+  for (auto item : _item_list)
   {
     if (item->GetVisible())
       item->ProcessDraw(gfxContext, forceDraw);
@@ -429,17 +440,17 @@
   int MaxItemWidth = 0;
   int TotalItemHeight = 0;

-  for (auto const& item : _item_list)
+  for (auto item : _item_list)
   {
     // Make sure item is in layout if it should be
     if (!item->GetVisible())
     {
-      _item_layout->RemoveChildObject(item.GetPointer());
+      _item_layout->RemoveChildObject(item);
       continue;
     }
     else if (!item->GetParentObject())
     {
-      _item_layout->AddView(item.GetPointer(), 1, nux::MINOR_POSITION_CENTER, nux::MINOR_SIZE_FULL);
+      _item_layout->AddView(item, 1, nux::MINOR_POSITION_CENTER, nux::MINOR_SIZE_FULL);
     }

     nux::Size const& text_extents = item->GetTextExtents();
@@ -484,7 +495,7 @@
   int x = RawPixel(_padding + _anchor_width + _corner_radius + _offset_correction).CP(cv_);
   int y = _top_space->GetMinimumHeight();

-  for (auto const& item : _item_list)
+  for (auto item : _item_list)
   {
     if (!item->GetVisible())
       continue;
@@ -502,7 +513,7 @@
   // has bee set correctly during the layout cycle, but the cairo rendering still need to be adjusted.
   unsigned separator_width = _item_layout->GetBaseWidth();

-  for (auto const& item : _item_list)
+  for (auto item : _item_list)
   {
     if (item->GetVisible() && item->GetCairoSurfaceWidth() != separator_width)
     {
@@ -539,7 +550,7 @@
 void QuicklistView::CheckAndEmitItemSignal(int x, int y)
 {
   nux::Geometry geo;
-  for (auto const& item : _item_list)
+  for (auto item : _item_list)
   {
     if (!item->GetVisible())
       continue;
@@ -550,7 +561,7 @@
     if (geo.IsPointInside(x, y))
     {
       // An action is performed: send the signal back to the application
-      ActivateItem(item.GetPointer());
+      ActivateItem(item);
     }
   }
 }
@@ -579,16 +590,18 @@

 void QuicklistView::CancelItemsPrelightStatus()
 {
-  for (auto const& item : _item_list)
+  for (auto item : _item_list)
+  {
     item->Select(false);
+  }
 }

 void QuicklistView::RecvItemMouseDrag(QuicklistMenuItem* item, int x, int y)
 {
   nux::Geometry geo;
-  for (auto const& it : _item_list)
+  for (auto it : _item_list)
   {
-    int item_index = GetItemIndex(it.GetPointer());
+    int item_index = GetItemIndex(it);

     if (!IsMenuItemSelectable(item_index))
       continue;
@@ -660,15 +673,24 @@

 void QuicklistView::RemoveAllMenuItem()
 {
+  for (auto item : _item_list)
+  {
+    // Remove from introspection
+    RemoveChild(item);
+    item->UnReference();
+  }
+
+
+  _item_list.clear();
+
   _item_layout->Clear();
-  _item_list.clear();
   _cairo_text_has_changed = true;
-  QueueRelayout();
+  nux::GetWindowThread()->QueueObjectLayout(this);
 }

 void QuicklistView::AddMenuItem(QuicklistMenuItem* item)
 {
-  if (!item)
+  if (item == 0)
     return;

   item->sigTextChanged.connect(sigc::mem_fun(this, &QuicklistView::RecvCairoTextChanged));
@@ -678,12 +700,15 @@
   item->sigMouseEnter.connect(sigc::mem_fun(this, &QuicklistView::RecvItemMouseEnter));
   item->sigMouseLeave.connect(sigc::mem_fun(this, &QuicklistView::RecvItemMouseLeave));
   item->sigMouseDrag.connect(sigc::mem_fun(this, &QuicklistView::RecvItemMouseDrag));
-  item->SetScale(cv_->DPIScale());

-  _item_list.push_back(QuicklistMenuItem::Ptr(item));
+  _item_list.push_back(item);
+  item->Reference();
+  // Add to introspection
+  AddChild(item);

   _cairo_text_has_changed = true;
-  QueueRelayout();
+  nux::GetWindowThread()->QueueObjectLayout(this);
+  NeedRedraw();
 }

 void QuicklistView::RenderQuicklistView()
@@ -701,10 +726,10 @@
   if (index < (int)_item_list.size())
   {
     int i = 0;
-    for (auto const& item : _item_list)
+    for (auto item : _item_list)
     {
       if (i++ == index)
-        return item.GetPointer();
+        return item;
     }
   }

@@ -715,7 +740,7 @@
 {
   int index = -1;

-  for (auto const& it : _item_list)
+  for (auto it : _item_list)
   {
     ++index;

@@ -735,7 +760,7 @@
   return QuicklistMenuItemType::UNKNOWN;
 }

-std::list<QuicklistMenuItem::Ptr> QuicklistView::GetChildren()
+std::list<QuicklistMenuItem*> QuicklistView::GetChildren()
 {
   return _item_list;
 }
@@ -746,23 +771,23 @@
 }

 void ql_tint_dot_hl(cairo_t* cr,
-                    gfloat  scale,
                     gint    width,
                     gint    height,
                     gfloat  hl_x,
                     gfloat  hl_y,
                     gfloat  hl_size,
-                    nux::Color const& tint_color,
-                    nux::Color const& hl_color,
-                    nux::Color const& dot_color)
+                    gfloat* rgba_tint,
+                    gfloat* rgba_hl,
+                    gfloat* rgba_dot)
 {
+  cairo_surface_t* dots_surf    = NULL;
+  cairo_t*         dots_cr      = NULL;
   cairo_pattern_t* dots_pattern = NULL;
   cairo_pattern_t* hl_pattern   = NULL;

   // create context for dot-pattern
-  nux::CairoGraphics dots_surf(CAIRO_FORMAT_ARGB32, 4 * scale, 4 * scale);
-  cairo_surface_set_device_scale(dots_surf.GetSurface(), scale, scale);
-  cairo_t* dots_cr = dots_surf.GetInternalContext();
+  dots_surf = cairo_image_surface_create(CAIRO_FORMAT_ARGB32, 4, 4);
+  dots_cr = cairo_create(dots_surf);

   // clear normal context
   cairo_scale(cr, 1.0f, 1.0f);
@@ -778,10 +803,10 @@

   // fill path of normal context with tint
   cairo_set_source_rgba(cr,
-                        tint_color.red,
-                        tint_color.green,
-                        tint_color.blue,
-                        tint_color.alpha);
+                        rgba_tint[0],
+                        rgba_tint[1],
+                        rgba_tint[2],
+                        rgba_tint[3]);
   cairo_fill_preserve(cr);

   // create pattern in dot-context
@@ -790,15 +815,15 @@
   cairo_scale(dots_cr, 1.0f, 1.0f);
   cairo_set_operator(dots_cr, CAIRO_OPERATOR_OVER);
   cairo_set_source_rgba(dots_cr,
-                        dot_color.red,
-                        dot_color.green,
-                        dot_color.blue,
-                        dot_color.alpha);
+                        rgba_dot[0],
+                        rgba_dot[1],
+                        rgba_dot[2],
+                        rgba_dot[3]);
   cairo_rectangle(dots_cr, 0.0f, 0.0f, 1.0f, 1.0f);
   cairo_fill(dots_cr);
   cairo_rectangle(dots_cr, 2.0f, 2.0f, 1.0f, 1.0f);
   cairo_fill(dots_cr);
-  dots_pattern = cairo_pattern_create_for_surface(dots_surf.GetSurface());
+  dots_pattern = cairo_pattern_create_for_surface(dots_surf);

   // fill path of normal context with dot-pattern
   cairo_set_operator(cr, CAIRO_OPERATOR_OVER);
@@ -806,6 +831,8 @@
   cairo_pattern_set_extend(dots_pattern, CAIRO_EXTEND_REPEAT);
   cairo_fill_preserve(cr);
   cairo_pattern_destroy(dots_pattern);
+  cairo_surface_destroy(dots_surf);
+  cairo_destroy(dots_cr);

   // draw highlight
   cairo_set_operator(cr, CAIRO_OPERATOR_OVER);
@@ -817,10 +844,10 @@
                                            hl_size);
   cairo_pattern_add_color_stop_rgba(hl_pattern,
                                     0.0f,
-                                    hl_color.red,
-                                    hl_color.green,
-                                    hl_color.blue,
-                                    hl_color.alpha);
+                                    rgba_hl[0],
+                                    rgba_hl[1],
+                                    rgba_hl[2],
+                                    rgba_hl[3]);
   cairo_pattern_add_color_stop_rgba(hl_pattern, 1.0f, 1.0f, 1.0f, 1.0f, 0.0f);
   cairo_set_source(cr, hl_pattern);
   cairo_fill(cr);
@@ -830,8 +857,17 @@
 void ql_setup(cairo_surface_t** surf,
               cairo_t**         cr,
               gboolean          outline,
+              gint              width,
+              gint              height,
               gboolean          negative)
 {
+//     // create context
+//     if (outline)
+//       *surf = cairo_image_surface_create (CAIRO_FORMAT_ARGB32, width, height);
+//     else
+//       *surf = cairo_image_surface_create (CAIRO_FORMAT_A8, width, height);
+//     *cr = cairo_create (*surf);
+
   // clear context
   cairo_scale(*cr, 1.0f, 1.0f);
   if (outline)
@@ -853,8 +889,8 @@
 void ql_compute_full_mask_path(cairo_t* cr,
                                gfloat   anchor_width,
                                gfloat   anchor_height,
-                               gfloat   width,
-                               gfloat   height,
+                               gint     width,
+                               gint     height,
                                gint     upper_size,
                                gfloat   radius,
                                guint    pad)
@@ -973,7 +1009,7 @@

 void ql_compute_outline(cairo_t* cr,
                         gfloat   line_width,
-                        nux::Color const& line_color,
+                        gfloat*  rgba_line,
                         gfloat   size)
 {
   cairo_pattern_t* pattern = NULL;
@@ -985,25 +1021,25 @@

   pattern = cairo_pattern_create_linear(x, y, size, y);
   cairo_pattern_add_color_stop_rgba(pattern, 0.0f,
-                                    line_color.red,
-                                    line_color.green,
-                                    line_color.blue,
-                                    line_color.alpha);
+                                    rgba_line[0],
+                                    rgba_line[1],
+                                    rgba_line[2],
+                                    rgba_line[3]);
   cairo_pattern_add_color_stop_rgba(pattern, offset,
-                                    line_color.red,
-                                    line_color.green,
-                                    line_color.blue,
-                                    line_color.alpha);
+                                    rgba_line[0],
+                                    rgba_line[1],
+                                    rgba_line[2],
+                                    rgba_line[3]);
   cairo_pattern_add_color_stop_rgba(pattern, 1.1f * offset,
-                                    line_color.red * 0.65f,
-                                    line_color.green * 0.65f,
-                                    line_color.blue * 0.65f,
-                                    line_color.alpha);
+                                    rgba_line[0] * 0.65f,
+                                    rgba_line[1] * 0.65f,
+                                    rgba_line[2] * 0.65f,
+                                    rgba_line[3]);
   cairo_pattern_add_color_stop_rgba(pattern, 1.0f,
-                                    line_color.red * 0.65f,
-                                    line_color.green * 0.65f,
-                                    line_color.blue * 0.65f,
-                                    line_color.alpha);
+                                    rgba_line[0] * 0.65f,
+                                    rgba_line[1] * 0.65f,
+                                    rgba_line[2] * 0.65f,
+                                    rgba_line[3]);
   cairo_set_source(cr, pattern);
   cairo_set_line_width(cr, line_width);
   cairo_stroke(cr);
@@ -1013,7 +1049,7 @@
 void ql_draw(cairo_t* cr,
              gboolean outline,
              gfloat   line_width,
-             nux::Color const& color,
+             gfloat*  rgba,
              gboolean negative,
              gboolean stroke)
 {
@@ -1024,7 +1060,7 @@
   if (outline)
   {
     cairo_set_line_width(cr, line_width);
-    cairo_set_source_rgba(cr, color.red, color.green, color.blue, color.alpha);
+    cairo_set_source_rgba(cr, rgba[0], rgba[1], rgba[2], rgba[3]);
   }
   else
   {
@@ -1044,7 +1080,7 @@
 void ql_finalize(cairo_t** cr,
                  gboolean  outline,
                  gfloat    line_width,
-                 nux::Color const& color,
+                 gfloat*   rgba,
                  gboolean  negative,
                  gboolean  stroke)
 {
@@ -1055,7 +1091,7 @@
   if (outline)
   {
     cairo_set_line_width(*cr, line_width);
-    cairo_set_source_rgba(*cr, color.red, color.green, color.blue, color.alpha);
+    cairo_set_source_rgba(*cr, rgba[0], rgba[1], rgba[2], rgba[3]);
   }
   else
   {
@@ -1076,19 +1112,19 @@
 ql_compute_full_outline_shadow(
   cairo_t* cr,
   cairo_surface_t* surf,
-  gfloat  width,
-  gfloat  height,
+  gint    width,
+  gint    height,
   gfloat  anchor_width,
   gfloat  anchor_height,
   gint    upper_size,
   gfloat  corner_radius,
   guint   blur_coeff,
-  nux::Color const& rgba_shadow,
+  gfloat* rgba_shadow,
   gfloat  line_width,
   gint    padding_size,
-  nux::Color const& rgba_line)
+  gfloat* rgba_line)
 {
-  ql_setup(&surf, &cr, TRUE, FALSE);
+  ql_setup(&surf, &cr, TRUE, width, height, FALSE);
   ql_compute_full_mask_path(cr,
                             anchor_width,
                             anchor_height,
@@ -1108,9 +1144,10 @@
 void ql_compute_full_mask(
   cairo_t* cr,
   cairo_surface_t* surf,
-  gfloat   width,
-  gfloat   height,
+  gint     width,
+  gint     height,
   gfloat   radius,
+  guint    shadow_radius,
   gfloat   anchor_width,
   gfloat   anchor_height,
   gint     upper_size,
@@ -1118,9 +1155,9 @@
   gboolean outline,
   gfloat   line_width,
   gint     padding_size,
-  nux::Color const&  rgba)
+  gfloat*  rgba)
 {
-  ql_setup(&surf, &cr, outline, negative);
+  ql_setup(&surf, &cr, outline, width, height, negative);
   ql_compute_full_mask_path(cr,
                             anchor_width,
                             anchor_height,
@@ -1173,33 +1210,26 @@
     }
   }

-  auto const& deco_style = decoration::Style::Get();
-  float dpi_scale = cv_->DPIScale();
-  float blur_coef = std::round(deco_style->ActiveShadowRadius() * dpi_scale / 2.0f);
+  float blur_coef         = 6.0f;

   nux::CairoGraphics cairo_bg(CAIRO_FORMAT_ARGB32, width, height);
   nux::CairoGraphics cairo_mask(CAIRO_FORMAT_ARGB32, width, height);
   nux::CairoGraphics cairo_outline(CAIRO_FORMAT_ARGB32, width, height);

-  cairo_surface_set_device_scale(cairo_bg.GetSurface(), dpi_scale, dpi_scale);
-  cairo_surface_set_device_scale(cairo_mask.GetSurface(), dpi_scale, dpi_scale);
-  cairo_surface_set_device_scale(cairo_outline.GetSurface(), dpi_scale, dpi_scale);
-
-  cairo_t* cr_bg      = cairo_bg.GetInternalContext();
-  cairo_t* cr_mask    = cairo_mask.GetInternalContext();
-  cairo_t* cr_outline = cairo_outline.GetInternalContext();
-
-  nux::Color tint_color(0.0f, 0.0f, 0.0f, HasBlurredBackground() ? 0.60f : 1.0f);
-  nux::Color hl_color(1.0f, 1.0f, 1.0f, 0.35f);
-  nux::Color dot_color(1.0f, 1.0f, 1.0f, 0.03f);
-  nux::Color shadow_color(deco_style->ActiveShadowColor());
-  nux::Color outline_color(1.0f, 1.0f, 1.0f, 0.40f);
-  nux::Color mask_color(1.0f, 1.0f, 1.0f, 1.00f);
+  cairo_t* cr_bg      = cairo_bg.GetContext();
+  cairo_t* cr_mask    = cairo_mask.GetContext();
+  cairo_t* cr_outline = cairo_outline.GetContext();
+
+  float   tint_color[4]    = {0.0f, 0.0f, 0.0f, HasBlurredBackground() ? 0.60f : 1.0f};
+  float   hl_color[4]      = {1.0f, 1.0f, 1.0f, 0.35f};
+  float   dot_color[4]     = {1.0f, 1.0f, 1.0f, 0.03f};
+  float   shadow_color[4]  = {0.0f, 0.0f, 0.0f, 1.00f};
+  float   outline_color[4] = {1.0f, 1.0f, 1.0f, 0.40f};
+  float   mask_color[4]    = {1.0f, 1.0f, 1.0f, 1.00f};

   ql_tint_dot_hl(cr_bg,
-                 dpi_scale,
-                 width / dpi_scale,
-                 height / dpi_scale,
+                 width,
+                 height,
                  width / 2.0f,
                  0,
                  nux::Max<float>(width / 1.6f, height / 1.6f),
@@ -1211,33 +1241,38 @@
   (
     cr_outline,
     cairo_outline.GetSurface(),
-    width / dpi_scale,
-    height / dpi_scale,
-    _anchor_width,
-    _anchor_height,
-    size_above_anchor,
-    _corner_radius,
+    width,
+    height,
+    _anchor_width.CP(cv_),
+    _anchor_height.CP(cv_),
+    size_above_anchor.CP(cv_),
+    _corner_radius.CP(cv_),
     blur_coef,
     shadow_color,
-    1.0f * dpi_scale,
-    _padding,
+    1.0f,
+    _padding.CP(cv_),
     outline_color);

   ql_compute_full_mask(
     cr_mask,
     cairo_mask.GetSurface(),
-    width / dpi_scale,
-    height / dpi_scale,
-    _corner_radius,            // radius,
-    _anchor_width,             // anchor_width,
-    _anchor_height,            // anchor_height,
-    size_above_anchor,         // upper_size,
+    width,
+    height,
+    _corner_radius.CP(cv_),    // radius,
+    RawPixel(16).CP(cv_),      // shadow_radius,
+    _anchor_width.CP(cv_),     // anchor_width,
+    _anchor_height.CP(cv_),    // anchor_height,
+    size_above_anchor.CP(cv_), // upper_size,
     true,                      // negative,
     false,                     // outline,
     1.0,                       // line_width,
-    _padding,                  // padding_size,
+    _padding.CP(cv_),          // padding_size,
     mask_color);

+  cairo_destroy(cr_bg);
+  cairo_destroy(cr_outline);
+  cairo_destroy(cr_mask);
+
   texture_bg_ = texture_ptr_from_cairo_graphics(cairo_bg);
   texture_mask_ = texture_ptr_from_cairo_graphics(cairo_mask);
   texture_outline_ = texture_ptr_from_cairo_graphics(cairo_outline);
@@ -1306,12 +1341,12 @@

 debug::Introspectable::IntrospectableList QuicklistView::GetIntrospectableChildren()
 {
-  debug::Introspectable::IntrospectableList list(_item_list.size());
-
-  for (auto const& item: _item_list)
-    list.push_back(item.GetPointer());
-
-  return list;
+  _introspectable_children.clear();
+  for (auto item: _item_list)
+  {
+    _introspectable_children.push_back(item);
+  }
+  return _introspectable_children;
 }

 } // NAMESPACE

=== modified file 'launcher/QuicklistView.h'
--- launcher/QuicklistView.h	2014-02-25 06:08:10 +0000
+++ launcher/QuicklistView.h	2014-02-19 14:01:02 +0000
@@ -46,6 +46,7 @@
   NUX_DECLARE_OBJECT_TYPE(QuicklistView, unity::CairoBaseWindow);
 public:
   QuicklistView(int monitor = 0);
+  ~QuicklistView();

   void SetText(std::string const& text);

@@ -66,7 +67,7 @@
   QuicklistMenuItem* GetNthItems(int index);
   QuicklistMenuItemType GetNthType(int index);
   int GetItemIndex(QuicklistMenuItem* item);
-  std::list<QuicklistMenuItem::Ptr> GetChildren();
+  std::list<QuicklistMenuItem*> GetChildren();
   void SelectFirstItem();

   void TestMenuItems(DbusmenuMenuitem* root);
@@ -170,10 +171,13 @@

   bool _cairo_text_has_changed;
   void UpdateTexture();
-  std::list<QuicklistMenuItem::Ptr> _item_list;
+  std::list<QuicklistMenuItem*> _item_list;

   // used by keyboard/a11y-navigation
   int _current_item_index;
+
+  // list of introspectable children, used to return children in the correct order:
+  IntrospectableList _introspectable_children;
 };

 } // NAMESPACE

=== modified file 'launcher/Tooltip.cpp'
--- launcher/Tooltip.cpp	2014-02-26 06:48:17 +0000
+++ launcher/Tooltip.cpp	2014-02-19 14:01:02 +0000
@@ -25,7 +25,6 @@
 #include <unity-shared/CairoTexture.h>
 #include <unity-shared/RawPixel.h>
 #include <unity-shared/UnitySettings.h>
-#include "unity-shared/DecorationStyle.h"

 #include "Tooltip.h"

@@ -60,7 +59,6 @@
   _vlayout->AddLayout(_top_space, 0);

   _tooltip_text = new StaticCairoText(TEXT(""), NUX_TRACKER_LOCATION);
-  _tooltip_text->SetScale(cv_->DPIScale());
   _tooltip_text->SetTextAlignment(StaticCairoText::AlignState::NUX_ALIGN_CENTRE);
   _tooltip_text->SetTextVerticalAlignment(StaticCairoText::AlignState::NUX_ALIGN_CENTRE);
   _tooltip_text->SetMinimumWidth(MINIMUM_TEXT_WIDTH.CP(cv_));
@@ -171,14 +169,14 @@
 /////////////////////////////////////////////////////////////////////////////////////////////////

 void tint_dot_hl(cairo_t* cr,
-                 gfloat  width,
-                 gfloat  height,
+                 gint    width,
+                 gint    height,
                  gfloat  hl_x,
                  gfloat  hl_y,
                  gfloat  hl_size,
-                 nux::Color const& tint_color,
-                 nux::Color const& hl_color,
-                 nux::Color const& dot_color)
+                 gfloat* rgba_tint,
+                 gfloat* rgba_hl,
+                 gfloat* rgba_dot)
 {
   cairo_pattern_t* hl_pattern = NULL;

@@ -192,14 +190,14 @@
   cairo_set_operator(cr, CAIRO_OPERATOR_OVER);

   // create path in normal context
-  cairo_rectangle(cr, 0.0f, 0.0f, width, height);
+  cairo_rectangle(cr, 0.0f, 0.0f, (gdouble) width, (gdouble) height);

   // fill path of normal context with tint
   cairo_set_source_rgba(cr,
-                        tint_color.red,
-                        tint_color.green,
-                        tint_color.blue,
-                        tint_color.alpha);
+                        rgba_tint[0],
+                        rgba_tint[1],
+                        rgba_tint[2],
+                        rgba_tint[3]);
   cairo_fill_preserve(cr);

   // draw glow
@@ -211,10 +209,10 @@
                                            hl_size);
   cairo_pattern_add_color_stop_rgba(hl_pattern,
                                     0.0f,
-                                    hl_color.red,
-                                    hl_color.green,
-                                    hl_color.blue,
-                                    hl_color.alpha);
+                                    rgba_hl[0],
+                                    rgba_hl[1],
+                                    rgba_hl[2],
+                                    rgba_hl[3]);
   cairo_pattern_add_color_stop_rgba(hl_pattern, 1.0f, 1.0f, 1.0f, 1.0f, 0.0f);
   cairo_set_source(cr, hl_pattern);
   cairo_fill(cr);
@@ -224,6 +222,8 @@
 void _setup(cairo_surface_t** surf,
             cairo_t**         cr,
             gboolean          outline,
+            gint              width,
+            gint              height,
             gboolean          negative)
 {
   // clear context
@@ -247,8 +247,8 @@
 void _compute_full_mask_path(cairo_t* cr,
                              gfloat   anchor_width,
                              gfloat   anchor_height,
-                             gfloat   width,
-                             gfloat   height,
+                             gint     width,
+                             gint     height,
                              gint     upper_size,
                              gfloat   radius,
                              guint    pad)
@@ -305,14 +305,14 @@

 void compute_outline(cairo_t* cr,
                      gfloat   line_width,
-                     nux::Color const& line_color)
+                     gfloat*  rgba_line)
 {
   cairo_set_operator(cr, CAIRO_OPERATOR_SOURCE);
   cairo_set_source_rgba(cr,
-                        line_color.red,
-                        line_color.green,
-                        line_color.blue,
-                        line_color.alpha);
+                        rgba_line[0],
+                        rgba_line[1],
+                        rgba_line[2],
+                        rgba_line[3]);
   cairo_set_line_width(cr, line_width);
   cairo_stroke(cr);
 }
@@ -320,7 +320,7 @@
 void _draw(cairo_t* cr,
            gboolean outline,
            gfloat   line_width,
-           nux::Color const& color,
+           gfloat*  rgba,
            gboolean negative,
            gboolean stroke)
 {
@@ -331,7 +331,7 @@
   if (outline)
   {
     cairo_set_line_width(cr, line_width);
-    cairo_set_source_rgba(cr, color.red, color.green, color.blue, color.alpha);
+    cairo_set_source_rgba(cr, rgba[0], rgba[1], rgba[2], rgba[3]);
   }
   else
   {
@@ -351,7 +351,7 @@
 void _finalize(cairo_t** cr,
                gboolean  outline,
                gfloat    line_width,
-               nux::Color const& color,
+               gfloat*   rgba,
                gboolean  negative,
                gboolean  stroke)
 {
@@ -362,7 +362,7 @@
   if (outline)
   {
     cairo_set_line_width(*cr, line_width);
-    cairo_set_source_rgba(*cr, color.red, color.green, color.blue, color.alpha);
+    cairo_set_source_rgba(*cr, rgba[0], rgba[1], rgba[2], rgba[3]);
   }
   else
   {
@@ -383,19 +383,19 @@
 compute_full_outline_shadow(
   cairo_t* cr,
   cairo_surface_t* surf,
-  gfloat  width,
-  gfloat  height,
+  gint    width,
+  gint    height,
   gfloat  anchor_width,
   gfloat  anchor_height,
   gint    upper_size,
   gfloat  corner_radius,
   guint   blur_coeff,
-  nux::Color const& shadow_color,
+  gfloat* rgba_shadow,
   gfloat  line_width,
   gint    padding_size,
-  nux::Color const& line_color)
+  gfloat* rgba_line)
 {
-  _setup(&surf, &cr, TRUE, FALSE);
+  _setup(&surf, &cr, TRUE, width, height, FALSE);
   _compute_full_mask_path(cr,
                           anchor_width,
                           anchor_height,
@@ -405,19 +405,20 @@
                           corner_radius,
                           padding_size);

-  _draw(cr, TRUE, line_width, shadow_color, FALSE, FALSE);
+  _draw(cr, TRUE, line_width, rgba_shadow, FALSE, FALSE);
   nux::CairoGraphics dummy(CAIRO_FORMAT_A1, 1, 1);
   dummy.BlurSurface(blur_coeff, surf);
   compute_mask(cr);
-  compute_outline(cr, line_width, line_color);
+  compute_outline(cr, line_width, rgba_line);
 }

 void compute_full_mask(
   cairo_t* cr,
   cairo_surface_t* surf,
-  gfloat   width,
-  gfloat   height,
+  gint     width,
+  gint     height,
   gfloat   radius,
+  guint    shadow_radius,
   gfloat   anchor_width,
   gfloat   anchor_height,
   gint     upper_size,
@@ -425,9 +426,9 @@
   gboolean outline,
   gfloat   line_width,
   gint     padding_size,
-  nux::Color const& color)
+  gfloat*  rgba)
 {
-  _setup(&surf, &cr, outline, negative);
+  _setup(&surf, &cr, outline, width, height, negative);
   _compute_full_mask_path(cr,
                           anchor_width,
                           anchor_height,
@@ -436,7 +437,7 @@
                           upper_size,
                           radius,
                           padding_size);
-  _finalize(&cr, outline, line_width, color, negative, outline);
+  _finalize(&cr, outline, line_width, rgba, negative, outline);
 }

 void Tooltip::UpdateTexture()
@@ -450,9 +451,7 @@
   int x = _anchorX - PADDING.CP(cv_);
   int y = _anchorY - height / 2;

-  auto const& deco_style = decoration::Style::Get();
-  float dpi_scale = cv_->DPIScale();
-  float blur_coef = std::round(deco_style->ActiveShadowRadius() * dpi_scale / 2.0f);
+  float blur_coef = 6.0f;

   SetBaseX(x);
   SetBaseY(y);
@@ -461,32 +460,30 @@
   nux::CairoGraphics cairo_mask(CAIRO_FORMAT_ARGB32, width, height);
   nux::CairoGraphics cairo_outline(CAIRO_FORMAT_ARGB32, width, height);

-  cairo_surface_set_device_scale(cairo_bg.GetSurface(), dpi_scale, dpi_scale);
-  cairo_surface_set_device_scale(cairo_mask.GetSurface(), dpi_scale, dpi_scale);
-  cairo_surface_set_device_scale(cairo_outline.GetSurface(), dpi_scale, dpi_scale);
-
-  cairo_t* cr_bg      = cairo_bg.GetInternalContext();
-  cairo_t* cr_mask    = cairo_mask.GetInternalContext();
-  cairo_t* cr_outline = cairo_outline.GetInternalContext();
-
-  nux::Color tint_color(0.074f, 0.074f, 0.074f, 0.80f);
-  nux::Color hl_color(1.0f, 1.0f, 1.0f, 0.8f);
-  nux::Color dot_color(1.0f, 1.0f, 1.0f, 0.20f);
-  nux::Color shadow_color(deco_style->ActiveShadowColor());
-  nux::Color outline_color(1.0f, 1.0f, 1.0f, 0.15f);
-  nux::Color mask_color(1.0f, 1.0f, 1.0f, 1.00f);
+  cairo_t* cr_bg      = cairo_bg.GetContext();
+  cairo_t* cr_mask    = cairo_mask.GetContext();
+  cairo_t* cr_outline = cairo_outline.GetContext();
+
+  float   tint_color[4]    = {0.074f, 0.074f, 0.074f, 0.80f};
+  float   hl_color[4]      = {1.0f, 1.0f, 1.0f, 0.8f};
+  float   dot_color[4]     = {1.0f, 1.0f, 1.0f, 0.20f};
+  float   shadow_color[4]  = {0.0f, 0.0f, 0.0f, 1.00f};
+  float   outline_color[4] = {1.0f, 1.0f, 1.0f, 0.15f};
+  float   mask_color[4]    = {1.0f, 1.0f, 1.0f, 1.00f};

   if (!HasBlurredBackground())
   {
     //If low gfx is detected then disable transparency because we're not bluring using our blur anymore.
-    tint_color.alpha = 1.0f;
-    hl_color.alpha = 1.0f;
-    dot_color.alpha = 1.0f;
+    const float alpha_value = 1.0f;
+
+    tint_color[3] = alpha_value;
+    hl_color[3] = alpha_value;
+    dot_color[3] = alpha_value;
   }

   tint_dot_hl(cr_bg,
-              width / dpi_scale,
-              height / dpi_scale,
+              width,
+              height,
               width / 2.0f,
               0,
               nux::Max<float>(width / 1.3f, height / 1.3f),
@@ -498,33 +495,38 @@
   (
     cr_outline,
     cairo_outline.GetSurface(),
-    width / dpi_scale,
-    height / dpi_scale,
-    ANCHOR_WIDTH,
-    ANCHOR_HEIGHT,
+    width,
+    height,
+    ANCHOR_WIDTH.CP(cv_),
+    ANCHOR_HEIGHT.CP(cv_),
     -1,
-    CORNER_RADIUS,
+    CORNER_RADIUS.CP(cv_),
     blur_coef,
     shadow_color,
     1.0f,
-    PADDING,
+    PADDING.CP(cv_),
     outline_color);

   compute_full_mask(
     cr_mask,
     cairo_mask.GetSurface(),
-    width / dpi_scale,
-    height / dpi_scale,
-    CORNER_RADIUS,         // radius,
-    ANCHOR_WIDTH,          // anchor_width,
-    ANCHOR_HEIGHT,         // anchor_height,
+    width,
+    height,
+    CORNER_RADIUS.CP(cv_), // radius,
+    RawPixel(16).CP(cv_),  // shadow_radius,
+    ANCHOR_WIDTH.CP(cv_),  // anchor_width,
+    ANCHOR_HEIGHT.CP(cv_), // anchor_height,
     -1,                    // upper_size,
     true,                  // negative,
     false,                 // outline,
     1.0,                   // line_width,
-    PADDING,               // padding_size,
+    PADDING.CP(cv_),       // padding_size,
     mask_color);

+  cairo_destroy(cr_bg);
+  cairo_destroy(cr_outline);
+  cairo_destroy(cr_mask);
+
   texture_bg_ = texture_ptr_from_cairo_graphics(cairo_bg);
   texture_mask_ = texture_ptr_from_cairo_graphics(cairo_mask);
   texture_outline_ = texture_ptr_from_cairo_graphics(cairo_outline);

=== modified file 'launcher/XdndCollectionWindowImp.cpp'
--- launcher/XdndCollectionWindowImp.cpp	2014-02-27 05:30:25 +0000
+++ launcher/XdndCollectionWindowImp.cpp	2013-10-29 22:33:02 +0000
@@ -55,7 +55,7 @@
     WindowManager::Default().window_moved.connect(sigc::mem_fun(this, &PrivateWindow::OnWindowMoved));
   }

-  void OnScreenChanged(int /*primary*/, std::vector<nux::Geometry> const& /*monitors*/)
+  void OnScreenChanged(int /*primary*/, std::vector<nux::Geometry>& /*monitors*/)
   {
     auto uscreen = UScreen::GetDefault();
     SetGeometry(uscreen->GetScreenGeometry());

=== modified file 'launcher/XdndManagerImp.cpp'
--- launcher/XdndManagerImp.cpp	2014-02-27 05:30:25 +0000
+++ launcher/XdndManagerImp.cpp	2013-10-14 15:59:22 +0000
@@ -19,7 +19,6 @@

 #include "XdndManagerImp.h"

-#include <algorithm>
 #include "unity-shared/UScreen.h"

 namespace unity {

=== modified file 'panel/PanelController.cpp'
--- panel/PanelController.cpp	2014-02-27 05:29:06 +0000
+++ panel/PanelController.cpp	2014-02-18 20:11:54 +0000
@@ -38,7 +38,7 @@
 class Controller::Impl
 {
 public:
-  Impl(Controller*, menu::Manager::Ptr const&, ui::EdgeBarrierController::Ptr const&);
+  Impl(menu::Manager::Ptr const&, ui::EdgeBarrierController::Ptr const&);
   ~Impl();

   // NOTE: nux::Property maybe?
@@ -48,15 +48,14 @@

   float opacity() const;

-  nux::ObjectPtr<PanelView> CreatePanel();
-  void OnScreenChanged(unsigned int primary_monitor, std::vector<nux::Geometry> const& monitors);
+  nux::ObjectPtr<PanelView> CreatePanel(Introspectable *iobj);
+  void OnScreenChanged(unsigned int primary_monitor, std::vector<nux::Geometry>& monitors, Introspectable *iobj);
   void UpdatePanelGeometries();

   typedef nux::ObjectPtr<nux::BaseWindow> BaseWindowPtr;

   PanelView* ViewForWindow(BaseWindowPtr const& window) const;

-  Controller* parent_;
   menu::Manager::Ptr indicators_;
   ui::EdgeBarrierController::Ptr edge_barriers_;
   PanelVector panels_;
@@ -67,17 +66,12 @@
 };


-Controller::Impl::Impl(Controller* parent, menu::Manager::Ptr const& indicators, ui::EdgeBarrierController::Ptr const& edge_barriers)
-  : parent_(parent)
-  , indicators_(indicators)
+Controller::Impl::Impl(menu::Manager::Ptr const& indicators, ui::EdgeBarrierController::Ptr const& edge_barriers)
+  : indicators_(indicators)
   , edge_barriers_(edge_barriers)
   , opacity_(1.0f)
   , opacity_maximized_toggle_(false)
-{
-  UScreen* screen = UScreen::GetDefault();
-  screen->changed.connect(sigc::mem_fun(this, &Impl::OnScreenChanged));
-  OnScreenChanged(screen->GetPrimaryMonitor(), screen->GetMonitors());
-}
+{}

 Controller::Impl::~Impl()
 {
@@ -138,7 +132,9 @@
 }

 // We need to put a panel on every monitor, and try and re-use the panels we already have
-void Controller::Impl::OnScreenChanged(unsigned int primary_monitor, std::vector<nux::Geometry> const& monitors)
+void Controller::Impl::OnScreenChanged(unsigned int primary_monitor,
+                                       std::vector<nux::Geometry>& monitors,
+                                       Introspectable *iobj)
 {
   unsigned int num_monitors = monitors.size();
   unsigned int num_panels = num_monitors;
@@ -151,11 +147,11 @@
   {
     if (i >= panels_size)
     {
-      panels_.push_back(CreatePanel());
+      panels_.push_back(CreatePanel(iobj));
     }
     else if (!panels_[i])
     {
-      panels_[i] = CreatePanel();
+      panels_[i] = CreatePanel(iobj);
     }

     if (panels_[i]->GetMonitor() != static_cast<int>(i))
@@ -175,7 +171,7 @@
     auto const& panel = panels_[i];
     if (panel)
     {
-      parent_->RemoveChild(panel.GetPointer());
+      iobj->RemoveChild(panel.GetPointer());
       panel->GetParent()->UnReference();
       edge_barriers_->RemoveHorizontalSubscriber(panel.GetPointer(), panel->GetMonitor());
     }
@@ -186,7 +182,7 @@
 }


-nux::ObjectPtr<PanelView> Controller::Impl::CreatePanel()
+nux::ObjectPtr<PanelView> Controller::Impl::CreatePanel(Introspectable *iobj)
 {
   auto* panel_window = new MockableBaseWindow(TEXT("PanelWindow"));

@@ -209,7 +205,7 @@
     panel_window->EnableInputWindow(true, panel::window_title, false, false);

   panel_window->InputWindowEnableStruts(true);
-  parent_->AddChild(view);
+  iobj->AddChild(view);

   return nux::ObjectPtr<PanelView>(view);
 }
@@ -232,8 +228,14 @@

 Controller::Controller(menu::Manager::Ptr const& menus, ui::EdgeBarrierController::Ptr const& edge_barriers)
   : launcher_width(64)
-  , pimpl(new Impl(this, menus, edge_barriers))
+  , pimpl(new Impl(menus, edge_barriers))
 {
+  UScreen* screen = UScreen::GetDefault();
+  screen->changed.connect(sigc::mem_fun(this, &Controller::OnScreenChanged));
+  OnScreenChanged(screen->GetPrimaryMonitor(), screen->GetMonitors());
+
+  unity::Settings::Instance().dpi_changed.connect(sigc::mem_fun(this, &Controller::OnDPIChanged));
+
   launcher_width.changed.connect([this] (int width)
   {
     pimpl->SetLauncherWidth(width);
@@ -243,6 +245,19 @@
 Controller::~Controller()
 {}

+void Controller::OnDPIChanged()
+{
+  for (auto& panel_ptr : pimpl->panels_)
+  {
+    if (panel_ptr)
+    {
+      int monitor = panel_ptr->GetMonitor();
+
+      panel_ptr->SetMonitor(monitor);
+    }
+  }
+}
+
 void Controller::SetOpacity(float opacity)
 {
   pimpl->SetOpacity(opacity);
@@ -284,5 +299,10 @@
     .add("opacity", pimpl->opacity());
 }

+void Controller::OnScreenChanged(int primary_monitor, std::vector<nux::Geometry>& monitors)
+{
+  pimpl->OnScreenChanged(primary_monitor, monitors, this);
+}
+
 } // namespace panel
 } // namespace unity

=== modified file 'panel/PanelController.h'
--- panel/PanelController.h	2014-02-27 05:29:06 +0000
+++ panel/PanelController.h	2014-02-18 18:27:30 +0000
@@ -61,6 +61,9 @@
   void AddProperties(debug::IntrospectionData&);

 private:
+  void OnScreenChanged(int primary_monitor, std::vector<nux::Geometry>& monitors);
+  void OnDPIChanged();
+
   class Impl;
   std::unique_ptr<Impl> pimpl;
 };

=== modified file 'panel/PanelIndicatorEntryDropdownView.cpp'
--- panel/PanelIndicatorEntryDropdownView.cpp	2014-02-25 00:28:58 +0000
+++ panel/PanelIndicatorEntryDropdownView.cpp	2014-02-18 21:20:28 +0000
@@ -144,7 +144,7 @@
     entries.push_back(entry->GetEntry());

   auto const& geo = GetAbsoluteGeometry();
-  indicators_->ShowEntriesDropdown(entries, active_entry_, 0, geo.x, geo.y + geo.height);
+  indicators_->ShowEntriesDropdown(entries, active_entry_, 0, geo.x, geo.y + Style::Instance().PanelHeight(monitor_));
 }

 bool PanelIndicatorEntryDropdownView::ActivateChild(PanelIndicatorEntryView::Ptr const& child)

=== modified file 'panel/PanelIndicatorEntryView.cpp'
--- panel/PanelIndicatorEntryView.cpp	2014-02-28 15:01:24 +0000
+++ panel/PanelIndicatorEntryView.cpp	2014-02-19 02:16:22 +0000
@@ -19,7 +19,6 @@
  */

 #include <Nux/Nux.h>
-#include <NuxCore/Logger.h>
 #include <UnityCore/ConnectionManager.h>
 #include <UnityCore/GTKWrapper.h>

@@ -30,16 +29,17 @@

 #include "unity-shared/CairoTexture.h"
 #include "unity-shared/PanelStyle.h"
-#include "unity-shared/RawPixel.h"
 #include "unity-shared/WindowManager.h"
 #include "unity-shared/UnitySettings.h"

 namespace unity
 {
+
 namespace
 {
-DECLARE_LOGGER(logger, "unity.panel.indicator.entry");
-const int DEFAULT_SPACING = 3;
+const RawPixel DEFAULT_SPACING = 3_em;
+
+const int SCALED_IMAGE_Y = 1;
 }

 using namespace indicator;
@@ -48,14 +48,17 @@
                                                  IndicatorEntryType type)
   : TextureArea(NUX_TRACKER_LOCATION)
   , proxy_(proxy)
+  , spacing_(DEFAULT_SPACING)
+  , left_padding_(padding < 0 ? 0 : padding)
+  , right_padding_(left_padding_)
+  , monitor_(0)
   , type_(type)
-  , monitor_(0)
+  , entry_texture_(nullptr)
   , opacity_(1.0f)
   , draw_active_(false)
   , overlay_showing_(false)
   , disabled_(false)
   , focused_(true)
-  , padding_(padding < 0 ? 0 : padding)
   , cv_(unity::Settings::Instance().em(monitor_))
 {
   proxy_->active_changed.connect(sigc::mem_fun(this, &PanelIndicatorEntryView::OnActiveChanged));
@@ -70,14 +73,6 @@
     InputArea::mouse_wheel.connect(sigc::mem_fun(this, &PanelIndicatorEntryView::OnMouseWheel));
   }

-  if (type_ != MENU)
-  {
-    icon_theme_changed_.Connect(gtk_icon_theme_get_default(), "changed", [this] (GtkIconTheme*) {
-      if (proxy_->image_type() && proxy_->image_visible())
-        Refresh();
-    });
-  }
-
   panel::Style::Instance().changed.connect(sigc::mem_fun(this, &PanelIndicatorEntryView::Refresh));
   unity::Settings::Instance().dpi_changed.connect(sigc::mem_fun(this, &PanelIndicatorEntryView::Refresh));

@@ -120,7 +115,7 @@
     wm.TerminateScale();

   auto const& abs_geo = GetAbsoluteGeometry();
-  proxy_->ShowMenu(abs_geo.x, abs_geo.y + abs_geo.height, button);
+  proxy_->ShowMenu(abs_geo.x, abs_geo.y + panel::Style::Instance().PanelHeight(monitor_), button);
 }

 void PanelIndicatorEntryView::OnMouseDown(int x, int y, long button_flags, long key_flags)
@@ -199,59 +194,73 @@
   }
 }

-glib::Object<GdkPixbuf> PanelIndicatorEntryView::MakePixbuf(int size)
+glib::Object<GdkPixbuf> PanelIndicatorEntryView::MakePixbuf()
 {
   glib::Object<GdkPixbuf> pixbuf;
-  auto image_type = proxy_->image_type();
-
-  switch (image_type)
-  {
-    case GTK_IMAGE_PIXBUF:
-    {
-      gsize len = 0;
-      auto* decoded = g_base64_decode(proxy_->image_data().c_str(), &len);
-      glib::Object<GInputStream> stream(g_memory_input_stream_new_from_data(decoded, len, nullptr));
-      pixbuf = gdk_pixbuf_new_from_stream(stream, nullptr, nullptr);
-      g_input_stream_close(stream, nullptr, nullptr);
-      g_free(decoded);
-      break;
-    }
-
-    case GTK_IMAGE_ICON_NAME:
-    case GTK_IMAGE_STOCK:
-    case GTK_IMAGE_GICON:
-    {
-      GtkIconTheme* theme = gtk_icon_theme_get_default();
-      auto flags = static_cast<GtkIconLookupFlags>(0);
-      gtk::IconInfo info;
-
-      if (image_type == GTK_IMAGE_GICON)
-      {
-        glib::Object<GIcon> icon(g_icon_new_for_string(proxy_->image_data().c_str(), nullptr));
-        info = gtk_icon_theme_lookup_by_gicon(theme, icon, size, flags);
-      }
-      else
-      {
-        info = gtk_icon_theme_lookup_icon(theme, proxy_->image_data().c_str(), size, flags);
-      }
-
-      if (info)
-      {
-        auto* filename = gtk_icon_info_get_filename(info);
-        pixbuf = gdk_pixbuf_new_from_file_at_size(filename, -1, size, nullptr);
-      }
-      else if (image_type == GTK_IMAGE_ICON_NAME)
-      {
-        pixbuf = gdk_pixbuf_new_from_file_at_size(proxy_->image_data().c_str(), -1, size, nullptr);
-      }
-
-      break;
-    }
+  GtkIconTheme* theme = gtk_icon_theme_get_default();
+  int image_type = proxy_->image_type();
+  RawPixel size = (type_ != DROP_DOWN) ? 24_em : 10_em;
+
+  if (image_type == GTK_IMAGE_PIXBUF)
+  {
+    gsize len = 0;
+    guchar* decoded = g_base64_decode(proxy_->image_data().c_str(), &len);
+
+    glib::Object<GInputStream> stream(g_memory_input_stream_new_from_data(decoded,
+                                                                          len,
+                                                                          nullptr));
+
+    pixbuf = gdk_pixbuf_new_from_stream(stream, nullptr, nullptr);
+
+    g_free(decoded);
+    g_input_stream_close(stream, nullptr, nullptr);
+  }
+  else if (image_type == GTK_IMAGE_STOCK ||
+           image_type == GTK_IMAGE_ICON_NAME)
+  {
+    pixbuf = gtk_icon_theme_load_icon(theme, proxy_->image_data().c_str(), size.CP(cv_),
+                                      (GtkIconLookupFlags)0, nullptr);
+  }
+  else if (image_type == GTK_IMAGE_GICON)
+  {
+    glib::Object<GIcon> icon(g_icon_new_for_string(proxy_->image_data().c_str(), nullptr));
+
+    gtk::IconInfo info(gtk_icon_theme_lookup_by_gicon(theme, icon, size.CP(cv_),
+                                                      (GtkIconLookupFlags)0));
+    if (info)
+      pixbuf = gtk_icon_info_load_icon(info, nullptr);
   }

   return pixbuf;
 }

+int PanelIndicatorEntryView::PixbufWidth(glib::Object<GdkPixbuf> const& pixbuf) const
+{
+  int image_type = proxy_->image_type();
+  if (image_type == GTK_IMAGE_PIXBUF)
+  {
+    return RawPixel(gdk_pixbuf_get_width(pixbuf)).CP(cv_);
+  }
+  else
+  {
+    return gdk_pixbuf_get_width(pixbuf);
+  }
+}
+
+int PanelIndicatorEntryView::PixbufHeight(glib::Object<GdkPixbuf> const& pixbuf) const
+{
+  int image_type = proxy_->image_type();
+  if (image_type == GTK_IMAGE_PIXBUF)
+  {
+    return RawPixel(gdk_pixbuf_get_height(pixbuf)).CP(cv_);
+  }
+  else
+  {
+    return gdk_pixbuf_get_height(pixbuf);
+  }
+
+}
+
 void PanelIndicatorEntryView::DrawEntryPrelight(cairo_t* cr, unsigned int width, unsigned int height)
 {
   GtkStyleContext* style_context = panel::Style::Instance().GetStyleContext();
@@ -276,9 +285,22 @@
   gtk_style_context_restore(style_context);
 }

-void PanelIndicatorEntryView::DrawEntryContent(cairo_t *cr, unsigned int width, unsigned int height, glib::Object<GdkPixbuf> const& pixbuf, bool icon_scalable, glib::Object<PangoLayout> const& layout)
-{
-  int x = padding_;
+// FIXME Remove me when icons for the indicators aren't stuck as 22x22 images...
+void PanelIndicatorEntryView::ScaleImageIcons(cairo_t* cr, int* x, int* y)
+{
+  int image_type = proxy_->image_type();
+  if (image_type == GTK_IMAGE_PIXBUF)
+  {
+    float aspect = cv_->DPIScale();
+    *x = left_padding_;
+    *y = SCALED_IMAGE_Y;
+    cairo_scale(cr, aspect, aspect);
+  }
+}
+
+void PanelIndicatorEntryView::DrawEntryContent(cairo_t *cr, unsigned int width, unsigned int height, glib::Object<GdkPixbuf> const& pixbuf, glib::Object<PangoLayout> const& layout)
+{
+  int x = left_padding_.CP(cv_);

   if (IsActive())
     DrawEntryPrelight(cr, width, height);
@@ -286,7 +308,7 @@
   if (pixbuf && IsIconVisible())
   {
     GtkStyleContext* style_context = panel::Style::Instance().GetStyleContext();
-    unsigned int icon_width = gdk_pixbuf_get_width(pixbuf);
+    unsigned int icon_width = PixbufWidth(pixbuf);

     gtk_style_context_save(style_context);

@@ -308,17 +330,7 @@
       gtk_style_context_set_state(style_context, GTK_STATE_FLAG_PRELIGHT);
     }

-    int y = (height - gdk_pixbuf_get_height(pixbuf)) / 2;
-
-    if (icon_scalable)
-    {
-      double dpi_scale = cv_->DPIScale();
-      cairo_save(cr);
-      cairo_scale(cr, 1.0f/dpi_scale, 1.0f/dpi_scale);
-      x = padding_ * dpi_scale;
-      y = (std::ceil(height * dpi_scale) - gdk_pixbuf_get_height(pixbuf)) / 2;
-      icon_width /= dpi_scale;
-    }
+    int y = (int)((height - PixbufHeight(pixbuf)) / 2);

     if (overlay_showing_ && !IsActive())
     {
@@ -327,6 +339,9 @@
        * a white square. It works surprisingly well for most symbolic-type
        * icon themes/icons.
        */
+      cairo_save(cr);
+      ScaleImageIcons(cr, &x, &y);
+
       cairo_push_group(cr);
       gdk_cairo_set_source_pixbuf(cr, pixbuf, x, y);
       cairo_paint_with_alpha(cr, (IsIconSensitive() && IsFocused()) ? 1.0 : 0.5);
@@ -338,29 +353,36 @@
       cairo_mask(cr, pat);

       cairo_pattern_destroy(pat);
+      cairo_restore(cr);
     }
     else
     {
+      cairo_save(cr);
+      ScaleImageIcons(cr, &x, &y);
+
       cairo_push_group(cr);
       gtk_render_icon(style_context, cr, pixbuf, x, y);
       cairo_pop_group_to_source(cr);
       cairo_paint_with_alpha(cr, (IsIconSensitive() && IsFocused()) ? 1.0 : 0.5);
+
+      cairo_restore(cr);
     }

     gtk_widget_path_free(widget_path);
+
     gtk_style_context_restore(style_context);

-    if (icon_scalable)
-    {
-      cairo_restore(cr);
-      x = padding_;
-    }
-
-    x += icon_width + DEFAULT_SPACING;
+    x += icon_width + spacing_.CP(cv_);
   }

   if (layout)
   {
+    PangoRectangle log_rect;
+    pango_layout_get_extents(layout, nullptr, &log_rect);
+    unsigned int text_height = log_rect.height / PANGO_SCALE;
+
+    pango_cairo_update_layout(cr, layout);
+
     GtkStyleContext* style_context = panel::Style::Instance().GetStyleContext();

     gtk_style_context_save(style_context);
@@ -383,9 +405,7 @@
       gtk_style_context_set_state(style_context, GTK_STATE_FLAG_PRELIGHT);
     }

-    nux::Size extents;
-    pango_layout_get_pixel_size(layout, &extents.width, &extents.height);
-    int y = (height - extents.height) / 2;
+    int y = (height - text_height) / 2;

     if (overlay_showing_)
     {
@@ -426,79 +446,88 @@
   cairo_t* cr;

   std::string label = GetLabel();
-  auto& panel_style = panel::Style::Instance();
-
-  double dpi_scale = cv_->DPIScale();
-  int width = 0;
-  int height = panel_style.PanelHeight(monitor_) / dpi_scale;
-  int icon_width = 0;
-
-  int icon_size = RawPixel((type_ != DROP_DOWN) ? 22 : 10).CP(dpi_scale);
-  glib::Object<GdkPixbuf> const& pixbuf = MakePixbuf(icon_size);
-  bool icon_scalable = false;
+  glib::Object<GdkPixbuf> const& pixbuf = MakePixbuf();
+
+  unsigned int width = 0;
+  unsigned int icon_width = 0;
+  unsigned int height = panel::Style::Instance().PanelHeight(monitor_);

   // First lets figure out our size
   if (pixbuf && IsIconVisible())
   {
-    width = gdk_pixbuf_get_width(pixbuf);
-
-    if (gdk_pixbuf_get_height(pixbuf) == icon_size)
-    {
-      icon_scalable = true;
-      width /= dpi_scale;
-    }
-
+    width = PixbufWidth(pixbuf);
     icon_width = width;
   }

   if (!label.empty() && IsLabelVisible())
   {
+    using namespace panel;
+    PangoContext* cxt;
     PangoAttrList* attrs = nullptr;
-    auto panel_item = (type_ == MENU) ? panel::PanelItem::MENU : panel::PanelItem::INDICATOR;
-    std::string const& font = panel_style.GetFontDescription(panel_item);
+    PangoRectangle log_rect;
+    GdkScreen* screen = gdk_screen_get_default();
+    PangoFontDescription* desc = nullptr;
+    PanelItem panel_item = (type_ == MENU) ? PanelItem::MENU : PanelItem::INDICATOR;
+
+    Style& panel_style = Style::Instance();
+    std::string const& font_description = panel_style.GetFontDescription(panel_item);
+    int dpi = panel_style.GetTextDPI();

     if (proxy_->show_now())
     {
       if (!pango_parse_markup(label.c_str(), -1, '_', &attrs, nullptr, nullptr, nullptr))
       {
-        LOG_WARN(logger) << "Pango markup parsing failed";
+        g_debug("pango_parse_markup failed");
       }
     }

-    glib::Object<PangoContext> context(gdk_pango_context_get_for_screen(gdk_screen_get_default()));
-    std::shared_ptr<PangoFontDescription> desc(pango_font_description_from_string(font.c_str()), pango_font_description_free);
-    pango_context_set_font_description(context, desc.get());
-    pango_context_set_language(context, gtk_get_default_language());
+    desc = pango_font_description_from_string(font_description.c_str());
+    pango_font_description_set_weight(desc, PANGO_WEIGHT_NORMAL);
+
+    nux::CairoGraphics cairo_graphics(CAIRO_FORMAT_ARGB32, 1, 1);
+    cr = cairo_graphics.GetInternalContext();
+
+    layout = pango_cairo_create_layout(cr);
+    if (attrs)
+    {
+      pango_layout_set_attributes(layout, attrs);
+      pango_attr_list_unref(attrs);
+    }
+
+    pango_layout_set_font_description(layout, desc);

     label.erase(std::remove(label.begin(), label.end(), '_'), label.end());
-    layout = pango_layout_new(context);
-    pango_layout_set_height(layout, -1); //avoid wrap lines
     pango_layout_set_text(layout, label.c_str(), -1);
-    pango_layout_set_attributes(layout, attrs);
-    pango_attr_list_unref(attrs);
-
-    nux::Size extents;
-    pango_layout_get_pixel_size(layout, &extents.width, &extents.height);
+
+    cxt = pango_layout_get_context(layout);
+    pango_cairo_context_set_font_options(cxt, gdk_screen_get_font_options(screen));
+    pango_cairo_context_set_resolution(cxt, dpi / static_cast<float>(PANGO_SCALE));
+    pango_layout_context_changed(layout);
+
+    pango_layout_get_extents(layout, nullptr, &log_rect);
+    unsigned int text_width = log_rect.width / PANGO_SCALE;

     if (icon_width)
-      width += DEFAULT_SPACING;
+      width += spacing_.CP(cv_);
+    width += text_width;

-    width += extents.width;
+    pango_font_description_free(desc);
   }

   if (width)
-    width += padding_ * 2;
-
-  SetMinMaxSize(std::ceil(width * dpi_scale), std::ceil(height * dpi_scale));
-  nux::CairoGraphics cg(CAIRO_FORMAT_ARGB32, GetWidth(), GetHeight());
-  cairo_surface_set_device_scale(cg.GetSurface(), dpi_scale, dpi_scale);
+    width += left_padding_.CP(cv_) + right_padding_.CP(cv_);
+
+  SetMinimumWidth(width);
+  SetMaximumWidth(width);
+
+  nux::CairoGraphics cg(CAIRO_FORMAT_ARGB32, width, height);
   cr = cg.GetInternalContext();
   cairo_set_line_width(cr, 1);
   cairo_set_operator(cr, CAIRO_OPERATOR_CLEAR);
   cairo_paint(cr);

   cairo_set_operator(cr, CAIRO_OPERATOR_OVER);
-  DrawEntryContent(cr, width, height, pixbuf, icon_scalable, layout);
+  DrawEntryContent(cr, width, height, pixbuf, layout);

   entry_texture_ = texture_ptr_from_cairo_graphics(cg);
   SetTexture(entry_texture_.GetPointer());
@@ -553,12 +582,9 @@

 void PanelIndicatorEntryView::SetMonitor(int monitor)
 {
-  if (monitor_ == monitor)
-    return;
-
   monitor_ = monitor;
-  cv_ = Settings::Instance().em(monitor);
-  Refresh();
+
+  cv_ = unity::Settings::Instance().em(monitor);
 }

 void PanelIndicatorEntryView::SetOpacity(double opacity)

=== modified file 'panel/PanelIndicatorEntryView.h'
--- panel/PanelIndicatorEntryView.h	2014-02-28 04:45:20 +0000
+++ panel/PanelIndicatorEntryView.h	2014-02-19 02:16:22 +0000
@@ -34,6 +34,7 @@

 #include "unity-shared/EMConverter.h"
 #include "unity-shared/Introspectable.h"
+#include "unity-shared/RawPixel.h"


 namespace unity
@@ -101,7 +102,7 @@
   virtual void Draw(nux::GraphicsEngine& GfxContext, bool force_draw);
   virtual void DrawEntryPrelight(cairo_t* cr, unsigned int w, unsigned int h);
   virtual void DrawEntryContent(cairo_t* cr, unsigned int width, unsigned int height,
-                                glib::Object<GdkPixbuf> const& pixbuf, bool scalable,
+                                glib::Object<GdkPixbuf> const& pixbuf,
                                 glib::Object<PangoLayout> const& layout);

   void Refresh();
@@ -109,6 +110,11 @@
   virtual void ShowMenu(int button = 1);

   indicator::Entry::Ptr proxy_;
+  RawPixel spacing_;
+  RawPixel left_padding_;
+  RawPixel right_padding_;
+
+  int monitor_;

 private:
   void OnMouseDown(int x, int y, long button_flags, long key_flags);
@@ -116,19 +122,21 @@
   void OnMouseWheel(int x, int y, int delta, unsigned long mouse_state, unsigned long key_state);
   void OnActiveChanged(bool is_active);

-  glib::Object<GdkPixbuf> MakePixbuf(int size);
+  int PixbufWidth(glib::Object<GdkPixbuf> const& pixbuf) const;
+  int PixbufHeight(glib::Object<GdkPixbuf> const& pixbuf) const;
+
+  void ScaleImageIcons(cairo_t* cr, int* x, int* y);
+
+  glib::Object<GdkPixbuf> MakePixbuf();

   IndicatorEntryType type_;
   nux::ObjectPtr<nux::BaseTexture> entry_texture_;
   nux::Geometry cached_geo_;
-  glib::Signal<void, GtkIconTheme*> icon_theme_changed_;
-  int monitor_;
   double opacity_;
   bool draw_active_;
   bool overlay_showing_;
   bool disabled_;
   bool focused_;
-  int padding_;

   EMConverter::Ptr cv_;
 };

=== modified file 'panel/PanelIndicatorsView.cpp'
--- panel/PanelIndicatorsView.cpp	2014-02-25 02:38:26 +0000
+++ panel/PanelIndicatorsView.cpp	2014-02-19 02:16:22 +0000
@@ -381,9 +381,6 @@
 void PanelIndicatorsView::SetMonitor(int monitor)
 {
   monitor_ = monitor;
-
-  for (auto const& entry : entries_)
-    entry.second->SetMonitor(monitor_);
 }

 bool PanelIndicatorsView::SetOpacity(double& target, double const& new_value)

=== modified file 'panel/PanelMenuView.cpp'
--- panel/PanelMenuView.cpp	2014-02-27 05:45:23 +0000
+++ panel/PanelMenuView.cpp	2014-02-19 02:16:22 +0000
@@ -99,13 +99,12 @@
   titlebar_grab_area_->UnParentObject();
 }

-void PanelMenuView::OnStyleChanged()
+void PanelMenuView::OnDPIChanged()
 {
   int height = panel::Style::Instance().PanelHeight(monitor_);
-  window_buttons_->SetMinimumHeight(height);
   window_buttons_->SetMaximumHeight(height);
   window_buttons_->UpdateDPIChanged();
-
+  window_buttons_->ComputeContentSize();
   layout_->SetLeftAndRightPadding(window_buttons_->GetContentWidth(), 0);

   Refresh(true);
@@ -127,7 +126,8 @@
   mouse_leave.connect(sigc::mem_fun(this, &PanelMenuView::OnPanelViewMouseLeave));
   opacity_animator_.updated.connect(sigc::mem_fun(this, &PanelMenuView::OnFadeAnimatorUpdated));
   entry_added.connect(sigc::mem_fun(this, &PanelMenuView::OnEntryViewAdded));
-  Style::Instance().changed.connect(sigc::mem_fun(this, &PanelMenuView::OnStyleChanged));
+
+  Style::Instance().changed.connect(sigc::mem_fun(this, &PanelMenuView::OnDPIChanged));

   auto const& deco_style = decoration::Style::Get();
   lim_changed_connection_ = deco_style->integrated_menus.changed.connect([this] (bool lim) {
@@ -167,6 +167,7 @@
 {
   layout_->SetContentDistribution(nux::MAJOR_POSITION_START);
   layout_->SetLeftAndRightPadding(window_buttons_->GetContentWidth(), 0);
+  layout_->SetBaseHeight(panel::Style::Instance().PanelHeight(monitor_));
 }

 void PanelMenuView::SetupTitlebarGrabArea()
@@ -785,28 +786,26 @@
   auto const& style = decoration::Style::Get();
   auto text_size = style->TitleNaturalSize(label);
   auto state = WidgetState::NORMAL;
-  float dpi_scale = Settings::Instance().em(monitor_)->DPIScale();

   if (integrated_menus_ && !is_desktop_focused_ && !WindowManager::Default().IsScaleActive())
   {
-    title_geo_.x = geo.x + window_buttons_->GetBaseWidth() + (style->TitleIndent() * dpi_scale);
+    title_geo_.x = geo.x + window_buttons_->GetBaseWidth() + style->TitleIndent();

     if (!window_buttons_->focused())
       state = WidgetState::BACKDROP;
   }
   else
   {
-    title_geo_.x = geo.x + (MAIN_LEFT_PADDING + TITLE_PADDING) * dpi_scale;
+    title_geo_.x = geo.x + MAIN_LEFT_PADDING + TITLE_PADDING;
   }

-  title_geo_.y = geo.y + (geo.height - (text_size.height * dpi_scale)) / 2;
-  title_geo_.width = std::min<int>(std::ceil(text_size.width * dpi_scale), geo.width - title_geo_.x);
-  title_geo_.height = std::ceil(text_size.height * dpi_scale);
+  title_geo_.y = geo.y + (geo.height - text_size.height) / 2;
+  title_geo_.width = std::min(text_size.width, geo.width - title_geo_.x);
+  title_geo_.height = text_size.height;

   nux::CairoGraphics cairo_graphics(CAIRO_FORMAT_ARGB32, title_geo_.width, title_geo_.height);
-  cairo_surface_set_device_scale(cairo_graphics.GetSurface(), dpi_scale, dpi_scale);
   cairo_t* cr = cairo_graphics.GetInternalContext();
-  style->DrawTitle(label, state, cr, title_geo_.width / dpi_scale, title_geo_.height / dpi_scale);
+  style->DrawTitle(label, state, cr, title_geo_.width, title_geo_.height);
   title_texture_ = texture_ptr_from_cairo_graphics(cairo_graphics);
 }

@@ -1686,9 +1685,9 @@

 void PanelMenuView::SetMonitor(int monitor)
 {
-  PanelIndicatorsView::SetMonitor(monitor);
-
+  monitor_ = monitor;
   monitor_geo_ = UScreen::GetDefault()->GetMonitorGeometry(monitor_);
+
   maximized_set_.clear();
   GList* windows = bamf_matcher_get_window_stack_for_monitor(matcher_, monitor_);

@@ -1723,7 +1722,6 @@
   window_buttons_->monitor = monitor_;
   window_buttons_->controlled_window = buttons_win;

-  OnStyleChanged();
   g_list_free(windows);
 }


=== modified file 'panel/PanelMenuView.h'
--- panel/PanelMenuView.h	2014-02-27 05:45:23 +0000
+++ panel/PanelMenuView.h	2014-02-19 02:16:22 +0000
@@ -59,6 +59,8 @@
   virtual void OverlayShown();
   virtual void OverlayHidden();

+  void OnDPIChanged();
+
 protected:
   std::string GetName() const;
   void AddProperties(debug::IntrospectionData&);
@@ -90,7 +92,6 @@
   void OnActiveWindowChanged(BamfMatcher* matcher, BamfView* old_view, BamfView* new_view);
   void OnActiveAppChanged(BamfMatcher* matcher, BamfApplication* old_app, BamfApplication* new_app);
   void OnNameChanged(BamfView* bamf_view, gchar* new_name, gchar* old_name);
-  void OnStyleChanged();

   void OnSpreadInitiate();
   void OnSpreadTerminate();

=== modified file 'panel/PanelView.cpp'
--- panel/PanelView.cpp	2014-02-25 02:59:07 +0000
+++ panel/PanelView.cpp	2014-02-18 21:20:28 +0000
@@ -73,7 +73,7 @@
 {
   auto& wm = WindowManager::Default();
   panel::Style::Instance().changed.connect(sigc::mem_fun(this, &PanelView::ForceUpdateBackground));
-  Settings::Instance().dpi_changed.connect(sigc::mem_fun(this, &PanelView::Resize));
+  unity::Settings::Instance().dpi_changed.connect(sigc::mem_fun(this, &PanelView::OnDPIChanged));

   wm.average_color.changed.connect(sigc::mem_fun(this, &PanelView::OnBackgroundUpdate));
   wm.initiate_spread.connect(sigc::mem_fun(this, &PanelView::OnSpreadInitiate));
@@ -171,6 +171,13 @@
   return tray_->xid();
 }

+void PanelView::OnDPIChanged()
+{
+  int height = panel::Style::Instance().PanelHeight(monitor_);
+  tray_->SetMinMaxSize(1, height);
+  menu_view_->OnDPIChanged();
+}
+
 void PanelView::SetLauncherWidth(int width)
 {
   launcher_width_ = width;
@@ -468,6 +475,7 @@

       refine_geo.x = refine_x_pos;
       refine_geo.width = bg_refine_tex_->GetWidth();
+      refine_geo.height = bg_refine_tex_->GetHeight();

       if (!Settings::Instance().GetLowGfxMode())
       {
@@ -476,6 +484,7 @@

         refine_geo.x += refine_geo.width;
         refine_geo.width = geo.width;
+        refine_geo.height = geo.height;
         nux::GetPainter().PushLayer(GfxContext, refine_geo, bg_refine_single_column_layer_.get());
         bgs++;
       }
@@ -791,24 +800,21 @@
   monitor_ = monitor;
   menu_view_->SetMonitor(monitor);
   indicators_->SetMonitor(monitor);
-  Resize();
+
+  int height = panel::Style::Instance().PanelHeight(monitor_);
+  SetMinMaxSize(height, height);
+
+  UScreen* uscreen = UScreen::GetDefault();
+  auto monitor_geo = uscreen->GetMonitorGeometry(monitor);
+  Resize(nux::Point(monitor_geo.x, monitor_geo.y), monitor_geo.width);
 }

-void PanelView::Resize()
+void PanelView::Resize(nux::Point const& offset, int width)
 {
-  int height = Style::Instance().PanelHeight(monitor_);
-  auto const& monitor_geo = UScreen::GetDefault()->GetMonitorGeometry(monitor_);
-
-  SetMinMaxSize(monitor_geo.width, height);
-  parent_->SetGeometry({monitor_geo.x, monitor_geo.y, monitor_geo.width, height});
-
-  for (auto* child : layout_->GetChildren())
-  {
-    child->SetMinimumHeight(height);
-    child->SetMaximumHeight(height);
-  }
-
-  QueueRelayout();
+  unity::panel::Style &panel_style = panel::Style::Instance();
+  SetMaximumWidth(width);
+  SetGeometry(nux::Geometry(0, 0, width, panel_style.PanelHeight(monitor_)));
+  parent_->SetGeometry(nux::Geometry(offset.x, offset.y, width, panel_style.PanelHeight(monitor_)));
 }

 int PanelView::GetMonitor() const

=== modified file 'panel/PanelView.h'
--- panel/PanelView.h	2014-02-25 02:39:21 +0000
+++ panel/PanelView.h	2014-02-18 21:20:28 +0000
@@ -104,13 +104,15 @@

   bool ActivateFirstSensitive();
   bool ActivateEntry(std::string const& entry_id);
-  void Resize();
+  void Resize(nux::Point const& offset, int width);
   bool IsTransparent();
   void UpdateBackground();
   void ForceUpdateBackground();
   bool TrackMenuPointer();
   void SyncGeometries();
   void AddPanelView(PanelIndicatorsView* child, unsigned int stretchFactor);
+
+  void OnDPIChanged();

   MockableBaseWindow* parent_;
   indicator::Indicators::Ptr remote_;

=== modified file 'plugins/unityshell/src/unityshell.cpp'
--- plugins/unityshell/src/unityshell.cpp	2014-02-27 08:24:01 +0000
+++ plugins/unityshell/src/unityshell.cpp	2014-02-19 02:16:22 +0000
@@ -890,12 +890,10 @@

 void UnityScreen::DrawPanelUnderDash()
 {
-  if (!paint_panel_under_dash_ || (!dash_controller_->IsVisible() && !hud_controller_->IsVisible()))
+  if (!paint_panel_under_dash_ || !launcher_controller_->IsOverlayOpen())
     return;

-  auto const& output_dev = screen->currentOutputDev();
-
-  if (_last_output->id() != output_dev.id())
+  if (_last_output->id() != screen->currentOutputDev().id())
     return;

   auto graphics_engine = nux::GetGraphicsDisplay()->GetGraphicsEngine();
@@ -906,17 +904,18 @@
   graphics_engine->ResetModelViewMatrixStack();
   graphics_engine->Push2DTranslationModelViewMatrix(0.0f, 0.0f, 0.0f);
   graphics_engine->ResetProjectionMatrix();
-  graphics_engine->SetOrthographicProjectionMatrix(output_dev.width(), output_dev.height());
+  graphics_engine->SetOrthographicProjectionMatrix(screen->width(), screen->height());

   nux::TexCoordXForm texxform;
   texxform.SetWrap(nux::TEXWRAP_REPEAT, nux::TEXWRAP_CLAMP);

-  int monitor = WindowManager::Default().MonitorGeometryIn(NuxGeometryFromCompRect(output_dev));
-  auto const& texture = panel_style_.GetBackground(monitor)->GetDeviceTexture();
-  graphics_engine->QRP_GLSL_1Tex(0, 0, output_dev.width(), texture->GetHeight(), texture, texxform, nux::color::White);
+  // FIXME Change to paint per monitor vs all at once
+  int panel_height = panel_style_.PanelHeight();
+  auto const& texture = panel_style_.GetBackground()->GetDeviceTexture();
+  graphics_engine->QRP_GLSL_1Tex(0, 0, screen->width(), panel_height, texture, texxform, nux::color::White);
 }

-bool UnityScreen::forcePaintOnTop()
+bool UnityScreen::forcePaintOnTop ()
 {
     return !allowWindowPaint ||
       ((switcher_controller_->Visible() ||
@@ -2853,12 +2852,9 @@
                          const CompRegion& region,
                          unsigned int mask)
 {
-  auto window_state = window->state();
-  auto window_type = window->type();
-
-  if (uScreen->doShellRepaint && !uScreen->paint_panel_under_dash_ && window_type == CompWindowTypeNormalMask)
+  if (uScreen->doShellRepaint && !uScreen->paint_panel_under_dash_ && window->type() == CompWindowTypeNormalMask)
   {
-    if ((window_state & MAXIMIZE_STATE) && window->onCurrentDesktop() && !window->overrideRedirect() && window->managed())
+    if ((window->state() & MAXIMIZE_STATE) && window->onCurrentDesktop() && !window->overrideRedirect() && window->managed())
     {
       CompPoint const& viewport = window->defaultViewport();
       unsigned output = window->outputDevice();
@@ -2891,7 +2887,7 @@
   {
     Window active_window = screen->activeWindow();

-    if (G_UNLIKELY(window_type == CompWindowTypeDesktopMask))
+    if (G_UNLIKELY(window->type() == CompWindowTypeDesktopMask))
     {
       uScreen->setPanelShadowMatrix(matrix);

@@ -2911,9 +2907,9 @@
         draw_panel_shadow = DrawPanelShadow::BELOW_WINDOW;
         uScreen->is_desktop_active_ = false;

-        if (!(window_state & CompWindowStateMaximizedVertMask) &&
-            !(window_state & CompWindowStateFullscreenMask) &&
-            !(window_type & CompWindowTypeFullscreenMask))
+        if (!(window->state() & CompWindowStateMaximizedVertMask) &&
+            !(window->state() & CompWindowStateFullscreenMask) &&
+            !(window->type() & CompWindowTypeFullscreenMask))
         {
           WindowManager& wm = WindowManager::Default();
           auto const& output = uScreen->screen->currentOutputDev();
@@ -3821,7 +3817,8 @@

     if (texture->width() && texture->height())
     {
-      GLTexture::MatrixList ml({texture->matrix()});
+      GLTexture::MatrixList ml(1);
+      ml[0] = texture->matrix();
       CompRegion texture_region(0, 0, texture->width(), texture->height());
       gWindow->glAddGeometry(ml, texture_region, texture_region);
     }
@@ -3844,13 +3841,16 @@

   using namespace decoration;

-  aspect *= deco_win_->dpi_scale();
-  double w = ctx.width() / aspect;
-  double h = ctx.height() / aspect;
+  // We need to scale the cairo matrix in order to get the properly scaled
+  cairo_save(ctx);
+  cairo_scale(ctx, aspect, aspect);
+  int w = std::round(ctx.width() / aspect);
+  int h = std::round(ctx.height() / aspect);
   Style::Get()->DrawSide(Side::TOP, WidgetState::NORMAL, ctx, w, h);
+  cairo_restore(ctx);
 }

-void UnityWindow::RenderTitle(compiz_utils::CairoContext const& ctx, int x, int y, int width, int height, double aspect)
+void UnityWindow::RenderTitle(compiz_utils::CairoContext const& ctx, int x, int y, int width, int height)
 {
   using namespace decoration;
   auto const& style = Style::Get();
@@ -3860,7 +3860,6 @@
   y += (height - text_size.height)/2;

   cairo_save(ctx);
-  cairo_scale(ctx, 1.0f/aspect, 1.0f/aspect);
   cairo_translate(ctx, x, y);
   style->DrawTitle(title, WidgetState::NORMAL, ctx, width - x, height);
   cairo_restore(ctx);
@@ -3868,12 +3867,14 @@

 void UnityWindow::BuildDecorationTexture()
 {
+  if (decoration_tex_)
+    return;
+
   auto const& border = decoration::Style::Get()->Border();

   if (border.top)
   {
-    double dpi_scale = deco_win_->dpi_scale();
-    compiz_utils::CairoContext context(window->borderRect().width(), border.top * dpi_scale, dpi_scale);
+    compiz_utils::CairoContext context(window->borderRect().width(), border.top);
     RenderDecoration(context);
     decoration_tex_ = context;
   }
@@ -3895,8 +3896,7 @@
     if (!compiz_utils::IsWindowFullyDecorable(window))
       return;

-    if (!decoration_tex_)
-      BuildDecorationTexture();
+    BuildDecorationTexture();

     if (decoration_tex_)
       DrawTexture(*decoration_tex_, attrib, transform, mask, geo.x, geo.y, scale);
@@ -3906,9 +3906,8 @@
   else
   {
     auto const& style = decoration::Style::Get();
-    double dpi_scale = deco_win_->dpi_scale();
     int width = geo.width;
-    int height = style->Border().top * dpi_scale;
+    int height = style->Border().top;
     auto const& padding = style->Padding(decoration::Side::TOP);
     bool redraw_decoration = true;
     compiz_utils::SimpleTexture::Ptr close_texture;
@@ -3926,19 +3925,19 @@
     if (window->actions() & CompWindowActionCloseMask)
     {
       using namespace decoration;
-      close_texture = DataPool::Get()->ButtonTexture(dpi_scale, WindowButtonType::CLOSE, close_icon_state_);
+      close_texture = DataPool::Get()->ButtonTexture(WindowButtonType::CLOSE, close_icon_state_);
     }

     if (redraw_decoration)
     {
       if (width != 0 && height != 0)
       {
-        compiz_utils::CairoContext context(width, height, scale * dpi_scale);
+        compiz_utils::CairoContext context(width, height);
         RenderDecoration(context, scale);

         // Draw window title
-        int text_x = padding.left + (close_texture ? close_texture->width() : 0) / dpi_scale;
-        RenderTitle(context, text_x, padding.top, (width - padding.right) / dpi_scale, height / dpi_scale, scale);
+        int text_x = padding.left + (close_texture ? close_texture->width() : 0);
+        RenderTitle(context, text_x, padding.top, width - padding.right, height);
         decoration_selected_tex_ = context;
         uScreen->damageRegion(CompRegionFromNuxGeo(geo));
       }
@@ -3954,12 +3953,10 @@

     if (close_texture)
     {
-      int w = close_texture->width();
-      int h = close_texture->height();
-      int x = geo.x + padding.left * dpi_scale;
-      int y = geo.y + padding.top * dpi_scale + (height - w) / 2.0f;
+      int x = geo.x + padding.left;
+      int y = geo.y + padding.top + (height - close_texture->height()) / 2.0f;

-      close_button_geo_.Set(x, y, w, h);
+      close_button_geo_.Set(x, y, close_texture->width(), close_texture->height());
       DrawTexture(*close_texture, attrib, transform, mask, x, y);
     }
     else
@@ -4044,8 +4041,7 @@
 {
   using namespace decoration;
   auto const& style = Style::Get();
-  double dpi_scale = deco_win_->dpi_scale();
-  unsigned glow_size = std::round(style->GlowSize() * dpi_scale);
+  unsigned glow_size = style->GlowSize();
   auto const& glow_texture = DataPool::Get()->GlowTexture();

   if (!glow_size || !glow_texture)
@@ -4058,7 +4054,7 @@
   {
     // We paint the glow below the window edges to correctly
     // render the rounded corners
-    int inside_glow = decoration_radius * dpi_scale / 4;
+    int inside_glow = decoration_radius / 4;
     glow_size += inside_glow;
     glow_geo.Expand(-inside_glow, -inside_glow);
   }

=== modified file 'plugins/unityshell/src/unityshell.h'
--- plugins/unityshell/src/unityshell.h	2014-02-24 18:21:09 +0000
+++ plugins/unityshell/src/unityshell.h	2014-02-18 21:21:16 +0000
@@ -519,7 +519,7 @@
   compiz::WindowInputRemoverLock::Ptr GetInputRemover ();

   void RenderDecoration(compiz_utils::CairoContext const&, double aspect = 1.0f);
-  void RenderTitle(compiz_utils::CairoContext const&, int x, int y, int width, int height, double aspect = 1.0f);
+  void RenderTitle(compiz_utils::CairoContext const&, int x, int y, int width, int height);
   void DrawTexture(GLTexture::List const& textures, GLWindowPaintAttrib const&,
                    GLMatrix const&, unsigned mask, int x, int y, double aspect = 1.0f);


=== added file 'resources/close_dash.png'
Binary files resources/close_dash.png	1970-01-01 00:00:00 +0000 and resources/close_dash.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/close_dash.svg'
--- resources/close_dash.svg	2014-02-28 17:47:00 +0000
+++ resources/close_dash.svg	1970-01-01 00:00:00 +0000
@@ -1,74 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="close_dash.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="0.35"
-     inkscape:cx="9.5000027"
-     inkscape:cy="9.5000031"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       transform="translate(-289.7143,-511.00011)"
-       style="display:inline"
-       id="g4113">
-      <path
-         id="circle4507"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,97.5 A 7.4999798,7.4999798 0 0 0 78,105 7.4999798,7.4999798 0 0 0 85.5,112.5 7.4999798,7.4999798 0 0 0 93,105 7.4999798,7.4999798 0 0 0 85.5,97.5 Z m -2.5,4.22266 0.388672,0.38867 L 85.5,104.22266 87.611328,102.11133 88,101.72266 88.777344,102.5 88.388672,102.89062 86.277344,105 88.388672,107.11133 88.777344,107.5 88,108.2793 87.611328,107.89062 85.5,105.7793 83.388672,107.89062 83,108.2793 82.222656,107.5 82.611328,107.11133 84.722656,105 82.611328,102.89062 82.222656,102.5 83,101.72266 Z"
-         style="color:#000000;fill:#dd4814;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         inkscape:connector-curvature="0" />
-      <rect
-         y="1033.8623"
-         x="-0.5000006"
-         height="19"
-         width="19"
-         id="rect4539"
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/close_dash_disabled.png'
Binary files resources/close_dash_disabled.png	1970-01-01 00:00:00 +0000 and resources/close_dash_disabled.png	2012-02-12 15:48:12 +0000 differ
=== removed file 'resources/close_dash_disabled.svg'
--- resources/close_dash_disabled.svg	2014-02-28 17:47:00 +0000
+++ resources/close_dash_disabled.svg	1970-01-01 00:00:00 +0000
@@ -1,74 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="close_dash_disabled.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       style="display:inline"
-       id="g4117"
-       transform="translate(-289.71429,-511.00011)">
-      <path
-         style="color:#000000;fill:#dd4814;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         d="M 85.5,97.5 A 7.4999798,7.4999798 0 0 0 78,105 7.4999798,7.4999798 0 0 0 85.5,112.5 7.4999798,7.4999798 0 0 0 93,105 7.4999798,7.4999798 0 0 0 85.5,97.5 Z m -2.5,4.22266 0.388672,0.38867 L 85.5,104.22266 87.611328,102.11133 88,101.72266 88.777344,102.5 88.388672,102.89062 86.277344,105 88.388672,107.11133 88.777344,107.5 88,108.2793 87.611328,107.89062 85.5,105.7793 83.388672,107.89062 83,108.2793 82.222656,107.5 82.611328,107.11133 84.722656,105 82.611328,102.89062 82.222656,102.5 83,101.72266 Z"
-         transform="translate(-76.500002,938.36224)"
-         id="path4119"
-         inkscape:connector-curvature="0" />
-      <rect
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         id="rect4121"
-         width="19"
-         height="19"
-         x="-0.5000006"
-         y="1033.8623" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/close_dash_prelight.png'
Binary files resources/close_dash_prelight.png	1970-01-01 00:00:00 +0000 and resources/close_dash_prelight.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/close_dash_prelight.svg'
--- resources/close_dash_prelight.svg	2014-02-28 17:47:00 +0000
+++ resources/close_dash_prelight.svg	1970-01-01 00:00:00 +0000
@@ -1,94 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="close_dash_prelight.svg">
-  <defs
-     id="defs4488">
-    <filter
-       inkscape:collect="always"
-       style="color-interpolation-filters:sRGB"
-       id="filter4195"
-       x="-0.12"
-       width="1.24"
-       y="-0.12"
-       height="1.24">
-      <feGaussianBlur
-         inkscape:collect="always"
-         stdDeviation="0.75"
-         id="feGaussianBlur4197" />
-    </filter>
-  </defs>
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       style="display:inline"
-       id="g4131"
-       transform="translate(-289.71429,-511.00011)">
-      <path
-         style="color:#000000;fill:#dd4814;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         d="M 85.5,97.5 A 7.4999798,7.4999798 0 0 0 78,105 7.4999798,7.4999798 0 0 0 85.5,112.5 7.4999798,7.4999798 0 0 0 93,105 7.4999798,7.4999798 0 0 0 85.5,97.5 Z m -2.5,4.22266 0.388672,0.38867 L 85.5,104.22266 87.611328,102.11133 88,101.72266 88.777344,102.5 88.388672,102.89062 86.277344,105 88.388672,107.11133 88.777344,107.5 88,108.2793 87.611328,107.89062 85.5,105.7793 83.388672,107.89062 83,108.2793 82.222656,107.5 82.611328,107.11133 84.722656,105 82.611328,102.89062 82.222656,102.5 83,101.72266 Z"
-         transform="translate(-76.500002,938.36224)"
-         id="path4133"
-         inkscape:connector-curvature="0" />
-      <rect
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         id="rect4135"
-         width="19"
-         height="19"
-         x="-0.5000006"
-         y="1033.8623" />
-      <path
-         inkscape:connector-curvature="0"
-         id="path4137"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,97.5 A 7.4999798,7.4999798 0 0 0 78,105 7.4999798,7.4999798 0 0 0 85.5,112.5 7.4999798,7.4999798 0 0 0 93,105 7.4999798,7.4999798 0 0 0 85.5,97.5 Z m -2.5,4.22266 0.388672,0.38867 L 85.5,104.22266 87.611328,102.11133 88,101.72266 88.777344,102.5 88.388672,102.89062 86.277344,105 88.388672,107.11133 88.777344,107.5 88,108.2793 87.611328,107.89062 85.5,105.7793 83.388672,107.89062 83,108.2793 82.222656,107.5 82.611328,107.11133 84.722656,105 82.611328,102.89062 82.222656,102.5 83,101.72266 Z"
-         style="color:#000000;fill:#dd4814;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;filter:url(#filter4195);enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/close_dash_pressed.png'
Binary files resources/close_dash_pressed.png	1970-01-01 00:00:00 +0000 and resources/close_dash_pressed.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/close_dash_pressed.svg'
--- resources/close_dash_pressed.svg	2014-02-28 17:47:00 +0000
+++ resources/close_dash_pressed.svg	1970-01-01 00:00:00 +0000
@@ -1,74 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="close_dash_pressed.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       transform="translate(-289.71429,-511.00011)"
-       id="g4123"
-       style="opacity:0.6;display:inline">
-      <path
-         inkscape:connector-curvature="0"
-         id="path4125"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,97.5 A 7.4999798,7.4999798 0 0 0 78,105 7.4999798,7.4999798 0 0 0 85.5,112.5 7.4999798,7.4999798 0 0 0 93,105 7.4999798,7.4999798 0 0 0 85.5,97.5 Z m -2.5,4.22266 0.388672,0.38867 L 85.5,104.22266 87.611328,102.11133 88,101.72266 88.777344,102.5 88.388672,102.89062 86.277344,105 88.388672,107.11133 88.777344,107.5 88,108.2793 87.611328,107.89062 85.5,105.7793 83.388672,107.89062 83,108.2793 82.222656,107.5 82.611328,107.11133 84.722656,105 82.611328,102.89062 82.222656,102.5 83,101.72266 Z"
-         style="color:#000000;fill:#dd4814;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-      <rect
-         y="1033.8623"
-         x="-0.5000006"
-         height="19"
-         width="19"
-         id="rect4127"
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/maximize_dash.png'
Binary files resources/maximize_dash.png	1970-01-01 00:00:00 +0000 and resources/maximize_dash.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/maximize_dash.svg'
--- resources/maximize_dash.svg	2014-02-28 17:47:00 +0000
+++ resources/maximize_dash.svg	1970-01-01 00:00:00 +0000
@@ -1,73 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="maximize_dash.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       transform="translate(-289.71429,-492.00011)"
-       style="display:inline"
-       id="g4218">
-      <path
-         inkscape:connector-curvature="0"
-         id="path4209"
-         d="m 8.999998,1016.8622 a 7.4999796,7.4999796 0 0 0 -7.5,7.5 7.4999796,7.4999796 0 0 0 7.5,7.5 7.4999796,7.4999796 0 0 0 7.5,-7.5 7.4999796,7.4999796 0 0 0 -7.5,-7.5 z m -3.5,4 7,0 0,7 -7,0 0,-6.5 0,-0.5 z m 1,1 0,5 5,0 0,-5 -5,0 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-      <rect
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         id="rect4203"
-         width="19"
-         height="19"
-         x="-0.5000006"
-         y="1014.8623" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/maximize_dash_disabled.png'
Binary files resources/maximize_dash_disabled.png	1970-01-01 00:00:00 +0000 and resources/maximize_dash_disabled.png	2012-02-12 15:48:12 +0000 differ
=== removed file 'resources/maximize_dash_disabled.svg'
--- resources/maximize_dash_disabled.svg	2014-02-28 17:47:00 +0000
+++ resources/maximize_dash_disabled.svg	1970-01-01 00:00:00 +0000
@@ -1,73 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="maximize_dash_disabled.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       style="opacity:0.25;display:inline"
-       transform="translate(-289.71429,-492.00011)"
-       id="g4240">
-      <path
-         inkscape:connector-curvature="0"
-         id="path4242"
-         d="m 8.999998,1016.8622 a 7.4999796,7.4999796 0 0 0 -7.5,7.5 7.4999796,7.4999796 0 0 0 7.5,7.5 7.4999796,7.4999796 0 0 0 7.5,-7.5 7.4999796,7.4999796 0 0 0 -7.5,-7.5 z m -3.5,4 7,0 0,7 -7,0 0,-6.5 0,-0.5 z m 1,1 0,5 5,0 0,-5 -5,0 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-      <rect
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         id="rect4244"
-         width="19"
-         height="19"
-         x="-0.5000006"
-         y="1014.8623" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/maximize_dash_prelight.png'
Binary files resources/maximize_dash_prelight.png	1970-01-01 00:00:00 +0000 and resources/maximize_dash_prelight.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/maximize_dash_prelight.svg'
--- resources/maximize_dash_prelight.svg	2014-02-28 17:47:00 +0000
+++ resources/maximize_dash_prelight.svg	1970-01-01 00:00:00 +0000
@@ -1,92 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="maximize_dash_prelight.svg">
-  <defs
-     id="defs4488">
-    <filter
-       inkscape:collect="always"
-       style="color-interpolation-filters:sRGB"
-       id="filter4230"
-       x="-0.12"
-       width="1.24"
-       y="-0.12"
-       height="1.24">
-      <feGaussianBlur
-         inkscape:collect="always"
-         stdDeviation="0.75"
-         id="feGaussianBlur4232" />
-    </filter>
-  </defs>
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       style="display:inline"
-       id="g4222"
-       transform="translate(-289.71429,-492.00011)">
-      <path
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         d="m 8.999998,1016.8622 a 7.4999796,7.4999796 0 0 0 -7.5,7.5 7.4999796,7.4999796 0 0 0 7.5,7.5 7.4999796,7.4999796 0 0 0 7.5,-7.5 7.4999796,7.4999796 0 0 0 -7.5,-7.5 z m -3.5,4 7,0 0,7 -7,0 0,-6.5 0,-0.5 z m 1,1 0,5 5,0 0,-5 -5,0 z"
-         id="path4224"
-         inkscape:connector-curvature="0" />
-      <rect
-         y="1014.8623"
-         x="-0.5000006"
-         height="19"
-         width="19"
-         id="rect4226"
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-      <path
-         inkscape:connector-curvature="0"
-         id="path4228"
-         d="m 8.999998,1016.8622 a 7.4999796,7.4999796 0 0 0 -7.5,7.5 7.4999796,7.4999796 0 0 0 7.5,7.5 7.4999796,7.4999796 0 0 0 7.5,-7.5 7.4999796,7.4999796 0 0 0 -7.5,-7.5 z m -3.5,4 7,0 0,7 -7,0 0,-6.5 0,-0.5 z m 1,1 0,5 5,0 0,-5 -5,0 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;filter:url(#filter4230);enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/maximize_dash_pressed.png'
Binary files resources/maximize_dash_pressed.png	1970-01-01 00:00:00 +0000 and resources/maximize_dash_pressed.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/maximize_dash_pressed.svg'
--- resources/maximize_dash_pressed.svg	2014-02-28 17:47:00 +0000
+++ resources/maximize_dash_pressed.svg	1970-01-01 00:00:00 +0000
@@ -1,73 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="maximize_dash_pressed.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       id="g4234"
-       transform="translate(-289.71429,-492.00011)"
-       style="opacity:0.5;display:inline">
-      <path
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         d="m 8.999998,1016.8622 a 7.4999796,7.4999796 0 0 0 -7.5,7.5 7.4999796,7.4999796 0 0 0 7.5,7.5 7.4999796,7.4999796 0 0 0 7.5,-7.5 7.4999796,7.4999796 0 0 0 -7.5,-7.5 z m -3.5,4 7,0 0,7 -7,0 0,-6.5 0,-0.5 z m 1,1 0,5 5,0 0,-5 -5,0 z"
-         id="path4236"
-         inkscape:connector-curvature="0" />
-      <rect
-         y="1014.8623"
-         x="-0.5000006"
-         height="19"
-         width="19"
-         id="rect4238"
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/minimize_dash.png'
Binary files resources/minimize_dash.png	1970-01-01 00:00:00 +0000 and resources/minimize_dash.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/minimize_dash.svg'
--- resources/minimize_dash.svg	2014-02-28 17:47:00 +0000
+++ resources/minimize_dash.svg	1970-01-01 00:00:00 +0000
@@ -1,74 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="minimize_dash.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       transform="translate(-289.71429,-473.00011)"
-       id="g4261"
-       style="opacity:0.5;display:inline">
-      <path
-         id="path4256"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,59.5 A 7.4999794,7.4999794 0 0 0 78,67 7.4999794,7.4999794 0 0 0 85.5,74.5 7.4999794,7.4999794 0 0 0 93,67 7.4999794,7.4999794 0 0 0 85.5,59.5 Z m -3.5,7 7,0 0,1 -7,0 0,-1 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         inkscape:connector-curvature="0" />
-      <rect
-         y="995.8623"
-         x="-0.5000006"
-         height="19"
-         width="19"
-         id="rect4250"
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/minimize_dash_disabled.png'
Binary files resources/minimize_dash_disabled.png	1970-01-01 00:00:00 +0000 and resources/minimize_dash_disabled.png	2012-02-12 15:48:12 +0000 differ
=== removed file 'resources/minimize_dash_disabled.svg'
--- resources/minimize_dash_disabled.svg	2014-02-28 17:47:00 +0000
+++ resources/minimize_dash_disabled.svg	1970-01-01 00:00:00 +0000
@@ -1,74 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="minimize_dash_disabled.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       transform="translate(-289.71429,-473.00011)"
-       id="g4261"
-       style="opacity:0.25;display:inline">
-      <path
-         id="path4256"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,59.5 A 7.4999794,7.4999794 0 0 0 78,67 7.4999794,7.4999794 0 0 0 85.5,74.5 7.4999794,7.4999794 0 0 0 93,67 7.4999794,7.4999794 0 0 0 85.5,59.5 Z m -3.5,7 7,0 0,1 -7,0 0,-1 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         inkscape:connector-curvature="0" />
-      <rect
-         y="995.8623"
-         x="-0.5000006"
-         height="19"
-         width="19"
-         id="rect4250"
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/minimize_dash_prelight.png'
Binary files resources/minimize_dash_prelight.png	1970-01-01 00:00:00 +0000 and resources/minimize_dash_prelight.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/minimize_dash_prelight.svg'
--- resources/minimize_dash_prelight.svg	2014-02-28 17:47:00 +0000
+++ resources/minimize_dash_prelight.svg	1970-01-01 00:00:00 +0000
@@ -1,94 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="minimize_dash_prelight.svg">
-  <defs
-     id="defs4488">
-    <filter
-       inkscape:collect="always"
-       style="color-interpolation-filters:sRGB"
-       id="filter4411"
-       x="-0.12"
-       width="1.24"
-       y="-0.12"
-       height="1.24">
-      <feGaussianBlur
-         inkscape:collect="always"
-         stdDeviation="0.75"
-         id="feGaussianBlur4413" />
-    </filter>
-  </defs>
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       style="display:inline"
-       id="g4265"
-       transform="translate(-289.71429,-473.00011)">
-      <path
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         d="M 85.5,59.5 A 7.4999794,7.4999794 0 0 0 78,67 7.4999794,7.4999794 0 0 0 85.5,74.5 7.4999794,7.4999794 0 0 0 93,67 7.4999794,7.4999794 0 0 0 85.5,59.5 Z m -3.5,7 7,0 0,1 -7,0 0,-1 z"
-         transform="translate(-76.500002,938.36224)"
-         id="path4267"
-         inkscape:connector-curvature="0" />
-      <rect
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         id="rect4269"
-         width="19"
-         height="19"
-         x="-0.5000006"
-         y="995.8623" />
-      <path
-         inkscape:connector-curvature="0"
-         id="path4409"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,59.5 A 7.4999794,7.4999794 0 0 0 78,67 7.4999794,7.4999794 0 0 0 85.5,74.5 7.4999794,7.4999794 0 0 0 93,67 7.4999794,7.4999794 0 0 0 85.5,59.5 Z m -3.5,7 7,0 0,1 -7,0 0,-1 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;filter:url(#filter4411);enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/minimize_dash_pressed.png'
Binary files resources/minimize_dash_pressed.png	1970-01-01 00:00:00 +0000 and resources/minimize_dash_pressed.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/minimize_dash_pressed.svg'
--- resources/minimize_dash_pressed.svg	2014-02-28 17:47:00 +0000
+++ resources/minimize_dash_pressed.svg	1970-01-01 00:00:00 +0000
@@ -1,74 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="minimize_dash_pressed.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       transform="translate(-289.71429,-473.00011)"
-       id="g4261"
-       style="opacity:0.5;display:inline">
-      <path
-         id="path4256"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,59.5 A 7.4999794,7.4999794 0 0 0 78,67 7.4999794,7.4999794 0 0 0 85.5,74.5 7.4999794,7.4999794 0 0 0 93,67 7.4999794,7.4999794 0 0 0 85.5,59.5 Z m -3.5,7 7,0 0,1 -7,0 0,-1 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         inkscape:connector-curvature="0" />
-      <rect
-         y="995.8623"
-         x="-0.5000006"
-         height="19"
-         width="19"
-         id="rect4250"
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/progress_bar_fill.png'
Binary files resources/progress_bar_fill.png	1970-01-01 00:00:00 +0000 and resources/progress_bar_fill.png	2010-12-15 19:21:14 +0000 differ
=== removed file 'resources/progress_bar_fill.svg'
--- resources/progress_bar_fill.svg	2014-02-27 01:35:15 +0000
+++ resources/progress_bar_fill.svg	1970-01-01 00:00:00 +0000
@@ -1,141 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="42"
-   height="4"
-   id="svg2"
-   version="1.1"
-   inkscape:version="0.48.4 r9939"
-   inkscape:export-filename="/home/marco/Dev/unity/trunk/resources/progress_bar_trough_150.png"
-   inkscape:export-xdpi="250"
-   inkscape:export-ydpi="250"
-   sodipodi:docname="progress_bar_trough.svg">
-  <defs
-     id="defs4">
-    <marker
-       inkscape:stockid="Torso"
-       orient="auto"
-       refY="0"
-       refX="0"
-       id="Torso"
-       style="overflow:visible">
-      <g
-         id="g4192"
-         transform="scale(0.7,0.7)">
-        <path
-           id="path4194"
-           d="m -4.7792281,-3.239542 c 2.350374,0.3659393 5.30026732,1.9375477 5.03715532,3.62748546 C -0.00518779,2.0778819 -2.2126741,2.6176539 -4.5630471,2.2517169 -6.9134221,1.8857769 -8.521035,0.75201414 -8.257922,-0.93792336 -7.994809,-2.6278615 -7.1296041,-3.6054813 -4.7792281,-3.239542 z"
-           style="fill:none;stroke:#000000;stroke-width:1.25"
-           inkscape:connector-curvature="0" />
-        <path
-           id="path4196"
-           d="M 4.4598789,0.08866574 C -2.5564571,-4.378332 5.2248769,-3.9061806 -0.84829578,-8.7197331"
-           style="fill:none;stroke:#000000;stroke-width:1pt"
-           inkscape:connector-curvature="0" />
-        <path
-           id="path4198"
-           d="M 4.9298719,0.05752074 C -1.3872731,1.7494689 1.8027579,5.4782079 -4.9448731,7.5462725"
-           style="fill:none;stroke:#000000;stroke-width:1pt"
-           inkscape:connector-curvature="0" />
-        <rect
-           id="rect4200"
-           transform="matrix(0.527536,-0.849533,0.887668,0.460484,0,0)"
-           y="-1.7408575"
-           x="-10.391706"
-           height="2.7608147"
-           width="2.6366582"
-           style="fill-rule:evenodd;stroke-width:1pt" />
-        <rect
-           id="rect4202"
-           transform="matrix(0.671205,-0.741272,0.790802,0.612072,0,0)"
-           y="-7.9629307"
-           x="4.9587269"
-           height="2.8614161"
-           width="2.7327356"
-           style="fill-rule:evenodd;stroke-width:1pt" />
-        <path
-           id="path4204"
-           transform="matrix(0,-1.109517,1.109517,0,25.96648,19.71619)"
-           d="m 16.779951,-28.685045 a 0.60731727,0.60731727 0 1 0 -1.214634,0 0.60731727,0.60731727 0 1 0 1.214634,0 z"
-           style="fill:#ff0000;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:1pt"
-           inkscape:connector-curvature="0" />
-        <path
-           id="path4206"
-           transform="matrix(0,-1.109517,1.109517,0,26.8245,16.99126)"
-           d="m 16.779951,-28.685045 a 0.60731727,0.60731727 0 1 0 -1.214634,0 0.60731727,0.60731727 0 1 0 1.214634,0 z"
-           style="fill:#ff0000;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:1pt"
-           inkscape:connector-curvature="0" />
-      </g>
-    </marker>
-    <marker
-       inkscape:stockid="Arrow1Lstart"
-       orient="auto"
-       refY="0"
-       refX="0"
-       id="Arrow1Lstart"
-       style="overflow:visible">
-      <path
-         id="path3980"
-         d="M 0,0 5,-5 -12.5,0 5,5 0,0 z"
-         style="fill-rule:evenodd;stroke:#000000;stroke-width:1pt"
-         transform="matrix(0.8,0,0,0.8,10,0)"
-         inkscape:connector-curvature="0" />
-    </marker>
-  </defs>
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#12f82b"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9195959"
-     inkscape:cx="47.76404"
-     inkscape:cy="27.178915"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer2"
-     showgrid="false"
-     inkscape:window-width="1450"
-     inkscape:window-height="793"
-     inkscape:window-x="551"
-     inkscape:window-y="125"
-     inkscape:window-maximized="0" />
-  <metadata
-     id="metadata7">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:groupmode="layer"
-     id="layer2"
-     inkscape:label="Livello"
-     style="display:inline"
-     transform="translate(0,-1048.3622)">
-    <rect
-       style="fill:#bdbdbd;fill-opacity:1;stroke:#ffffff;stroke-width:0;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:0;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0;display:inline"
-       id="rect5033"
-       width="42"
-       height="4"
-       x="0"
-       y="1048.3622"
-       ry="1.4394673"
-       inkscape:export-filename="/tmp/progress.png"
-       inkscape:export-xdpi="90"
-       inkscape:export-ydpi="90" />
-  </g>
-</svg>

=== added file 'resources/progress_bar_trough.png'
Binary files resources/progress_bar_trough.png	1970-01-01 00:00:00 +0000 and resources/progress_bar_trough.png	2010-12-15 19:21:14 +0000 differ
=== removed file 'resources/progress_bar_trough.svg'
--- resources/progress_bar_trough.svg	2014-02-27 02:37:18 +0000
+++ resources/progress_bar_trough.svg	1970-01-01 00:00:00 +0000
@@ -1,179 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:xlink="http://www.w3.org/1999/xlink"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="54"
-   height="54"
-   id="svg2"
-   version="1.1"
-   inkscape:version="0.48.4 r9939"
-   inkscape:export-filename="/home/marco/Dev/unity/trunk/resources/progress_bar_trough_150.png"
-   inkscape:export-xdpi="250"
-   inkscape:export-ydpi="250"
-   sodipodi:docname="progress_bar_trough.svg">
-  <defs
-     id="defs4">
-    <marker
-       inkscape:stockid="Torso"
-       orient="auto"
-       refY="0"
-       refX="0"
-       id="Torso"
-       style="overflow:visible">
-      <g
-         id="g4192"
-         transform="scale(0.7,0.7)">
-        <path
-           id="path4194"
-           d="m -4.7792281,-3.239542 c 2.350374,0.3659393 5.30026732,1.9375477 5.03715532,3.62748546 C -0.00518779,2.0778819 -2.2126741,2.6176539 -4.5630471,2.2517169 -6.9134221,1.8857769 -8.521035,0.75201414 -8.257922,-0.93792336 -7.994809,-2.6278615 -7.1296041,-3.6054813 -4.7792281,-3.239542 z"
-           style="fill:none;stroke:#000000;stroke-width:1.25"
-           inkscape:connector-curvature="0" />
-        <path
-           id="path4196"
-           d="M 4.4598789,0.08866574 C -2.5564571,-4.378332 5.2248769,-3.9061806 -0.84829578,-8.7197331"
-           style="fill:none;stroke:#000000;stroke-width:1pt"
-           inkscape:connector-curvature="0" />
-        <path
-           id="path4198"
-           d="M 4.9298719,0.05752074 C -1.3872731,1.7494689 1.8027579,5.4782079 -4.9448731,7.5462725"
-           style="fill:none;stroke:#000000;stroke-width:1pt"
-           inkscape:connector-curvature="0" />
-        <rect
-           id="rect4200"
-           transform="matrix(0.527536,-0.849533,0.887668,0.460484,0,0)"
-           y="-1.7408575"
-           x="-10.391706"
-           height="2.7608147"
-           width="2.6366582"
-           style="fill-rule:evenodd;stroke-width:1pt" />
-        <rect
-           id="rect4202"
-           transform="matrix(0.671205,-0.741272,0.790802,0.612072,0,0)"
-           y="-7.9629307"
-           x="4.9587269"
-           height="2.8614161"
-           width="2.7327356"
-           style="fill-rule:evenodd;stroke-width:1pt" />
-        <path
-           id="path4204"
-           transform="matrix(0,-1.109517,1.109517,0,25.96648,19.71619)"
-           d="m 16.779951,-28.685045 a 0.60731727,0.60731727 0 1 0 -1.214634,0 0.60731727,0.60731727 0 1 0 1.214634,0 z"
-           style="fill:#ff0000;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:1pt"
-           inkscape:connector-curvature="0" />
-        <path
-           id="path4206"
-           transform="matrix(0,-1.109517,1.109517,0,26.8245,16.99126)"
-           d="m 16.779951,-28.685045 a 0.60731727,0.60731727 0 1 0 -1.214634,0 0.60731727,0.60731727 0 1 0 1.214634,0 z"
-           style="fill:#ff0000;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:1pt"
-           inkscape:connector-curvature="0" />
-      </g>
-    </marker>
-    <marker
-       inkscape:stockid="Arrow1Lstart"
-       orient="auto"
-       refY="0"
-       refX="0"
-       id="Arrow1Lstart"
-       style="overflow:visible">
-      <path
-         id="path3980"
-         d="M 0,0 5,-5 -12.5,0 5,5 0,0 z"
-         style="fill-rule:evenodd;stroke:#000000;stroke-width:1pt"
-         transform="matrix(0.8,0,0,0.8,10,0)"
-         inkscape:connector-curvature="0" />
-    </marker>
-    <filter
-       inkscape:collect="always"
-       id="filter6680"
-       x="-0.056347826"
-       width="1.1126957"
-       y="-0.324"
-       height="1.648">
-      <feGaussianBlur
-         inkscape:collect="always"
-         stdDeviation="1.08"
-         id="feGaussianBlur6682" />
-    </filter>
-  </defs>
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#5277f0"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="11.962963"
-     inkscape:cx="27"
-     inkscape:cy="27"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     inkscape:window-width="1450"
-     inkscape:window-height="793"
-     inkscape:window-x="503"
-     inkscape:window-y="97"
-     inkscape:window-maximized="0" />
-  <metadata
-     id="metadata7">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title />
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Livello 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     style="display:inline"
-     transform="translate(0,-998.36218)">
-    <image
-       y="346.57648"
-       x="413.71429"
-       id="image3023"
-       xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAABHNCSVQICAgIfAhkiAAAAAxJREFU CJljYCAZAAAAMwAB0kOx4wAAAABJRU5ErkJggg== "
-       height="3"
-       width="4" />
-    <rect
-       style="fill:#ffffff;fill-opacity:1;stroke:#ffffff;stroke-width:0;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:18.70000076000000178;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0;opacity:0.555;filter:url(#filter6680)"
-       id="rect5033-0"
-       width="46"
-       height="8"
-       x="4"
-       y="1021.3622"
-       ry="2.8789341"
-       inkscape:export-filename="/tmp/progress.png"
-       inkscape:export-xdpi="90"
-       inkscape:export-ydpi="90" />
-  </g>
-  <g
-     inkscape:groupmode="layer"
-     id="layer2"
-     inkscape:label="Livello"
-     style="display:inline"
-     transform="translate(0,-998.36218)">
-    <rect
-       style="fill:#838383;fill-opacity:1;stroke:#ffffff;stroke-width:2.02898455;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:0;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0"
-       id="rect5033"
-       width="43.971016"
-       height="5.9710155"
-       x="5.0144925"
-       y="1022.3766"
-       ry="2.1487703"
-       inkscape:export-filename="/tmp/progress.png"
-       inkscape:export-xdpi="90"
-       inkscape:export-ydpi="90" />
-  </g>
-</svg>

=== added file 'resources/unmaximize_dash.png'
Binary files resources/unmaximize_dash.png	1970-01-01 00:00:00 +0000 and resources/unmaximize_dash.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/unmaximize_dash.svg'
--- resources/unmaximize_dash.svg	2014-02-28 17:47:00 +0000
+++ resources/unmaximize_dash.svg	1970-01-01 00:00:00 +0000
@@ -1,74 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="unmaximize_dash.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       transform="translate(-289.71429,-454.00011)"
-       style="display:inline"
-       id="g4377">
-      <path
-         id="path4369"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,40.5 A 7.4999794,7.4999794 0 0 0 78,48 7.4999794,7.4999794 0 0 0 85.5,55.5 7.4999794,7.4999794 0 0 0 93,48 7.4999794,7.4999794 0 0 0 85.5,40.5 Z m -3.5,5 7,0 0,5 -7,0 0,-4.5 0,-0.5 z m 1,1 0,3 5,0 0,-3 -5,0 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         inkscape:connector-curvature="0" />
-      <rect
-         y="976.8623"
-         x="-0.5000006"
-         height="19"
-         width="19"
-         id="rect4361"
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/unmaximize_dash_disabled.png'
Binary files resources/unmaximize_dash_disabled.png	1970-01-01 00:00:00 +0000 and resources/unmaximize_dash_disabled.png	2012-02-12 15:48:12 +0000 differ
=== removed file 'resources/unmaximize_dash_disabled.svg'
--- resources/unmaximize_dash_disabled.svg	2014-02-28 17:47:00 +0000
+++ resources/unmaximize_dash_disabled.svg	1970-01-01 00:00:00 +0000
@@ -1,74 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="unmaximize_dash_disabled.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       transform="translate(-289.71429,-454.00011)"
-       style="display:inline;opacity:0.25"
-       id="g4377">
-      <path
-         id="path4369"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,40.5 A 7.4999794,7.4999794 0 0 0 78,48 7.4999794,7.4999794 0 0 0 85.5,55.5 7.4999794,7.4999794 0 0 0 93,48 7.4999794,7.4999794 0 0 0 85.5,40.5 Z m -3.5,5 7,0 0,5 -7,0 0,-4.5 0,-0.5 z m 1,1 0,3 5,0 0,-3 -5,0 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         inkscape:connector-curvature="0" />
-      <rect
-         y="976.8623"
-         x="-0.5000006"
-         height="19"
-         width="19"
-         id="rect4361"
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/unmaximize_dash_prelight.png'
Binary files resources/unmaximize_dash_prelight.png	1970-01-01 00:00:00 +0000 and resources/unmaximize_dash_prelight.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/unmaximize_dash_prelight.svg'
--- resources/unmaximize_dash_prelight.svg	2014-02-28 17:47:00 +0000
+++ resources/unmaximize_dash_prelight.svg	1970-01-01 00:00:00 +0000
@@ -1,94 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="unmaximize_dash_prelight.svg">
-  <defs
-     id="defs4488">
-    <filter
-       inkscape:collect="always"
-       style="color-interpolation-filters:sRGB"
-       id="filter4405"
-       x="-0.12"
-       width="1.24"
-       y="-0.12"
-       height="1.24">
-      <feGaussianBlur
-         inkscape:collect="always"
-         stdDeviation="0.75"
-         id="feGaussianBlur4407" />
-    </filter>
-  </defs>
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       style="display:inline"
-       id="g4381"
-       transform="translate(-289.71429,-454.00011)">
-      <path
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         d="M 85.5,40.5 A 7.4999794,7.4999794 0 0 0 78,48 7.4999794,7.4999794 0 0 0 85.5,55.5 7.4999794,7.4999794 0 0 0 93,48 7.4999794,7.4999794 0 0 0 85.5,40.5 Z m -3.5,5 7,0 0,5 -7,0 0,-4.5 0,-0.5 z m 1,1 0,3 5,0 0,-3 -5,0 z"
-         transform="translate(-76.500002,938.36224)"
-         id="path4383"
-         inkscape:connector-curvature="0" />
-      <rect
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         id="rect4385"
-         width="19"
-         height="19"
-         x="-0.5000006"
-         y="976.8623" />
-      <path
-         inkscape:connector-curvature="0"
-         id="path4403"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,40.5 A 7.4999794,7.4999794 0 0 0 78,48 7.4999794,7.4999794 0 0 0 85.5,55.5 7.4999794,7.4999794 0 0 0 93,48 7.4999794,7.4999794 0 0 0 85.5,40.5 Z m -3.5,5 7,0 0,5 -7,0 0,-4.5 0,-0.5 z m 1,1 0,3 5,0 0,-3 -5,0 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;filter:url(#filter4405);enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== added file 'resources/unmaximize_dash_pressed.png'
Binary files resources/unmaximize_dash_pressed.png	1970-01-01 00:00:00 +0000 and resources/unmaximize_dash_pressed.png	2012-03-14 06:24:18 +0000 differ
=== removed file 'resources/unmaximize_dash_pressed.svg'
--- resources/unmaximize_dash_pressed.svg	2014-02-28 17:47:00 +0000
+++ resources/unmaximize_dash_pressed.svg	1970-01-01 00:00:00 +0000
@@ -1,74 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   xmlns:dc="http://purl.org/dc/elements/1.1/"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   width="19"
-   height="19"
-   id="svg4486"
-   version="1.1"
-   inkscape:version="0.48+devel r"
-   viewBox="0 0 19 19"
-   sodipodi:docname="unmaximize_dash_pressed.svg">
-  <defs
-     id="defs4488" />
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#ffffff"
-     bordercolor="#666666"
-     borderopacity="1.0"
-     inkscape:pageopacity="0.0"
-     inkscape:pageshadow="2"
-     inkscape:zoom="7.9580786"
-     inkscape:cx="-7.3730107"
-     inkscape:cy="9.9678584"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="false"
-     fit-margin-top="0"
-     fit-margin-left="0"
-     fit-margin-right="0"
-     fit-margin-bottom="0" />
-  <metadata
-     id="metadata4491">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-        <dc:title></dc:title>
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(290.21429,-522.86219)">
-    <g
-       transform="translate(-289.71429,-454.00011)"
-       style="display:inline;opacity:0.5"
-       id="g4377">
-      <path
-         id="path4369"
-         transform="translate(-76.500002,938.36224)"
-         d="M 85.5,40.5 A 7.4999794,7.4999794 0 0 0 78,48 7.4999794,7.4999794 0 0 0 85.5,55.5 7.4999794,7.4999794 0 0 0 93,48 7.4999794,7.4999794 0 0 0 85.5,40.5 Z m -3.5,5 7,0 0,5 -7,0 0,-4.5 0,-0.5 z m 1,1 0,3 5,0 0,-3 -5,0 z"
-         style="color:#000000;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:8;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
-         inkscape:connector-curvature="0" />
-      <rect
-         y="976.8623"
-         x="-0.5000006"
-         height="19"
-         width="19"
-         id="rect4361"
-         style="color:#000000;fill:none;stroke:none;stroke-width:1;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
-    </g>
-  </g>
-</svg>

=== modified file 'services/panel-main.c'
--- services/panel-main.c	2014-02-28 05:13:02 +0000
+++ services/panel-main.c	2014-02-11 03:08:09 +0000
@@ -47,10 +47,6 @@
   "      <arg type='a(siiii)' name='geometries' direction='in'/>"
   "    </method>"
   ""
-  "    <method name='GetIconPaths'>"
-  "      <arg type='as' name='paths' direction='out'/>"
-  "    </method>"
-  ""
   "    <method name='ShowEntry'>"
   "      <arg type='s' name='entry_id' direction='in'/>"
   "      <arg type='u' name='xid' direction='in'/>"
@@ -101,8 +97,6 @@
   "     <arg type='b' name='show_now_state' />"
   "    </signal>"
   ""
-  "    <signal name='IconPathsChanged' />"
-  ""
   "  </interface>"
   "</node>";

@@ -184,16 +178,6 @@

       g_dbus_method_invocation_return_value (invocation, NULL);
     }
-  else if (g_strcmp0 (method_name, "GetIconPaths") == 0)
-    {
-      gchar **paths;
-      gint len;
-      GVariant *ret_value;
-      gtk_icon_theme_get_search_path (gtk_icon_theme_get_default (), &paths, &len);
-      ret_value = g_variant_new("(@as)", g_variant_new_strv ((const gchar **) paths, len));
-      g_dbus_method_invocation_return_value (invocation, ret_value);
-      g_strfreev (paths);
-    }
   else if (g_strcmp0 (method_name, "ShowEntry") == 0)
     {
       guint32 xid;
@@ -342,25 +326,6 @@
 }

 static void
-on_icon_theme_changed (GtkIconTheme* theme, GDBusConnection *connection)
-{
-  GError *error = NULL;
-  g_dbus_connection_emit_signal (connection,
-                                 NULL,
-                                 S_PATH,
-                                 S_IFACE,
-                                 "IconPathsChanged",
-                                 NULL,
-                                 &error);
-
-  if (error)
-    {
-      g_warning ("Unable to emit IconPathsChanged signal: %s", error->message);
-      g_error_free (error);
-    }
-}
-
-static void
 on_bus_acquired (GDBusConnection *connection,
                  const gchar     *name,
                  gpointer         user_data)
@@ -384,9 +349,6 @@
   g_signal_connect (service, "entry-show-now-changed",
                     G_CALLBACK (on_service_entry_show_now_changed), connection);

-  g_signal_connect (gtk_icon_theme_get_default(), "changed",
-                    G_CALLBACK (on_icon_theme_changed), connection);
-
   g_debug ("%s", G_STRFUNC);
   g_assert (reg_id > 0);
 }
@@ -408,8 +370,12 @@

   g_debug ("%s", G_STRFUNC);
   if (service != NULL)
-    g_signal_handlers_disconnect_by_data (service, connection);
-
+  {
+    g_signal_handlers_disconnect_by_func (service, on_service_resync, connection);
+    g_signal_handlers_disconnect_by_func (service, on_service_entry_activated, connection);
+    g_signal_handlers_disconnect_by_func (service, on_service_entry_activate_request, connection);
+    g_signal_handlers_disconnect_by_func (service, on_service_entry_show_now_changed, connection);
+  }
   gtk_main_quit ();
 }

@@ -446,7 +412,8 @@
   g_unsetenv ("NO_GAIL");

   gtk_init (&argc, &argv);
-  gtk_icon_theme_append_search_path (gtk_icon_theme_get_default(), INDICATORICONDIR);
+  gtk_icon_theme_append_search_path (gtk_icon_theme_get_default(),
+				     INDICATORICONDIR);
   ido_init ();

   if (g_getenv ("SILENT_PANEL_SERVICE") != NULL)

=== modified file 'services/panel-service.c'
--- services/panel-service.c	2014-03-03 11:00:27 +0000
+++ services/panel-service.c	2014-02-12 23:37:24 +0000
@@ -1398,82 +1398,59 @@
 }

 static gchar *
-gtk_image_to_data (GtkImage *image, guint32 *storage_type)
+gtk_image_to_data (GtkImage *image)
 {
-  *storage_type = gtk_image_get_storage_type (image);
+  GtkImageType type = gtk_image_get_storage_type (image);
   gchar *ret = NULL;

-  switch (*storage_type)
-    {
-      case GTK_IMAGE_PIXBUF:
-      {
-        gchar *file;
-        g_object_get (image, "file", &file, NULL);
-
-        if (file)
-          {
-            if (file[0] != '\0')
-              {
-                *storage_type = GTK_IMAGE_ICON_NAME;
-                ret = file;
-                break;
-              }
-
-            g_free (file);
-          }
-
-        GdkPixbuf  *pixbuf;
-        gchar      *buffer = NULL;
-        gsize       buffer_size = 0;
-        GError     *error = NULL;
-
-        pixbuf = gtk_image_get_pixbuf (image);
-
-        if (gdk_pixbuf_save_to_buffer (pixbuf, &buffer, &buffer_size, "png", &error, NULL))
-          {
-            ret = g_base64_encode ((const guchar *)buffer, buffer_size);
-            g_free (buffer);
-          }
-        else
-          {
-            g_warning ("Unable to convert pixbuf to png data: '%s'", error ? error->message : "unknown");
-            if (error)
-              g_error_free (error);
-
-            ret = g_strdup ("");
-          }
-
-        break;
-      }
-      case GTK_IMAGE_STOCK:
-      {
-        g_object_get (G_OBJECT (image), "stock", &ret, NULL);
-        break;
-      }
-      case GTK_IMAGE_ICON_NAME:
-      {
-        g_object_get (G_OBJECT (image), "icon-name", &ret, NULL);
-        break;
-      }
-      case GTK_IMAGE_GICON:
-      {
-        GIcon *icon = NULL;
-        gtk_image_get_gicon (image, &icon, NULL);
-        if (G_IS_ICON (icon))
+  if (type == GTK_IMAGE_PIXBUF)
+    {
+      GdkPixbuf  *pixbuf;
+      gchar      *buffer = NULL;
+      gsize       buffer_size = 0;
+      GError     *error = NULL;
+
+      pixbuf = gtk_image_get_pixbuf (image);
+
+      if (gdk_pixbuf_save_to_buffer (pixbuf, &buffer, &buffer_size, "png", &error, NULL))
+        {
+          ret = g_base64_encode ((const guchar *)buffer, buffer_size);
+          g_free (buffer);
+        }
+      else
+        {
+          g_warning ("Unable to convert pixbuf to png data: '%s'", error ? error->message : "unknown");
+          if (error)
+            g_error_free (error);
+
+          ret = g_strdup ("");
+        }
+    }
+  else if (type == GTK_IMAGE_STOCK)
+    {
+      g_object_get (G_OBJECT (image), "stock", &ret, NULL);
+    }
+  else if (type == GTK_IMAGE_ICON_NAME)
+    {
+      g_object_get (G_OBJECT (image), "icon-name", &ret, NULL);
+    }
+  else if (type == GTK_IMAGE_GICON)
+    {
+      GIcon *icon = NULL;
+      gtk_image_get_gicon (image, &icon, NULL);
+      if (G_IS_ICON (icon))
+        {
           ret = g_icon_to_string (icon);
-
-        break;
-      }
-      case GTK_IMAGE_EMPTY:
-      {
-        ret = g_strdup ("");
-        break;
-      }
-    default:
-      {
-        ret = g_strdup ("");
-        g_warning ("Unable to support GtkImageType: %u", *storage_type);
-      }
+        }
+    }
+  else if (type == GTK_IMAGE_EMPTY)
+    {
+      ret = g_strdup ("");
+    }
+  else
+    {
+      ret = g_strdup ("");
+      g_warning ("Unable to support GtkImageType: %d", type);
     }

   return ret;
@@ -1488,8 +1465,7 @@
 {
   gboolean is_label = GTK_IS_LABEL (entry->label);
   gboolean is_image = GTK_IS_IMAGE (entry->image);
-  guint32 image_type = 0;
-  gchar *image_data = gtk_image_to_data (entry->image, &image_type);
+  gchar *image_data = NULL;

   g_variant_builder_add (b, "(ssssbbusbbi)",
                          indicator_id,
@@ -1498,8 +1474,8 @@
                          is_label ? gtk_label_get_label (entry->label) : "",
                          is_label ? gtk_widget_get_sensitive (GTK_WIDGET (entry->label)) : FALSE,
                          is_label ? gtk_widget_get_visible (GTK_WIDGET (entry->label)) : FALSE,
-                         is_image ? image_type : 0,
-                         is_image ? image_data : "",
+                         is_image ? (guint32)gtk_image_get_storage_type (entry->image) : (guint32) 0,
+                         is_image ? (image_data = gtk_image_to_data (entry->image)) : "",
                          is_image ? gtk_widget_get_sensitive (GTK_WIDGET (entry->image)) : FALSE,
                          is_image ? gtk_widget_get_visible (GTK_WIDGET (entry->image)) : FALSE,
                          prio);
@@ -1580,14 +1556,6 @@
     }
 }

-static int
-get_monitor_scale_at (gint x, gint y)
-{
-  GdkScreen *screen = gdk_screen_get_default ();
-  int monitor = gdk_screen_get_monitor_at_point (screen, x, y);
-  return gdk_screen_get_monitor_scale_factor (screen, monitor);
-}
-
 static void
 positon_menu (GtkMenu  *menu,
               gint     *x,
@@ -1598,9 +1566,8 @@
   PanelService *self = PANEL_SERVICE (user_data);
   PanelServicePrivate *priv = self->priv;

-  gint scale = get_monitor_scale_at (priv->last_x, priv->last_y);
-  *x = priv->last_x / scale;
-  *y = priv->last_y / scale;
+  *x = priv->last_x;
+  *y = priv->last_y;
   *push = TRUE;
 }

@@ -1777,9 +1744,8 @@
                   GtkWindow *top_win = GTK_WINDOW (top_widget);
                   gint old_x, old_y;

-                  gint scale = get_monitor_scale_at (x, y);
                   gtk_window_get_position (top_win, &old_x, &old_y);
-                  gtk_window_move (top_win, old_x - (geo->x - x) / scale, old_y - (geo->y - y) / scale);
+                  gtk_window_move (top_win, old_x - (geo->x - x), old_y - (geo->y - y));
                 }
             }


=== modified file 'tests/mock_indicators.h'
--- tests/mock_indicators.h	2014-02-28 05:16:10 +0000
+++ tests/mock_indicators.h	2014-02-12 23:37:24 +0000
@@ -36,7 +36,6 @@
   // Implementing Indicators virtual functions
   MOCK_METHOD2(SyncGeometries, void(std::string const&, EntryLocationMap const&));
   MOCK_METHOD5(ShowEntriesDropdown, void(Indicator::Entries const&, Entry::Ptr const&, unsigned xid, int x, int y));
-  MOCK_CONST_METHOD0(IconPaths, std::vector<std::string> const&());
   MOCK_METHOD2(OnEntryScroll, void(std::string const&, int delta));
   MOCK_METHOD5(OnEntryShowMenu, void(std::string const&, unsigned xid, int x, int y, unsigned button));
   MOCK_METHOD1(OnEntrySecondaryActivate, void(std::string const&));

=== modified file 'tests/test_decorations_widgets.cpp'
--- tests/test_decorations_widgets.cpp	2014-02-26 02:23:52 +0000
+++ tests/test_decorations_widgets.cpp	2014-02-19 00:01:44 +0000
@@ -509,10 +509,10 @@
   layout->right_padding = random_positive_int();
   layout->bottom_padding = random_positive_int();

-  CompRect expected_geo(layout->Geometry().x() + layout->left_padding(),
-                        layout->Geometry().y() + layout->top_padding(),
-                        layout->Geometry().width() - layout->left_padding() - layout->right_padding(),
-                        layout->Geometry().height() - layout->top_padding() - layout->bottom_padding());
+  CompRect expected_geo(layout->Geometry().x() + layout->left_padding,
+                        layout->Geometry().y() + layout->top_padding,
+                        layout->Geometry().width() - layout->left_padding - layout->right_padding,
+                        layout->Geometry().height() - layout->top_padding - layout->bottom_padding);
   EXPECT_EQ(expected_geo, layout->ContentGeometry());
 }


=== modified file 'tests/test_launcher.cpp'
--- tests/test_launcher.cpp	2014-02-26 02:23:26 +0000
+++ tests/test_launcher.cpp	2014-02-18 20:42:34 +0000
@@ -187,11 +187,11 @@
     return icons;
   }

-  Settings settings;
   panel::Style panel_style;
   MockUScreen uscreen;
   testwrapper::StandaloneWM WM;
   nux::ObjectPtr<MockableBaseWindow> parent_window_;
+  Settings settings;
   LauncherModel::Ptr model_;
   Options::Ptr options_;
   nux::ObjectPtr<MockLauncher> launcher_;

=== modified file 'tests/test_launcher_controller.cpp'
--- tests/test_launcher_controller.cpp	2014-02-27 23:09:32 +0000
+++ tests/test_launcher_controller.cpp	2014-01-15 23:00:32 +0000
@@ -401,9 +401,10 @@
 {
   uscreen.SetupFakeMultiMonitor();
   ASSERT_EQ(lc.launchers().size(), monitors::MAX);
-  auto monitors = uscreen.GetMonitors();
+
+  std::vector<nux::Geometry> &monitors = uscreen.GetMonitors();
   monitors.erase(monitors.begin() + monitors.size()/2);
-  uscreen.SetMonitors(monitors);
+  uscreen.changed.emit(uscreen.GetPrimaryMonitor(), uscreen.GetMonitors());
   ASSERT_EQ(lc.launchers().size(), monitors::MAX - 1);

   for (unsigned i = 0; i < monitors::MAX - 1; ++i)

=== modified file 'tests/test_panel_controller.cpp'
--- tests/test_panel_controller.cpp	2014-02-27 23:09:32 +0000
+++ tests/test_panel_controller.cpp	2014-02-17 20:15:02 +0000
@@ -112,9 +112,9 @@

     ASSERT_EQ(pc.panels().size(), monitors::MAX);

-    auto monitors = uscreen.GetMonitors();
+    std::vector<nux::Geometry> &monitors = uscreen.GetMonitors();
     monitors.erase(monitors.begin() + monitors.size()/2);
-    uscreen.SetMonitors(monitors);
+    uscreen.changed.emit(uscreen.GetPrimaryMonitor(), uscreen.GetMonitors());
     ASSERT_EQ(pc.panels().size(), monitors::MAX - 1);

     for (unsigned int i = 0; i < monitors::MAX - 1; ++i)

=== modified file 'tests/test_panel_style.cpp'
--- tests/test_panel_style.cpp	2014-02-28 05:48:21 +0000
+++ tests/test_panel_style.cpp	2014-01-16 00:40:24 +0000
@@ -23,7 +23,6 @@
 #include <gio/gio.h>
 #include <gtest/gtest.h>

-#include <Nux/Nux.h>
 #include "unity-shared/PanelStyle.h"
 #include "unity-shared/UnitySettings.h"
 #include "test_utils.h"

=== modified file 'tests/test_raw_pixel.cpp'
--- tests/test_raw_pixel.cpp	2014-02-26 00:01:21 +0000
+++ tests/test_raw_pixel.cpp	2014-02-18 22:35:40 +0000
@@ -65,11 +65,6 @@
   ASSERT_EQ(p_i.CP(cv), 10);
 }

-TEST_F(TestRawPixel, TestConverterScale)
-{
-  ASSERT_EQ(p_i.CP(2), 20);
-}
-
 TEST_F(TestRawPixel, TestConverterTimesTwo)
 {
   cv->SetDPI(DPI * 2);

=== modified file 'tests/test_trash_launcher_icon.cpp'
--- tests/test_trash_launcher_icon.cpp	2014-02-28 05:48:21 +0000
+++ tests/test_trash_launcher_icon.cpp	2014-02-18 01:20:01 +0000
@@ -20,6 +20,8 @@
 #include <gmock/gmock.h>
 #include <UnityCore/DesktopUtilities.h>

+#include "unity-shared/PanelStyle.h"
+
 #include "TrashLauncherIcon.h"
 #include "test_mock_filemanager.h"
 #include "mock-application.h"
@@ -38,6 +40,7 @@
     , icon(fm_)
   {}

+  panel::Style panel_style;
   MockFileManager::Ptr fm_;
   TrashLauncherIcon icon;
 };

=== modified file 'unity-shared/AbstractIconRenderer.h'
--- unity-shared/AbstractIconRenderer.h	2014-02-27 01:18:35 +0000
+++ unity-shared/AbstractIconRenderer.h	2013-11-21 16:06:58 +0000
@@ -146,7 +146,6 @@

   nux::Property<PipRenderStyle> pip_style;
   nux::Property<int> monitor;
-  nux::Property<double> scale;

   // RenderArgs not const in case processor needs to modify positions to do a perspective correct.
   virtual void PreprocessIcons(std::list<RenderArg>& args, nux::Geometry const& target_window) = 0;

=== modified file 'unity-shared/CompizUtils.cpp'
--- unity-shared/CompizUtils.cpp	2014-02-24 16:00:02 +0000
+++ unity-shared/CompizUtils.cpp	2014-02-18 23:52:41 +0000
@@ -125,7 +125,7 @@

 //

-CairoContext::CairoContext(int w, int h, double scale)
+CairoContext::CairoContext(int w, int h)
   : pixmap_texture_(std::make_shared<PixmapTexture>(w, h))
   , surface_(nullptr)
   , cr_(nullptr)
@@ -134,7 +134,6 @@
   XRenderPictFormat* format = XRenderFindStandardFormat(screen->dpy(), PictStandardARGB32);
   surface_ = cairo_xlib_surface_create_with_xrender_format(screen->dpy(), pixmap_texture_->pixmap(),
                                                            xscreen, format, w, h);
-  cairo_surface_set_device_scale(surface_, scale, scale);

   cr_ = cairo_create(surface_);
   cairo_save(cr_);

=== modified file 'unity-shared/CompizUtils.h'
--- unity-shared/CompizUtils.h	2014-02-24 16:00:02 +0000
+++ unity-shared/CompizUtils.h	2014-02-18 17:55:54 +0000
@@ -92,7 +92,7 @@

 struct CairoContext
 {
-  CairoContext(int width, int height, double scale = 1.0f);
+  CairoContext(int width, int height);
   ~CairoContext();

   int width() const;

=== modified file 'unity-shared/DecorationStyle.cpp'
--- unity-shared/DecorationStyle.cpp	2014-02-28 17:40:25 +0000
+++ unity-shared/DecorationStyle.cpp	2014-02-18 17:56:39 +0000
@@ -53,7 +53,6 @@
 const int DEFAULT_GLOW_SIZE = 10;
 const nux::Color DEFAULT_GLOW_COLOR(221, 72, 20);

-const std::array<std::string, 2> THEMED_FILE_EXTENSIONS = { "svg", "png" };
 const std::array<std::string, size_t(WindowButtonType::Size)> WBUTTON_NAMES = { "close", "minimize", "unmaximize", "maximize" };
 const std::array<std::string, size_t(WidgetState::Size)> WBUTTON_STATES = {"", "_focused_prelight", "_focused_pressed", "_unfocused",
                                                                            "_unfocused", "_unfocused_prelight", "_unfocused_pressed" };
@@ -332,7 +331,7 @@
     gtk_style_context_set_state(ctx_, GtkStateFromWidgetState(ws));
   }

-  void DrawSide(Side s, WidgetState ws, cairo_t* cr, double w, double h)
+  void DrawSide(Side s, WidgetState ws, cairo_t* cr, int w, int h)
   {
     gtk_style_context_save(ctx_);
     AddContextClasses(s, ws);
@@ -341,63 +340,41 @@
     gtk_style_context_restore(ctx_);
   }

-  std::string ThemedFilePath(std::string const& base_filename, std::vector<std::string> const& extra_folders = {}) const
+  std::string WindowButtonFile(WindowButtonType type, WidgetState state) const
   {
     auto const& theme = parent_->theme();
+    auto filename = WBUTTON_NAMES[unsigned(type)] + WBUTTON_STATES[unsigned(state)] + ".png";
+    glib::String subpath(g_build_filename(theme.c_str(), "unity", filename.c_str(), nullptr));
+
+    // Look in home directory
     const char* home_dir = g_get_home_dir();
-    const char* gtk_prefix = g_getenv("GTK_DATA_PREFIX");
-    if (!gtk_prefix)
-      gtk_prefix = GTK_PREFIX;
-
-    for (auto const& extension : THEMED_FILE_EXTENSIONS)
+    if (home_dir)
     {
-      auto filename = base_filename + '.' + extension;
-      glib::String subpath(g_build_filename(theme.c_str(), "unity", filename.c_str(), nullptr));
-
-      // Look in home directory
-      if (home_dir)
-      {
-        glib::String local_file(g_build_filename(home_dir, ".local", "share", "themes", subpath.Value(), nullptr));
-
-        if (g_file_test(local_file, G_FILE_TEST_EXISTS))
-          return local_file.Str();
-
-        glib::String home_file(g_build_filename(home_dir, ".themes", subpath.Value(), nullptr));
-
-        if (g_file_test(home_file, G_FILE_TEST_EXISTS))
-          return home_file.Str();
-      }
-
-      glib::String path(g_build_filename(gtk_prefix, "share", "themes", subpath.Value(), nullptr));
-
-      if (g_file_test(path, G_FILE_TEST_EXISTS))
-        return path.Str();
-
-      for (auto const& folder : extra_folders)
-      {
-        glib::String path(g_build_filename(folder.c_str(), filename.c_str(), nullptr));
-
-        if (g_file_test(path, G_FILE_TEST_EXISTS))
-          return path.Str();
-      }
+      glib::String local_file(g_build_filename(home_dir, ".local", "share", "themes", subpath.Value(), nullptr));
+
+      if (g_file_test(local_file, G_FILE_TEST_EXISTS))
+        return local_file.Str();
+
+      glib::String home_file(g_build_filename(home_dir, ".themes", subpath.Value(), nullptr));
+
+      if (g_file_test(home_file, G_FILE_TEST_EXISTS))
+        return home_file.Str();
     }

-    return std::string();
-  }
-
-  std::string WindowButtonFile(WindowButtonType type, WidgetState state) const
-  {
-    auto base_filename = WBUTTON_NAMES[unsigned(type)] + WBUTTON_STATES[unsigned(state)];
-    auto const& file_path = ThemedFilePath(base_filename);
-
-    if (!file_path.empty())
-      return file_path;
-
-    LOG_WARN(logger) << "No Window button file for '"<< base_filename << "'";
-    return std::string();
-  }
-
-  void DrawWindowButton(WindowButtonType type, WidgetState ws, cairo_t* cr, double width, double height)
+    const char* var = g_getenv("GTK_DATA_PREFIX");
+    if (!var)
+      var = GTK_PREFIX;
+
+    glib::String path(g_build_filename(var, "share", "themes", subpath.Value(), nullptr));
+
+    if (g_file_test(path, G_FILE_TEST_EXISTS))
+      return path.Str();
+
+    LOG_WARN(logger) << "No Window button file for '"<< subpath.Str() << "'";
+    return std::string();
+  }
+
+  void DrawWindowButton(WindowButtonType type, WidgetState ws, cairo_t* cr, int width, int height)
   {
     nux::Color color;
     float w = width / 3.5f;
@@ -499,7 +476,7 @@
     return extents;
   }

-  void DrawTitle(std::string const& text, WidgetState ws, cairo_t* cr, double w, double h)
+  void DrawTitle(std::string const& text, WidgetState ws, cairo_t* cr, int w, int h)
   {
     gtk_style_context_save(ctx_);
     AddContextClasses(Side::TOP, ws);
@@ -512,8 +489,8 @@

     if (extents.width > w)
     {
-      double out_pixels = extents.width - w;
-      double fading_width = std::min<double>(title_fade_, out_pixels);
+      int out_pixels = extents.width - w;
+      int fading_width = std::min<int>(title_fade_, out_pixels);

       cairo_push_group(cr);
       gtk_render_layout(ctx_, cr, 0, 0, layout);
@@ -543,7 +520,7 @@
     gtk_style_context_add_class(ctx_, GTK_STYLE_CLASS_MENUITEM);
   }

-  void DrawMenuItem(WidgetState ws, cairo_t* cr, double w, double h)
+  void DrawMenuItem(WidgetState ws, cairo_t* cr, int w, int h)
   {
     gtk_style_context_save(ctx_);
     AddContextClassesForMenuItem(ws);
@@ -554,7 +531,7 @@
     gtk_style_context_restore(ctx_);
   }

-  void DrawMenuItemEntry(std::string const& text, WidgetState ws, cairo_t* cr, double w, double h)
+  void DrawMenuItemEntry(std::string const& text, WidgetState ws, cairo_t* cr, int w, int h)
   {
     gtk_style_context_save(ctx_);
     AddContextClassesForMenuItem(ws);
@@ -654,22 +631,22 @@
   return impl_->title_indent_;
 }

-void Style::DrawSide(Side s, WidgetState ws, cairo_t* cr, double w, double h)
+void Style::DrawSide(Side s, WidgetState ws, cairo_t* cr, int w, int h)
 {
   impl_->DrawSide(s, ws, cr, w, h);
 }

-void Style::DrawTitle(std::string const& t, WidgetState ws, cairo_t* cr, double w, double h)
+void Style::DrawTitle(std::string const& t, WidgetState ws, cairo_t* cr, int w, int h)
 {
   impl_->DrawTitle(t, ws, cr, w, h);
 }

-void Style::DrawMenuItem(WidgetState ws, cairo_t* cr, double w, double h)
+void Style::DrawMenuItem(WidgetState ws, cairo_t* cr, int w, int h)
 {
   impl_->DrawMenuItem(ws, cr, w, h);
 }

-void Style::DrawMenuItemEntry(std::string const& t, WidgetState ws, cairo_t* cr, double w, double h)
+void Style::DrawMenuItemEntry(std::string const& t, WidgetState ws, cairo_t* cr, int w, int h)
 {
   impl_->DrawMenuItemEntry(t, ws, cr, w, h);
 }
@@ -679,17 +656,12 @@
   impl_->DrawMenuItemIcon(i, ws, cr, s);
 }

-std::string Style::ThemedFilePath(std::string const& basename, std::vector<std::string> const& extra_folders) const
-{
-  return impl_->ThemedFilePath(basename, extra_folders);
-}
-
 std::string Style::WindowButtonFile(WindowButtonType type, WidgetState state) const
 {
   return impl_->WindowButtonFile(type, state);
 }

-void Style::DrawWindowButton(WindowButtonType type, WidgetState state, cairo_t* cr, double width, double height)
+void Style::DrawWindowButton(WindowButtonType type, WidgetState state, cairo_t* cr, int width, int height)
 {
   return impl_->DrawWindowButton(type, state, cr, width, height);
 }

=== modified file 'unity-shared/DecorationStyle.h'
--- unity-shared/DecorationStyle.h	2014-02-28 17:30:20 +0000
+++ unity-shared/DecorationStyle.h	2014-02-13 05:45:17 +0000
@@ -120,18 +120,16 @@
   nux::Size TitleNaturalSize(std::string const&);
   nux::Size MenuItemNaturalSize(std::string const&);

-  std::string ThemedFilePath(std::string const& basename, std::vector<std::string> const& extra_folders = {}) const;
-
   std::string WindowButtonFile(WindowButtonType, WidgetState) const;
-  void DrawWindowButton(WindowButtonType, WidgetState, cairo_t*, double width, double height);
+  void DrawWindowButton(WindowButtonType, WidgetState, cairo_t*, int width, int height);

   int DoubleClickMaxDistance() const;
   int DoubleClickMaxTimeDelta() const;

-  void DrawSide(Side, WidgetState, cairo_t*, double width, double height);
-  void DrawTitle(std::string const&, WidgetState, cairo_t*, double width, double height);
-  void DrawMenuItem(WidgetState, cairo_t*, double width, double height);
-  void DrawMenuItemEntry(std::string const&, WidgetState, cairo_t*, double width, double height);
+  void DrawSide(Side, WidgetState, cairo_t*, int width, int height);
+  void DrawTitle(std::string const&, WidgetState, cairo_t*, int width, int height);
+  void DrawMenuItem(WidgetState, cairo_t*, int width, int height);
+  void DrawMenuItemEntry(std::string const&, WidgetState, cairo_t*, int width, int height);
   void DrawMenuItemIcon(std::string const&, WidgetState, cairo_t*, int size);

 private:

=== modified file 'unity-shared/EMConverter.cpp'
--- unity-shared/EMConverter.cpp	2014-02-27 04:54:19 +0000
+++ unity-shared/EMConverter.cpp	2014-02-08 00:13:55 +0000
@@ -57,29 +57,23 @@
     base_pixels_per_em_ = DEFAULT_PPE;
 }

-bool EMConverter::SetFontSize(int font_size)
+void EMConverter::SetFontSize(int font_size)
 {
   if (font_size != font_size_)
   {
     font_size_ = font_size;
     UpdatePixelsPerEM();
     UpdateBasePixelsPerEM();
-    return true;
   }
-
-  return false;
 }

-bool EMConverter::SetDPI(double dpi)
+void EMConverter::SetDPI(double dpi)
 {
   if (dpi != dpi_)
   {
     dpi_ = dpi;
     UpdatePixelsPerEM();
-    return true;
   }
-
-  return false;
 }

 int EMConverter::GetFontSize() const

=== modified file 'unity-shared/EMConverter.h'
--- unity-shared/EMConverter.h	2014-02-27 04:54:19 +0000
+++ unity-shared/EMConverter.h	2014-02-18 22:35:40 +0000
@@ -32,8 +32,8 @@

   EMConverter(int font_size = 0, double dpi = 96.0);

-  bool SetFontSize(int font_size);
-  bool SetDPI(double dpi);
+  void SetFontSize(int font_size);
+  void SetDPI(double dpi);

   int    GetFontSize() const;
   double GetDPI() const;

=== modified file 'unity-shared/IconRenderer.cpp'
--- unity-shared/IconRenderer.cpp	2014-02-27 02:37:18 +0000
+++ unity-shared/IconRenderer.cpp	2013-10-04 00:46:07 +0000
@@ -28,7 +28,6 @@
 #include <UnityCore/GLibWrapper.h>
 #include <NuxGraphics/CairoGraphics.h>
 #include "unity-shared/CairoTexture.h"
-#include "unity-shared/TextureCache.h"
 #include "GraphicsUtils.h"

 #include <gtk/gtk.h>
@@ -206,6 +205,8 @@

   nux::ObjectPtr<nux::BaseTexture> RenderLabelTexture(char label, int icon_size, nux::Color const& bg_color);

+  BaseTexturePtr progress_bar_trough;
+  BaseTexturePtr progress_bar_fill;
   BaseTexturePtr pip_ltr;
   BaseTexturePtr large_pip_ltr;
   // BaseTexturePtr pip_rtl;
@@ -262,38 +263,19 @@
   void SetupShaders();
 };

-struct IconRenderer::LocalTextures
-{
-  void ReloadIconSizedTextures(int icon_size, int image_size)
-  {
-    auto& cache = TextureCache::GetDefault();
-    progress_bar_trough = cache.FindTexture("progress_bar_trough.svg", icon_size, icon_size);
-    progress_bar_fill = cache.FindTexture("progress_bar_fill.svg", image_size - (icon_size - image_size));
-  }
-
-  BaseTexturePtr progress_bar_trough;
-  BaseTexturePtr progress_bar_fill;
-};
-
 IconRenderer::IconRenderer()
   : icon_size(0)
   , image_size(0)
   , spacing(0)
   , textures_(TexturesPool::Get())
-  , local_textures_(std::make_shared<LocalTextures>())
 {
   pip_style = OUTSIDE_TILE;
 }

 void IconRenderer::SetTargetSize(int tile_size, int image_size_, int spacing_)
 {
-  if (icon_size != tile_size || image_size != image_size_)
-  {
-    icon_size = tile_size;
-    image_size = image_size_;
-    local_textures_->ReloadIconSizedTextures(icon_size, image_size);
-  }
-
+  icon_size = tile_size;
+  image_size = image_size_;
   spacing = spacing_;
 }

@@ -1076,11 +1058,11 @@
   int width = texture->GetWidth();
   int height = texture->GetHeight();

-  int progress_width = local_textures_->progress_bar_trough->GetHeight();
-  int progress_height = local_textures_->progress_bar_trough->GetWidth();
+  int progress_width =  icon_size;
+  int progress_height = textures_->progress_bar_trough->GetHeight();

   int fill_width = image_size - (icon_size - image_size);
-  int fill_height = local_textures_->progress_bar_fill->GetHeight();
+  int fill_height = textures_->progress_bar_fill->GetHeight();

   int fill_offset = static_cast<float>(image_size) * fill_offset_ratio;

@@ -1115,10 +1097,10 @@
   // left door
   GfxContext.PushClippingRectangle(nux::Geometry(left_edge, 0, half_size, height));
   GfxContext.QRP_1Tex(left_edge, progress_y, progress_width, progress_height,
-                      local_textures_->progress_bar_trough->GetDeviceTexture(), texxform,
+                      textures_->progress_bar_trough->GetDeviceTexture(), texxform,
                       nux::color::White);
   GfxContext.QRP_1Tex(left_edge + fill_offset, fill_y, fill_width, fill_height,
-                      local_textures_->progress_bar_fill->GetDeviceTexture(), texxform,
+                      textures_->progress_bar_fill->GetDeviceTexture(), texxform,
                       nux::color::White);
   GfxContext.PopClippingRectangle();

@@ -1126,11 +1108,11 @@
   GfxContext.PushClippingRectangle(nux::Geometry(left_edge + half_size, 0, half_size, height));
   GfxContext.QRP_1Tex(right_edge - progress_width, progress_y,
                       progress_width, progress_height,
-                      local_textures_->progress_bar_trough->GetDeviceTexture(), texxform,
+                      textures_->progress_bar_trough->GetDeviceTexture(), texxform,
                       nux::color::White);
   GfxContext.QRP_1Tex(right_edge - progress_width + fill_offset, fill_y,
                       fill_width, fill_height,
-                      local_textures_->progress_bar_fill->GetDeviceTexture(), texxform,
+                      textures_->progress_bar_fill->GetDeviceTexture(), texxform,
                       nux::color::White);

   GfxContext.PopClippingRectangle();
@@ -1237,6 +1219,8 @@
   , ColorifyColor(0)
   , DesatFactor(0)
 {
+  LoadTexture(progress_bar_trough, PKGDATADIR"/progress_bar_trough.png");
+  LoadTexture(progress_bar_fill, PKGDATADIR"/progress_bar_fill.png");
   LoadTexture(pip_ltr, PKGDATADIR"/launcher_pip_ltr.png");
   LoadTexture(large_pip_ltr, PKGDATADIR"/launcher_pip_large_ltr.png");
   // LoadTexture(pip_rtl, PKGDATADIR"/launcher_pip_rtl.png");

=== modified file 'unity-shared/IconRenderer.h'
--- unity-shared/IconRenderer.h	2014-02-27 02:37:18 +0000
+++ unity-shared/IconRenderer.h	2013-04-10 21:41:57 +0000
@@ -88,8 +88,6 @@

   struct TexturesPool;
   std::shared_ptr<TexturesPool> textures_;
-  struct LocalTextures;
-  std::shared_ptr<LocalTextures> local_textures_;
   nux::Matrix4 stored_projection_matrix_;
 };


=== modified file 'unity-shared/MenuManager.cpp'
--- unity-shared/MenuManager.cpp	2014-02-28 05:34:54 +0000
+++ unity-shared/MenuManager.cpp	2014-02-13 03:33:02 +0000
@@ -45,7 +45,6 @@
     indicators_->on_object_added.connect(sigc::mem_fun(this, &Impl::AddIndicator));
     indicators_->on_object_removed.connect(sigc::mem_fun(this, &Impl::RemoveIndicator));
     indicators_->on_entry_activate_request.connect(sigc::mem_fun(this, &Impl::ActivateRequest));
-    indicators_->icon_paths_changed.connect(sigc::mem_fun(this, &Impl::IconPathsChanged));
   }

   ~Impl()
@@ -132,17 +131,6 @@
       entry->set_show_now(show);
   }

-  void IconPathsChanged()
-  {
-    auto const& icon_paths = indicators_->IconPaths();
-    std::vector<const gchar*> gicon_paths(icon_paths.size());
-
-    for (auto const& path : icon_paths)
-      gicon_paths.push_back(path.c_str());
-
-    gtk_icon_theme_set_search_path(gtk_icon_theme_get_default(), gicon_paths.data(), gicon_paths.size());
-  }
-
   Manager* parent_;
   Indicators::Ptr indicators_;
   Indicator::Ptr appmenu_;

=== modified file 'unity-shared/OverlayWindowButtons.cpp'
--- unity-shared/OverlayWindowButtons.cpp	2014-02-25 21:36:34 +0000
+++ unity-shared/OverlayWindowButtons.cpp	2014-02-17 20:15:02 +0000
@@ -49,7 +49,7 @@
 {
   if (window_buttons_->monitor == monitor)
     return true;
-
+
   return false;
 }


=== modified file 'unity-shared/PanelStyle.cpp'
--- unity-shared/PanelStyle.cpp	2014-02-28 17:32:46 +0000
+++ unity-shared/PanelStyle.cpp	2014-02-18 22:35:40 +0000
@@ -18,10 +18,8 @@
  *              Marco Trevisan <3v1n0@ubuntu.com>
  */

-#include <Nux/Nux.h>
 #include <NuxCore/Logger.h>

-#include "config.h"
 #include "PanelStyle.h"
 #include "CairoTexture.h"

@@ -44,31 +42,19 @@
 const int BUTTONS_PADDING = 1;
 const int BASE_PANEL_HEIGHT = 24;

-inline std::string button_id(std::string const& prefix, double scale, WindowButtonType type, WindowState ws)
+std::string button_id(WindowButtonType type, WindowState ws)
 {
-  std::string texture_id = prefix;
-  texture_id += std::to_string(scale);
+  std::string texture_id = "window-button-";
   texture_id += std::to_string(static_cast<int>(type));
   texture_id += std::to_string(static_cast<int>(ws));
   return texture_id;
 }

-inline std::string win_button_id(double scale, WindowButtonType type, WindowState ws)
-{
-  return button_id("window-button-", scale, type, ws);
-}
-
-inline std::string dash_button_id(double scale, WindowButtonType type, WindowState ws)
-{
-  return button_id("dash-win-button-", scale, type, ws);
-}
-
 }

 Style::Style()
   : style_context_(gtk_style_context_new())
-  , bg_textures_(monitors::MAX)
-  , panel_heights_(monitors::MAX, 0)
+  , panel_heights_(monitors::MAX, BASE_PANEL_HEIGHT)
 {
   if (style_instance)
   {
@@ -89,7 +75,6 @@

   gtk_widget_path_free(widget_path);

-  Settings::Instance().dpi_changed.connect(sigc::mem_fun(this, &Style::DPIChanged));
   auto const& deco_style = decoration::Style::Get();
   auto refresh_cb = sigc::hide(sigc::mem_fun(this, &Style::RefreshContext));
   deco_style->theme.changed.connect(sigc::mem_fun(this, &Style::OnThemeChanged));
@@ -116,15 +101,10 @@
 void Style::OnThemeChanged(std::string const&)
 {
   auto& cache = TextureCache::GetDefault();
-  auto& settings = Settings::Instance();

-  for (unsigned monitor = 0; monitor < monitors::MAX; ++monitor)
-    for (unsigned button = 0; button < unsigned(WindowButtonType::Size); ++button)
-      for (unsigned state = 0; state < unsigned(WindowState::Size); ++state)
-      {
-        cache.Invalidate(win_button_id(settings.em(monitor)->DPIScale(), WindowButtonType(button), WindowState(state)));
-        cache.Invalidate(dash_button_id(settings.em(monitor)->DPIScale(), WindowButtonType(button), WindowState(state)));
-      }
+  for (unsigned button = 0; button < unsigned(WindowButtonType::Size); ++button)
+    for (unsigned state = 0; state < unsigned(WindowState::Size); ++state)
+      cache.Invalidate(button_id(WindowButtonType(button), WindowState(state)));

   RefreshContext();
 }
@@ -137,26 +117,14 @@
     return 0;
   }

-  auto& panel_height = panel_heights_[monitor];
-
-  if (panel_height > 0)
-    return panel_height;
-
-  panel_height = Settings::Instance().em(monitor)->CP(BASE_PANEL_HEIGHT);
-  return panel_height;
-}
-
-void Style::DPIChanged()
-{
-  bg_textures_.assign(monitors::MAX, BaseTexturePtr());
-  panel_heights_.assign(monitors::MAX, 0);
-  changed.emit();
+  EMConverter::Ptr const& cv = unity::Settings::Instance().em(monitor);
+  return panel_heights_[monitor].CP(cv);
 }

 void Style::RefreshContext()
 {
   gtk_style_context_invalidate(style_context_);
-  bg_textures_.assign(monitors::MAX, BaseTexturePtr());
+  bg_texture_.Release();

   changed.emit();
 }
@@ -168,13 +136,12 @@

 BaseTexturePtr Style::GetBackground(int monitor)
 {
-  auto& bg_texture = bg_textures_[monitor];
-
-  if (bg_texture)
-    return bg_texture;
-
-  const int width = 1;
+  if (bg_texture_)
+    return bg_texture_;
+
+  int width = 1;
   int height = PanelHeight(monitor);
+
   nux::CairoGraphics context(CAIRO_FORMAT_ARGB32, width, height);

   // Use the internal context as we know it is good and shiny new.
@@ -182,76 +149,40 @@
   gtk_render_background(style_context_, cr, 0, 0, width, height);
   gtk_render_frame(style_context_, cr, 0, 0, width, height);

-  bg_texture = texture_ptr_from_cairo_graphics(context);
-  return bg_texture;
-}
-
-BaseTexturePtr GetFallbackWindowButton(WindowButtonType type, WindowState state, int monitor = 0)
-{
-  double scale = Settings::Instance().em(monitor)->DPIScale();
-  int button_size = std::round((BUTTONS_SIZE + BUTTONS_PADDING*2) * scale);
-  nux::CairoGraphics cairo_graphics(CAIRO_FORMAT_ARGB32, button_size, button_size);
+  bg_texture_ = texture_ptr_from_cairo_graphics(context);
+
+  return bg_texture_;
+}
+
+BaseTexturePtr Style::GetWindowButton(WindowButtonType type, WindowState state)
+{
+  auto texture_factory = [this, type, state] (std::string const&, int, int) {
+    nux::BaseTexture* texture = nullptr;
+    auto const& file = decoration::Style::Get()->WindowButtonFile(type, state);
+    texture = nux::CreateTexture2DFromFile(file.c_str(), -1, true);
+    if (texture)
+      return texture;
+
+    auto const& fallback = GetFallbackWindowButton(type, state);
+    texture = fallback.GetPointer();
+    texture->Reference();
+
+    return texture;
+  };
+
+  auto& cache = TextureCache::GetDefault();
+  return cache.FindTexture(button_id(type, state), 0, 0, texture_factory);
+}
+
+BaseTexturePtr Style::GetFallbackWindowButton(WindowButtonType type, WindowState state)
+{
+  nux::CairoGraphics cairo_graphics(CAIRO_FORMAT_ARGB32, BUTTONS_SIZE + BUTTONS_PADDING*2, BUTTONS_SIZE + BUTTONS_PADDING*2);
   cairo_t* ctx = cairo_graphics.GetInternalContext();
-  cairo_surface_set_device_scale(cairo_graphics.GetSurface(), scale, scale);
   cairo_translate(ctx, BUTTONS_PADDING, BUTTONS_PADDING);
   decoration::Style::Get()->DrawWindowButton(type, state, ctx, BUTTONS_SIZE, BUTTONS_SIZE);
   return texture_ptr_from_cairo_graphics(cairo_graphics);
 }

-nux::BaseTexture* ButtonFactory(std::string const& file, WindowButtonType type, WindowState state, int monitor, double scale)
-{
-  nux::Size size;
-  nux::BaseTexture* texture = nullptr;
-  gdk_pixbuf_get_file_info(file.c_str(), &size.width, &size.height);
-
-  size.width = std::round(size.width * scale);
-  size.height = std::round(size.height * scale);
-  texture = nux::CreateTexture2DFromFile(file.c_str(), std::max(size.width, size.height), true);
-
-  if (texture)
-    return texture;
-
-  auto const& fallback = GetFallbackWindowButton(type, state, monitor);
-  texture = fallback.GetPointer();
-  texture->Reference();
-
-  return texture;
-}
-
-BaseTexturePtr Style::GetWindowButton(WindowButtonType type, WindowState state, int monitor)
-{
-  auto const& file = decoration::Style::Get()->WindowButtonFile(type, state);
-  double scale = Settings::Instance().em(monitor)->DPIScale();
-
-  auto texture_factory = [this, &file, type, state, monitor, scale] (std::string const&, int, int) {
-    return ButtonFactory(file, type, state, monitor, scale);
-  };
-
-  auto& cache = TextureCache::GetDefault();
-  return cache.FindTexture(win_button_id(scale, type, state), 0, 0, texture_factory);
-}
-
-BaseTexturePtr Style::GetDashWindowButton(WindowButtonType type, WindowState state, int monitor)
-{
-  static const std::array<std::string, 4> names = { "close_dash", "minimize_dash", "unmaximize_dash", "maximize_dash" };
-  static const std::array<std::string, 4> states = { "", "_prelight", "_pressed", "_disabled" };
-
-  auto base_filename = names[unsigned(type)] + states[unsigned(state)];
-  auto const& file = decoration::Style::Get()->ThemedFilePath(base_filename, {PKGDATADIR"/"});
-
-  if (file.empty())
-    return BaseTexturePtr();
-
-  double scale = Settings::Instance().em(monitor)->DPIScale();
-
-  auto texture_factory = [this, &file, type, state, monitor, scale] (std::string const&, int, int) {
-    return ButtonFactory(file, type, state, monitor, scale);
-  };
-
-  auto& cache = TextureCache::GetDefault();
-  return cache.FindTexture(dash_button_id(scale, type, state), 0, 0, texture_factory);
-}
-
 std::string Style::GetFontDescription(PanelItem item)
 {
   switch (item)
@@ -266,6 +197,14 @@
   return std::string();
 }

+int Style::GetTextDPI()
+{
+  int dpi = 0;
+  g_object_get(gtk_settings_get_default(), "gtk-xft-dpi", &dpi, nullptr);
+
+  return dpi;
+}
+
 } // namespace panel
 } // namespace unity


=== modified file 'unity-shared/PanelStyle.h'
--- unity-shared/PanelStyle.h	2014-02-28 17:32:46 +0000
+++ unity-shared/PanelStyle.h	2014-02-18 03:28:31 +0000
@@ -22,16 +22,14 @@
 #ifndef PANEL_STYLE_H
 #define PANEL_STYLE_H

-#include <NuxCore/ObjectPtr.h>
+#include <Nux/Nux.h>
 #include <NuxCore/Property.h>

 #include <gtk/gtk.h>
 #include <UnityCore/GLibWrapper.h>

-namespace nux
-{
-class BaseTexture;
-}
+#include "unity-shared/EMConverter.h"
+#include "unity-shared/RawPixel.h"

 namespace unity
 {
@@ -64,9 +62,10 @@

   GtkStyleContext* GetStyleContext();
   BaseTexturePtr GetBackground(int monitor = 0);
-  BaseTexturePtr GetWindowButton(WindowButtonType type, WindowState state, int monitor = 0);
-  BaseTexturePtr GetDashWindowButton(WindowButtonType type, WindowState state, int monitor = 0);
+  BaseTexturePtr GetWindowButton(WindowButtonType type, WindowState state);
+  BaseTexturePtr GetFallbackWindowButton(WindowButtonType type, WindowState state);
   std::string GetFontDescription(PanelItem item);
+  int GetTextDPI();

   int PanelHeight(int monitor = 0) const;

@@ -75,14 +74,14 @@
 private:
   void OnThemeChanged(std::string const&);
   void RefreshContext();
-  void DPIChanged();

   void UpdateFontSize();
   void UpdatePanelHeight();

   glib::Object<GtkStyleContext> style_context_;
-  std::vector<BaseTexturePtr> bg_textures_;
-  mutable std::vector<unsigned> panel_heights_;
+  BaseTexturePtr bg_texture_;
+
+  std::vector<RawPixel> panel_heights_;
 };

 }

=== modified file 'unity-shared/PluginAdapter.cpp'
--- unity-shared/PluginAdapter.cpp	2014-03-03 16:47:37 +0000
+++ unity-shared/PluginAdapter.cpp	2014-02-25 12:36:05 +0000
@@ -26,7 +26,7 @@
 #include "CompizUtils.h"
 #include "MultiMonitor.h"

-#include <NuxGraphics/XInputWindow.h>
+#include <scale/scale.h>
 #include <NuxCore/Logger.h>

 namespace unity
@@ -420,7 +420,7 @@
   {
     nux::Geometry const& i_g = geo.Intersect(monitors[i]);

-    if (i_g.width > geo.width/2 && i_g.height > geo.height/2)
+    if (i_g.width > 0 && i_g.height > 0)
       return i;
   }


=== modified file 'unity-shared/RawPixel.cpp'
--- unity-shared/RawPixel.cpp	2014-02-26 00:01:21 +0000
+++ unity-shared/RawPixel.cpp	2014-02-18 22:35:40 +0000
@@ -17,7 +17,6 @@
  * Authored by: Brandon Schaefer <brandon.schaefer@canonical.com>
  */

-#include <cmath>
 #include "RawPixel.h"

 namespace unity
@@ -33,23 +32,19 @@
   return RawPixel(pixel);
 }

-RawPixel::RawPixel(double raw_pixel)
+RawPixel::RawPixel(float raw_pixel)
   : raw_pixel_(raw_pixel)
-{}
-
-int RawPixel::CP(EMConverter::Ptr const& converter) const
-{
-  return std::round(converter->CP(raw_pixel_));
-}
-
-int RawPixel::CP(double scale) const
-{
-  return std::round(raw_pixel_ * scale);
-}
-
-RawPixel::operator int() const
-{
-  return std::round(raw_pixel_);
+{
+}
+
+float RawPixel::CP(EMConverter::Ptr const& converter) const
+{
+  return converter->CP(raw_pixel_);
+}
+
+RawPixel::operator float() const
+{
+  return raw_pixel_;
 }

 } // namesapce unity

=== modified file 'unity-shared/RawPixel.h'
--- unity-shared/RawPixel.h	2014-02-26 00:01:21 +0000
+++ unity-shared/RawPixel.h	2014-02-18 22:35:40 +0000
@@ -28,15 +28,15 @@
 class RawPixel
 {
 public:
-  RawPixel(double raw_pixel);
-
-  int CP(EMConverter::Ptr const&) const;
-  int CP(double scale) const;
-
-  operator int() const;
+  RawPixel(float raw_pixel);
+
+  float CP(EMConverter::Ptr const& converter) const;
+
+  operator float() const;

 private:
-  double raw_pixel_;
+  float raw_pixel_;
+
 };

 // User-Defined Literals (ex: 10_em, 10.0_em)

=== modified file 'unity-shared/SearchBar.cpp'
--- unity-shared/SearchBar.cpp	2014-02-25 03:35:17 +0000
+++ unity-shared/SearchBar.cpp	2014-02-17 23:30:01 +0000
@@ -485,7 +485,7 @@
   last_height_ = geo.height;

   nux::CairoGraphics cairo_graphics(CAIRO_FORMAT_ARGB32, last_width_, last_height_);
-  cairo_t* cr = cairo_graphics.GetInternalContext();
+  cairo_t* cr = cairo_graphics.GetContext();

   cairo_graphics.DrawRoundedRectangle(cr,
                                       1.0f,
@@ -501,6 +501,7 @@
   cairo_set_source_rgba(cr, 1.0f, 1.0f, 1.0f, 0.7f);
   cairo_stroke(cr);

+  cairo_destroy(cr);
   nux::BaseTexture* texture2D = texture_from_cairo_graphics(cairo_graphics);

   nux::TexCoordXForm texxform;

=== modified file 'unity-shared/StaticCairoText.cpp'
--- unity-shared/StaticCairoText.cpp	2014-02-25 04:59:37 +0000
+++ unity-shared/StaticCairoText.cpp	2013-11-14 00:17:19 +0000
@@ -104,7 +104,6 @@
   int lines_;
   int actual_lines_;
   float line_spacing_;
-  double scale_;
 };

 StaticCairoText::Impl::Impl(StaticCairoText* parent, std::string const& text)
@@ -123,7 +122,6 @@
     // number of lines if negative.
   , actual_lines_(0)
   , line_spacing_(0.5)
-  , scale_(1.0f)
 {
   GtkSettings* settings = gtk_settings_get_default();  // not ref'ed
   g_signal_connect(settings, "notify::gtk-font-name",
@@ -445,22 +443,6 @@
   }
 }

-void StaticCairoText::SetScale(double scale)
-{
-  if (pimpl->scale_ == scale)
-    return;
-
-  pimpl->scale_ = scale;
-  pimpl->need_new_extent_cache_ = true;
-  pimpl->UpdateTexture();
-  QueueDraw();
-}
-
-double StaticCairoText::GetScale() const
-{
-  return pimpl->scale_;
-}
-
 int StaticCairoText::GetLineCount() const
 {
   return pimpl->actual_lines_;
@@ -608,17 +590,11 @@
   else
     result.width = logic_rect.width;

-  result.width = std::ceil(result.width * scale_);
-  result.height = std::ceil(result.height * scale_);
-
   if (result.width > parent_->GetMaximumWidth())
   {
-    pango_layout_set_width(layout, parent_->GetMaximumWidth() * PANGO_SCALE / scale_);
+    pango_layout_set_width(layout, parent_->GetMaximumWidth() * PANGO_SCALE);
     pango_layout_context_changed(layout);
     pango_layout_get_pixel_size(layout, &result.width, &result.height);
-
-    result.width = std::ceil(result.width * scale_);
-    result.height = std::ceil(result.height * scale_);
   }

   cached_extent_ = result;
@@ -715,7 +691,6 @@

   nux::Size layout_size(-1, lines_ < 0 ? lines_ : std::numeric_limits<int>::min());
   texture->cr.reset(new CairoGraphics(CAIRO_FORMAT_ARGB32, cached_extent_.width, cached_extent_.height));
-  cairo_surface_set_device_scale(texture->cr->GetSurface(), scale_, scale_);
   cairo_t* cr = texture->cr->GetInternalContext();

   PangoLayout*          layout     = NULL;
@@ -764,9 +739,9 @@
   pango_layout_context_changed(layout);
   pango_layout_get_pixel_size(layout, &result.width, &result.height);

-  if (std::ceil(result.width * scale_) > parent_->GetMaximumWidth())
+  if (result.width > parent_->GetMaximumWidth())
   {
-    pango_layout_set_width(layout, parent_->GetMaximumWidth() * PANGO_SCALE / scale_);
+    pango_layout_set_width(layout, parent_->GetMaximumWidth() * PANGO_SCALE);
     pango_layout_context_changed(layout);
   }


=== modified file 'unity-shared/StaticCairoText.h'
--- unity-shared/StaticCairoText.h	2014-02-25 04:59:37 +0000
+++ unity-shared/StaticCairoText.h	2013-09-19 16:44:03 +0000
@@ -97,9 +97,6 @@
   void GetTextExtents(int& width, int& height) const;
   nux::Size GetTextExtents() const;

-  void SetScale(double);
-  double GetScale() const;
-
   sigc::signal<void, StaticCairoText*> sigTextChanged;
   sigc::signal<void, StaticCairoText*> sigTextColorChanged;
   sigc::signal<void, StaticCairoText*> sigFontChanged;

=== modified file 'unity-shared/TextInput.cpp'
--- unity-shared/TextInput.cpp	2014-02-25 03:35:17 +0000
+++ unity-shared/TextInput.cpp	2013-11-19 18:48:35 +0000
@@ -203,7 +203,7 @@
   last_height_ = geo.height;

   nux::CairoGraphics cairo_graphics(CAIRO_FORMAT_ARGB32, last_width_, last_height_);
-  cairo_t* cr = cairo_graphics.GetInternalContext();
+  cairo_t* cr = cairo_graphics.GetContext();

   cairo_graphics.DrawRoundedRectangle(cr,
                                       1.0f,
@@ -219,6 +219,7 @@
   cairo_set_source_rgba(cr, 1.0f, 1.0f, 1.0f, 0.7f);
   cairo_stroke(cr);

+  cairo_destroy(cr);
   nux::BaseTexture* texture2D = texture_from_cairo_graphics(cairo_graphics);

   nux::TexCoordXForm texxform;

=== modified file 'unity-shared/TextureCache.cpp'
--- unity-shared/TextureCache.cpp	2014-02-27 03:02:25 +0000
+++ unity-shared/TextureCache.cpp	2014-01-14 17:08:11 +0000
@@ -36,15 +36,12 @@

 nux::BaseTexture* TextureCache::DefaultTexturesLoader(std::string const& name, int w, int h)
 {
-  int size = std::max(w, h);
-  return nux::CreateTexture2DFromFile((PKGDATADIR"/" + name).c_str(), (!size ? -1 : size), true);
+  return nux::CreateTexture2DFromFile((PKGDATADIR"/" + name).c_str(), -1, true);
 }

-std::size_t TextureCache::Hash(std::string const& id, int width, int height)
+std::string TextureCache::Hash(std::string const& id, int width, int height)
 {
-  return ((std::hash<std::string>()(id)
-          ^ (std::hash<int>()(width) << 1)) >> 1)
-          ^ (std::hash<int>()(height) << 1);
+  return id + "-" + std::to_string(width) + "x" + std::to_string(height);
 }

 TextureCache::BaseTexturePtr TextureCache::FindTexture(std::string const& texture_id,
@@ -54,7 +51,7 @@
   if (!factory)
     return BaseTexturePtr();

-  auto key = Hash(texture_id, width, height);
+  std::string const& key = Hash(texture_id, width, height);
   auto texture_it = cache_.find(key);

   BaseTexturePtr texture(texture_it != cache_.end() ? texture_it->second : nullptr);
@@ -83,7 +80,8 @@
     // are destroyed first, then the sigc::trackable disconnects all methods
     // created using mem_fun.

-    cache_.insert({key, texture.GetPointer()});
+    cache_[key] = texture.GetPointer();
+
     auto on_destroy = sigc::mem_fun(this, &TextureCache::OnDestroyNotify);
     texture->OnDestroyed.connect(sigc::bind(on_destroy, key));
   }
@@ -96,7 +94,7 @@
   cache_.erase(Hash(texture_id, width, height));
 }

-void TextureCache::OnDestroyNotify(nux::Trackable* Object, std::size_t key)
+void TextureCache::OnDestroyNotify(nux::Trackable* Object, std::string const& key)
 {
   cache_.erase(key);
 }

=== modified file 'unity-shared/TextureCache.h'
--- unity-shared/TextureCache.h	2014-02-27 03:02:25 +0000
+++ unity-shared/TextureCache.h	2014-01-14 17:08:11 +0000
@@ -57,12 +57,12 @@
 private:
   TextureCache() = default;

-  std::size_t Hash(std::string const& , int width, int height);
+  std::string Hash(std::string const& , int width, int height);
   // Have the key passed by value not referece, as the key will be a bound
   // parameter in the slot passed to the texture on_destroy signal.
-  void OnDestroyNotify(nux::Trackable* Object, std::size_t key);
+  void OnDestroyNotify(nux::Trackable* Object, std::string const& key);

-  std::unordered_map<std::size_t, nux::BaseTexture*> cache_;
+  std::unordered_map<std::string, nux::BaseTexture*> cache_;
 };

 }

=== modified file 'unity-shared/UScreen.cpp'
--- unity-shared/UScreen.cpp	2014-02-27 05:30:25 +0000
+++ unity-shared/UScreen.cpp	2014-02-20 18:34:46 +0000
@@ -54,7 +54,7 @@
   return default_screen_;
 }

-int UScreen::GetMonitorWithMouse() const
+int UScreen::GetMonitorWithMouse()
 {
   GdkDevice* device;
   GdkDisplay *display;
@@ -69,31 +69,31 @@
   return GetMonitorAtPosition(x, y);
 }

-int UScreen::GetPrimaryMonitor() const
+int UScreen::GetPrimaryMonitor()
 {
   return primary_;
 }

-int UScreen::GetMonitorAtPosition(int x, int y) const
+int UScreen::GetMonitorAtPosition(int x, int y)
 {
   return gdk_screen_get_monitor_at_point(screen_, x, y);
 }

-nux::Geometry const& UScreen::GetMonitorGeometry(int monitor) const
+nux::Geometry& UScreen::GetMonitorGeometry(int monitor)
 {
   return monitors_[monitor];
 }

-std::vector<nux::Geometry> const& UScreen::GetMonitors() const
+std::vector<nux::Geometry>& UScreen::GetMonitors()
 {
   return monitors_;
 }

-nux::Geometry UScreen::GetScreenGeometry() const
+nux::Geometry UScreen::GetScreenGeometry()
 {
   int width = gdk_screen_get_width(screen_);
   int height = gdk_screen_get_height(screen_);
-  return nux::Geometry(0, 0, width, height);
+  return nux::Geometry(0, 0, width, height);
 }

 const std::string UScreen::GetMonitorName(int output_number = 0) const
@@ -104,14 +104,14 @@
     return "";
   }

-  glib::String output_name(gdk_screen_get_monitor_plug_name(screen_, output_number));
+  char* const output_name = gdk_screen_get_monitor_plug_name(screen_, output_number);
   if (!output_name)
   {
     LOG_ERROR(logger) << "UScreen::GetMonitorName: Failed to get monitor name for monitor" << output_number;
     return "";
   }

-  return output_name.Str();
+  return std::string(output_name);
 }

 int UScreen::GetPluggedMonitorsNumber() const

=== modified file 'unity-shared/UScreen.h'
--- unity-shared/UScreen.h	2014-02-27 05:30:25 +0000
+++ unity-shared/UScreen.h	2014-02-20 17:41:29 +0000
@@ -20,10 +20,9 @@
 #define _UNITY_SCREEN_H_

 #include <gdk/gdk.h>
+#include <Nux/Nux.h>
+#include <sigc++/sigc++.h>
 #include <vector>
-#include <iostream>
-#include <sigc++/sigc++.h>
-#include <NuxCore/Rect.h>

 #include <UnityCore/GLibSignal.h>
 #include <UnityCore/GLibSource.h>
@@ -41,16 +40,16 @@

   static UScreen* GetDefault();

-  int GetPrimaryMonitor() const;
-  int GetMonitorWithMouse() const;
-  int GetMonitorAtPosition(int x, int y) const;
-  nux::Geometry const& GetMonitorGeometry(int monitor) const;
+  int             GetPrimaryMonitor();
+  int             GetMonitorWithMouse();
+  int             GetMonitorAtPosition(int x, int y);
+  nux::Geometry&  GetMonitorGeometry(int monitor);

-  std::vector<nux::Geometry> const& GetMonitors() const;
-  nux::Geometry GetScreenGeometry() const;
+  std::vector<nux::Geometry>& GetMonitors();
+  nux::Geometry GetScreenGeometry();

   // <void, primary_monitor, monitors>
-  sigc::signal<void, int, std::vector<nux::Geometry> const&> changed;
+  sigc::signal<void, int, std::vector<nux::Geometry>&> changed;
   sigc::signal<void> resuming;

   const std::string GetMonitorName(int output_number) const;

=== modified file 'unity-shared/UnitySettings.cpp'
--- unity-shared/UnitySettings.cpp	2014-02-27 05:30:25 +0000
+++ unity-shared/UnitySettings.cpp	2014-02-21 17:05:47 +0000
@@ -18,9 +18,12 @@
 *              Andrea Azzarone <andrea.azzarone@canonical.com>
 */

+#include <gdk/gdk.h>
+#include <gtk/gtk.h>
+#include <gio/gio.h>
 #include <glib.h>
+
 #include <NuxCore/Logger.h>
-#include <UnityCore/Variant.h>

 #include "DecorationStyle.h"
 #include "MultiMonitor.h"
@@ -43,14 +46,12 @@
 const std::string CLICK_MOVEMENT_THRESHOLD = "click-movement-threshold";
 const std::string DOUBLE_CLICK_WAIT = "double-click-wait";
 const std::string UI_SETTINGS = "com.ubuntu.user-interface";
-
-const double DEFAULT_DPI = 96.0f;
 }

 //
 // Start private implementation
 //
-class Settings::Impl : public sigc::trackable
+class Settings::Impl
 {
 public:
   Impl(Settings* owner)
@@ -71,8 +72,6 @@
     UpdateEMConverter();
     UpdateLimSetting();

-    UScreen::GetDefault()->changed.connect(sigc::hide(sigc::hide(sigc::mem_fun(this, &Impl::UpdateEMConverter))));
-
     signals_.Add<void, GSettings*, const gchar*>(usettings_, "changed::" + FORM_FACTOR, [this] (GSettings*, const gchar*) {
       CacheFormFactor();
       parent_->form_factor.changed.emit(cached_form_factor_);
@@ -153,21 +152,37 @@
     return font_size / 1024;
   }

-  int GetDPI(glib::Variant const& dict, int monitor) const
+  float GetUIScaleFactor(int monitor = 0) const
   {
-    auto* uscreen = UScreen::GetDefault();
-
-    if (monitor < 0 || monitor >= uscreen->GetPluggedMonitorsNumber())
-      return DEFAULT_DPI;
-
-    auto const& monitor_name = UScreen::GetDefault()->GetMonitorName(monitor);
-    double ui_scale = 1.0f;
+    GVariant* dict;
+    g_settings_get(ubuntu_settings_, SCALE_FACTOR.c_str(), "@a{si}", &dict);
+
+    std::string monitor_name = UScreen::GetDefault()->GetMonitorName(monitor);
+
     int value;
-
-    if (g_variant_lookup(dict, monitor_name.c_str(), "i", &value))
-      ui_scale = static_cast<double>(value)/8.0f;
-
-    return (DEFAULT_DPI * ui_scale);
+    float ui_scale;
+    if (!g_variant_lookup (dict, monitor_name.c_str(), "i", &value))
+    {
+      ui_scale = 1.0;
+    }
+    else
+    {
+      ui_scale = (float)value / 8.0;
+    }
+
+    return ui_scale;
+  }
+
+  int GetDPI(int monitor = 0) const
+  {
+    int dpi = 96;
+    int valid_monitors = UScreen::GetDefault()->GetPluggedMonitorsNumber();
+    if (monitor >= 0 && monitor < valid_monitors)
+    {
+      float new_dpi = (float)dpi * GetUIScaleFactor(monitor);
+      dpi = (int)new_dpi;
+    }
+    return dpi;
   }

   void UpdateFontSize()
@@ -180,20 +195,13 @@

   void UpdateDPI()
   {
-    glib::Variant dict;
-    g_settings_get(ubuntu_settings_, SCALE_FACTOR.c_str(), "@a{si}", &dict);
-    bool any_changed = false;
-
     for (unsigned i = 0; i < em_converters_.size(); ++i)
     {
-      int dpi = GetDPI(dict, i);
-
-      if (em_converters_[i]->SetDPI(dpi))
-        any_changed = true;
+      int dpi = GetDPI(i);
+      em_converters_[i]->SetDPI(dpi);
     }

-    if (any_changed)
-      parent_->dpi_changed.emit();
+    parent_->dpi_changed.emit();
   }

   void UpdateEMConverter()

=== modified file 'unity-shared/VScrollBarOverlayWindow.cpp'
--- unity-shared/VScrollBarOverlayWindow.cpp	2014-02-25 03:35:17 +0000
+++ unity-shared/VScrollBarOverlayWindow.cpp	2013-09-24 01:54:15 +0000
@@ -439,7 +439,7 @@
   nux::color::RedGreenBlue const& bg_bright_line = ProduceColorShade(bg, 1.2);

   nux::CairoGraphics cairoGraphics(CAIRO_FORMAT_ARGB32, width, height);
-  cr = cairoGraphics.GetInternalContext();
+  cr = cairoGraphics.GetContext();

   cairo_save(cr);

@@ -559,6 +559,7 @@
   DrawBothArrows(cr, arrow_color, width, height);

   thumb_texture_.Adopt(unity::texture_from_cairo_graphics(cairoGraphics));
+  cairo_destroy(cr);

   QueueDraw();
 }

=== modified file 'unity-shared/WindowButtonPriv.h'
--- unity-shared/WindowButtonPriv.h	2014-02-28 17:41:25 +0000
+++ unity-shared/WindowButtonPriv.h	2014-02-19 02:16:22 +0000
@@ -61,6 +61,7 @@
   void UpdateSize();
   void LoadImages();
   bool EnabledSetter(bool enabled);
+  static nux::ObjectPtr<nux::BaseTexture> GetDashWindowButton(panel::WindowButtonType type, panel::WindowState state);

   void UpdateGeometry();

@@ -72,6 +73,7 @@
 private:
   panel::WindowButtonType type_;
   int monitor_;
+  EMConverter::Ptr cv_;

   nux::ObjectPtr<nux::BaseTexture> normal_tex_;
   nux::ObjectPtr<nux::BaseTexture> prelight_tex_;

=== modified file 'unity-shared/WindowButtons.cpp'
--- unity-shared/WindowButtons.cpp	2014-02-28 17:41:25 +0000
+++ unity-shared/WindowButtons.cpp	2014-02-19 02:16:22 +0000
@@ -18,6 +18,8 @@
  *              Marco Trevisan (Trevio) <3v1n0@ubuntu.com>
  */

+#include "config.h"
+
 #include <Nux/Nux.h>
 #include <array>

@@ -26,6 +28,7 @@
 #include "WindowButtons.h"
 #include "WindowButtonPriv.h"

+#include "unity-shared/TextureCache.h"
 #include "unity-shared/UBusMessages.h"
 #include "unity-shared/WindowManager.h"

@@ -41,6 +44,7 @@
   , overlay_mode(false)
   , type_(type)
   , monitor_(0)
+  , cv_(unity::Settings::Instance().em(monitor_))
 {
   overlay_mode.changed.connect([this] (bool) { UpdateSize(); QueueDraw(); });
   SetAcceptKeyNavFocusOnMouseDown(false);
@@ -56,7 +60,7 @@
 void WindowButton::OnMonitorChanged(int monitor)
 {
   monitor_ = monitor;
-  LoadImages();
+  cv_ = unity::Settings::Instance().em(monitor);
 }

 void WindowButton::SetVisualState(nux::ButtonVisualState new_state)
@@ -150,8 +154,10 @@

   if (tex)
   {
-    width  = std::min(panel_height, tex->GetWidth());
-    height = std::min(panel_height, tex->GetHeight());
+    int tex_w = RawPixel(tex->GetWidth()).CP(cv_);
+    int tex_h = RawPixel(tex->GetHeight()).CP(cv_);
+    width  = std::min(panel_height, tex_w);
+    height = std::min(panel_height, tex_h);
   }

   SetMinMaxSize(width, height);
@@ -161,22 +167,39 @@
 {
   panel::Style& style = panel::Style::Instance();

-  normal_tex_ = style.GetWindowButton(type_, panel::WindowState::NORMAL, monitor_);
-  prelight_tex_ = style.GetWindowButton(type_, panel::WindowState::PRELIGHT, monitor_);
-  pressed_tex_ = style.GetWindowButton(type_, panel::WindowState::PRESSED, monitor_);
-  unfocused_tex_ = style.GetWindowButton(type_, panel::WindowState::BACKDROP, monitor_);
-  disabled_tex_ = style.GetWindowButton(type_, panel::WindowState::DISABLED, monitor_);
-  unfocused_prelight_tex_ = style.GetWindowButton(type_, panel::WindowState::BACKDROP_PRELIGHT, monitor_);
-  unfocused_pressed_tex_ = style.GetWindowButton(type_, panel::WindowState::BACKDROP_PRESSED, monitor_);
-  normal_dash_tex_ = style.GetDashWindowButton(type_, panel::WindowState::NORMAL, monitor_);
-  prelight_dash_tex_ = style.GetDashWindowButton(type_, panel::WindowState::PRELIGHT, monitor_);
-  pressed_dash_tex_ = style.GetDashWindowButton(type_, panel::WindowState::PRESSED, monitor_);
-  disabled_dash_tex_ = style.GetDashWindowButton(type_, panel::WindowState::DISABLED, monitor_);
+  normal_tex_ = style.GetWindowButton(type_, panel::WindowState::NORMAL);
+  prelight_tex_ = style.GetWindowButton(type_, panel::WindowState::PRELIGHT);
+  pressed_tex_ = style.GetWindowButton(type_, panel::WindowState::PRESSED);
+  unfocused_tex_ = style.GetWindowButton(type_, panel::WindowState::BACKDROP);
+  disabled_tex_ = style.GetWindowButton(type_, panel::WindowState::DISABLED);
+  unfocused_prelight_tex_ = style.GetWindowButton(type_, panel::WindowState::BACKDROP_PRELIGHT);
+  unfocused_pressed_tex_ = style.GetWindowButton(type_, panel::WindowState::BACKDROP_PRESSED);
+  normal_dash_tex_ = GetDashWindowButton(type_, panel::WindowState::NORMAL);
+  prelight_dash_tex_ = GetDashWindowButton(type_, panel::WindowState::PRELIGHT);
+  pressed_dash_tex_ = GetDashWindowButton(type_, panel::WindowState::PRESSED);
+  disabled_dash_tex_ = GetDashWindowButton(type_, panel::WindowState::DISABLED);

   UpdateSize();
   QueueDraw();
 }

+nux::ObjectPtr<nux::BaseTexture> WindowButton::GetDashWindowButton(panel::WindowButtonType type, panel::WindowState state)
+{
+  nux::ObjectPtr<nux::BaseTexture> texture;
+  static const std::array<std::string, 4> names = {{ "close_dash", "minimize_dash", "unmaximize_dash", "maximize_dash" }};
+  static const std::array<std::string, 4> states = {{ "", "_prelight", "_pressed", "_disabled" }};
+
+  std::string subpath = names[static_cast<int>(type)] + states[static_cast<int>(state)] + ".png";
+
+  auto& cache = TextureCache::GetDefault();
+  texture = cache.FindTexture(subpath);
+
+  if (!texture)
+    texture = panel::Style::Instance().GetFallbackWindowButton(type, state);
+
+  return texture;
+}
+
 panel::WindowButtonType WindowButton::GetType() const
 {
   return type_;
@@ -318,11 +341,6 @@
 {
   for (auto area : GetChildren())
     static_cast<internal::WindowButton*>(area)->UpdateDPIChanged();
-
-  ComputeContentSize();
-  int width = GetContentWidth();
-  SetMaximumWidth(width);
-  SetMinimumWidth(width);
 }

 void WindowButtons::OnMonitorChanged(int monitor)

